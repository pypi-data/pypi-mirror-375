"use strict";(self.webpackChunkjupyterlab_gather=self.webpackChunkjupyterlab_gather||[]).push([[217,598],{2598:(e,l,n)=>{n.r(l),n.d(l,{useFilePicker:()=>y,useImperativeFilePicker:()=>g});var r=n(3345),t=n(4492);const a=({onFilesSelected:e,onFilesSuccessfullySelected:l,onFilesRejected:n,onClear:t,validators:a})=>({onFilesSelected:(0,r.useCallback)(l=>{null==e||e(l),null==a||a.forEach(e=>{e.onFilesSelected(l)})},[e,a]),onFilesSuccessfullySelected:(0,r.useCallback)(e=>{null==l||l(e),null==a||a.forEach(l=>{l.onFilesSuccessfullySelected(e)})},[a,l]),onFilesRejected:(0,r.useCallback)(e=>{null==n||n(e),null==a||a.forEach(l=>{l.onFilesRejected(e)})},[a,n]),onClear:(0,r.useCallback)(()=>{null==t||t(),null==a||a.forEach(e=>{var l;null==(l=e.onClear)||l.call(e)})},[a,t])});var o=Object.defineProperty,i=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,u=(e,l,n)=>l in e?o(e,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[l]=n,d=(e,l)=>{for(var n in l||(l={}))s.call(l,n)&&u(e,n,l[n]);if(i)for(var n of i(l))c.call(l,n)&&u(e,n,l[n]);return e},f=(e,l)=>{var n={};for(var r in e)s.call(e,r)&&l.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&i)for(var r of i(e))l.indexOf(r)<0&&c.call(e,r)&&(n[r]=e[r]);return n},p=(e,l,n)=>new Promise((r,t)=>{var a=e=>{try{i(n.next(e))}catch(e){t(e)}},o=e=>{try{i(n.throw(e))}catch(e){t(e)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);i((n=n.apply(e,l)).next())});const v=[];function y(e={}){const{accept:l="*",multiple:n=!0,readAs:o="Text",readFilesContent:i=!0,validators:s=v,initializeWithCustomParameters:c}=e,[u,y]=(0,r.useState)([]),[F,b]=(0,r.useState)([]),[m,h]=(0,r.useState)([]),[C,S]=(0,r.useState)(!1),{onFilesSelected:P,onFilesSuccessfullySelected:k,onFilesRejected:j,onClear:g}=a(e),O=(0,r.useCallback)(()=>{y([]),b([]),h([])},[]),w=(0,r.useCallback)(()=>{O(),null==g||g()},[O,g]),E=(0,r.useCallback)(l=>new Promise((n,r)=>{const t=new FileReader;t[`readAs${o}`].call(t,l,"Text"===e.readAs?e.encoding:void 0);const a=e=>{var l=f(e,[]);r(d({},l))};t.onload=()=>p(null,null,function*(){return Promise.all(s.map(n=>n.validateAfterParsing(e,l,t).catch(e=>Promise.reject(a(e))))).then(()=>n({content:t.result,name:l.name,lastModified:l.lastModified,path:l.path,size:l.size,type:l.type})).catch(()=>{})}),t.onerror=()=>{a({name:"FileReaderError",readerError:t.error,causedByFile:l})}}),[e,o,s]);return{openFilePicker:(0,r.useCallback)(()=>{!function(l,n,r,a){const o=document.createElement("input");o.style.display="none",document.body.appendChild(o),o.type="file","*"!==l&&(o.accept=l),o.multiple=n,o.addEventListener("change",l=>{var n;n=l,p(null,null,function*(){O(),S(!0);const l=yield(0,t.R)(n),r=(yield Promise.all(s.map(n=>n.validateBeforeParsing(e,l).catch(e=>Array.isArray(e)?e:[e])))).flat(1).filter(Boolean);if(y(l),h(r),r.length)return y([]),null==j||j({errors:r}),null==P||P({errors:r}),void S(!1);if(!i)return null==P||P({plainFiles:l,filesContent:[]}),void S(!1);const a=[],o=yield Promise.all(l.map(e=>E(e).catch(e=>{a.push(...Array.isArray(e)?e:[e])})));if(S(!1),a.length)return y([]),b([]),h(e=>[...e,...a]),null==j||j({errors:a}),void(null==P||P({errors:r.concat(a)}));b(o),y(l),h([]),null==k||k({filesContent:o,plainFiles:l}),null==P||P({plainFiles:l,filesContent:o})}),document.body.removeChild(o)}),o.addEventListener("cancel",()=>{document.body.removeChild(o)}),a&&a(o),o.dispatchEvent(new MouseEvent("click"))}(l instanceof Array?l.join(","):l,n,0,c)},[e,l,O,c,n,j,P,k,E,i,s]),filesContent:F,errors:m,loading:C,plainFiles:u,clear:w}}var F=Object.defineProperty,b=Object.defineProperties,m=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable,P=(e,l,n)=>l in e?F(e,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[l]=n,k=(e,l)=>{for(var n in l||(l={}))C.call(l,n)&&P(e,n,l[n]);if(h)for(var n of h(l))S.call(l,n)&&P(e,n,l[n]);return e},j=(e,l)=>b(e,m(l));function g(e){const{onFilesSelected:l,onFilesSuccessfullySelected:n,validators:t,onFileRemoved:a}=e,[o,i]=(0,r.useState)([]),[s,c]=(0,r.useState)([]),{openFilePicker:u,loading:d,errors:f,clear:p}=y(j(k({},e),{onFilesSelected:e=>{var n;if(l)return(null==(n=e.errors)?void 0:n.length)?l(e):void l({errors:void 0,plainFiles:[...o,...e.plainFiles||[]],filesContent:[...s,...e.filesContent||[]]})},onFilesSuccessfullySelected:e=>{i(l=>l.concat(e.plainFiles)),c(l=>l.concat(e.filesContent)),n&&n({plainFiles:[...o,...e.plainFiles||[]],filesContent:[...s,...e.filesContent||[]]})}})),v=(0,r.useCallback)(()=>{p(),i([]),c([])},[p]),F=(0,r.useCallback)(e=>{c(l=>[...l.slice(0,e),...l.slice(e+1)]),i(l=>{const n=l[e];return n?(null==t||t.forEach(l=>{var r;return null==(r=l.onFileRemoved)?void 0:r.call(l,n,e)}),null==a||a(n,e),[...l.slice(0,e),...l.slice(e+1)]):l})},[t,a]),b=(0,r.useCallback)(e=>{const l=o.findIndex(l=>l===e);-1!==l&&F(l)},[F,o]);return{openFilePicker:u,plainFiles:o,filesContent:s,loading:d,errors:f,clear:v,removeFileByIndex:F,removeFileByReference:b}}}}]);