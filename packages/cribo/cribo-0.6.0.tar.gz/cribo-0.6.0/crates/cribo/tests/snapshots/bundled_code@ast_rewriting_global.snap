---
source: crates/cribo/tests/test_bundling_snapshots.rs
input_file: crates/cribo/tests/fixtures/ast_rewriting_global/main.py
---
#!/usr/bin/env python3
# Generated by Cribo - Python Source Bundler
# https://github.com/ophidiarium/cribo

import sys as _sys
import importlib as _importlib
class _CriboModule():

    def __init__(self, m, p):
        self._m, self._p = m, p

    def __getattr__(self, n):
        f = self._p + '.' + n
        try:
            return _CriboModule(_importlib.import_module(f), f)
        except ImportError:
            return getattr(self._m, n)

    def __getattribute__(self, n):
        return object.__getattribute__(self, n) if n in ('_m', '_p', '__getattr__', '__class__', '__dict__', '__dir__', '__module__', '__qualname__') else getattr(object.__getattribute__(self, '_m'), n)
class _Cribo():

    def __getattr__(self, n):
        m = _sys.modules.get(n) or _importlib.import_module(n)
        return _CriboModule(m, n)
_cribo = _Cribo()
module_global_keyword = _cribo.types.SimpleNamespace(__name__='module_global_keyword')
"""Module demonstrating global keyword usage."""
foo_3 = "module1_foo"
def get_foo():
    """Get the module's global foo value."""
    return foo_3
def modify_foo():
    """Modify the module's global foo using global keyword."""
    global foo_3
    foo_3 = "module1_foo_modified"
def set_foo_with_global(value):
    """Set foo using global keyword."""
    global foo_3
    foo_3 = value
def local_vs_global():
    """Demonstrate local vs global scope."""
    foo_3 = "local_foo"

    def inner():
        global foo_3
        return foo_3
    return foo_3, inner()
module_global_keyword.foo = foo_3
module_global_keyword.get_foo = get_foo
module_global_keyword.local_vs_global = local_vs_global
module_global_keyword.modify_foo = modify_foo
module_global_keyword.set_foo_with_global = set_foo_with_global
module_globals_dict = _cribo.types.SimpleNamespace(__name__='module_globals_dict', __initializing__=False, __initialized__=False)
def _cribo_init___cribo_5101f4_module_globals_dict(self):
    if getattr(self, '__initialized__', False):
        return self
    if getattr(self, '__initializing__', False):
        return self
    self.__initializing__ = True
    """Module demonstrating globals() dictionary access."""
    bar = "module2_bar"
    self.bar = bar
    baz = 42
    self.baz = baz

    def get_bar():
        """Get bar using globals() dict."""
        return module_globals_dict.__dict__["bar"]
    self.get_bar = get_bar

    def modify_bar():
        """Modify bar using globals() dict."""
        module_globals_dict.__dict__["bar"] = "module2_bar_modified"
    self.modify_bar = modify_bar

    def set_dynamic_global(name, value):
        """Set a global variable dynamically using globals()."""
        module_globals_dict.__dict__[name] = value
    self.set_dynamic_global = set_dynamic_global

    def get_dynamic_global(name, default=None):
        """Get a global variable dynamically."""
        return module_globals_dict.__dict__.get(name, default)
    self.get_dynamic_global = get_dynamic_global

    def list_module_globals():
        """List all non-built-in globals in this module."""
        return {k: v for k, v in module_globals_dict.__dict__.items() if not k.startswith("__") and k not in ["get_bar", "modify_bar", "set_dynamic_global", "get_dynamic_global", "list_module_globals"]}
    self.list_module_globals = list_module_globals
    set_dynamic_global("dynamic1", "created_via_globals")
    set_dynamic_global("dynamic2", [1, 2, 3])
    self.__initialized__ = True
    self.__initializing__ = False
    return self
module_globals_dict.__init__ = _cribo_init___cribo_5101f4_module_globals_dict
module_mixed_patterns = _cribo.types.SimpleNamespace(__name__='module_mixed_patterns', __initializing__=False, __initialized__=False)
_cribo_module_mixed_patterns_foo = None
_cribo_module_mixed_patterns_counter = None
def _cribo_init___cribo_c75306_module_mixed_patterns(self):
    if getattr(self, '__initialized__', False):
        return self
    if getattr(self, '__initializing__', False):
        return self
    self.__initializing__ = True
    global _cribo_module_mixed_patterns_counter, _cribo_module_mixed_patterns_foo
    """Module demonstrating mixed global access patterns."""
    foo = "module3_foo"
    _cribo_module_mixed_patterns_foo = foo
    self.foo = _cribo_module_mixed_patterns_foo
    bar = "module3_bar"
    self.bar = bar
    counter = 0
    _cribo_module_mixed_patterns_counter = counter
    self.counter = _cribo_module_mixed_patterns_counter

    def get_values():
        """Get module globals using different methods."""
        direct_foo = self.foo
        dict_bar = module_mixed_patterns.__dict__["bar"]
        counter_val = module_mixed_patterns.__dict__.get("counter", -1)
        return {"foo": direct_foo, "bar": dict_bar, "counter": counter_val}
    self.get_values = get_values

    def modify_all():
        """Modify globals using different patterns."""
        global _cribo_module_mixed_patterns_foo, _cribo_module_mixed_patterns_counter
        _cribo_module_mixed_patterns_foo = "module3_foo_modified"
        self.foo = _cribo_module_mixed_patterns_foo
        _cribo_module_mixed_patterns_counter += 1
        self.counter = _cribo_module_mixed_patterns_counter
        module_mixed_patterns.__dict__["bar"] = "module3_bar_modified"
        module_mixed_patterns.__dict__["new_var"] = "dynamically_added"
    self.modify_all = modify_all

    def complex_global_usage():
        """Demonstrate complex global usage patterns."""
        global _cribo_module_mixed_patterns_counter
        original = _cribo_module_mixed_patterns_counter
        for i in range(3):
            _cribo_module_mixed_patterns_counter += 1

        def increment():
            global counter
            counter += 1
            return counter
        global_keys = [k for k in module_mixed_patterns.__dict__ if not k.startswith("_")]
        return {"original": original, "after_loop": _cribo_module_mixed_patterns_counter, "increment_func": increment, "global_count": len(global_keys)}
    self.complex_global_usage = complex_global_usage
    module_mixed_patterns.__dict__["initialized_via_globals"] = True
    exec("exec_created_var = 'created_via_exec'", module_mixed_patterns.__dict__)
    self.__initialized__ = True
    self.__initializing__ = False
    return self
module_mixed_patterns.__init__ = _cribo_init___cribo_c75306_module_mixed_patterns
"""Test global namespace isolation between modules."""
foo_1 = "main_foo"
foo = foo_1
bar_1 = "main_bar"
bar = bar_1
module_globals_dict = _cribo_init___cribo_5101f4_module_globals_dict(module_globals_dict)
module_mixed_patterns = _cribo_init___cribo_c75306_module_mixed_patterns(module_mixed_patterns)
assert foo_1 == "main_foo"
assert bar_1 == "main_bar"
print("Module with global keyword:", module_global_keyword.get_foo())
print("Module with globals() dict:", module_globals_dict.get_bar())
print("Module with mixed patterns:", module_mixed_patterns.get_values())
module_global_keyword.modify_foo()
module_globals_dict.modify_bar()
module_mixed_patterns.modify_all()
print("\nAfter modifications:")
print("Module with global keyword:", module_global_keyword.get_foo())
print("Module with globals() dict:", module_globals_dict.get_bar())
print("Module with mixed patterns:", module_mixed_patterns.get_values())
assert foo_1 == "main_foo"
assert bar_1 == "main_bar"
print("\nMain's globals remain unchanged:")
print(f"foo = {foo_1}")
print(f"bar = {bar_1}")
