#!/bin/bash
## Run regenie for binary traits
#################################
## NOTE #########################
## regenie: v3.2.9
#################################
## ARGUMENTS ####################
## bfile1 ：prefix
## bfile2 ：prefix
## phenoFile: phenoFile path
## phenoColList: e.g. "B1,B2"
## covarFile: covarFile path
## covarColList: e.g. "sex,age,PC1_AVG,PC2_AVG,PC3_AVG,PC4_AVG,PC5_AVG,PC6_AVG,PC7_AVG,PC8_AVG,PC9_AVG,PC10_AVG"
## catCovarList: e.g. "sex"
## step1out : output prefix
## nthreads : number of threads
## bsize : e.g. 1000
## minMAC 
## step2out
#################################

regenie \
  --step 1 \
  --bt \
  --bed ${bfile1} \
  --covarFile ${covarFile} \
  --covarColList ${covarColList} \
  --catCovarList ${catCovarList} \
  --phenoFile ${phenoFile} \
  --phenoColList ${phenoColList} \
  --bsize ${bsize} \
  --maxCatLevels 99 \
  --lowmem \
  --threads ${nthreads} \
  --lowmem-prefix tmp_rg \
  --out ${step1out}

  regenie \
  --step 2 \
  --bt \
  --bed ${bfile2} \
  --af-cc \
  --covarFile ${covarFile} \
  --covarColList ${covarColList} \
  --catCovarList ${catCovarList} \
  --phenoFile ${phenoFile} \
  --phenoColList ${phenoColList} \
  --bsize ${bsize} \
  --maxCatLevels 99 \
  --ref-first \
  --minMAC ${minMAC} \
  --threads ${nthreads} \
  --firth \
  --approx \
  --pThresh 0.05 \
  --firth-se \
  --write-samples \
  --print-pheno \
  --pred ${step1out}_pred.list \
  --out ${step2out}
