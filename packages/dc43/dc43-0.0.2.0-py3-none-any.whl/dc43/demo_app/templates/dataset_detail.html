{% extends "base.html" %}
{% block content %}
<h1>Dataset {{ record.dataset_name }} {{ record.dataset_version }}</h1>
<p><a href="/datasets/{{ record.dataset_name }}">Back to versions</a></p>
<p>Contract: <a href="/contracts/{{ record.contract_id }}">{{ record.contract_id }}</a>
<a href="/contracts/{{ record.contract_id }}/{{ record.contract_version }}">{{ record.contract_version }}</a></p>
{% if record.draft_contract_version %}
<p>Draft Contract: <a href="/contracts/{{ record.contract_id }}/{{ record.draft_contract_version }}">{{ record.draft_contract_version }}</a></p>
{% endif %}
<p>Status: {{ record.status }} | Run type: {{ record.run_type }}</p>
{% set fails = record.dq_details.get('output', {}).get('failed_expectations', {}) %}
<h2>Data Quality</h2>
{% if fails %}
<table class="table table-sm">
  <thead><tr><th>Name</th><th>Predicate</th><th>Count</th></tr></thead>
  <tbody>
  {% for key, info in fails.items() %}
  <tr><td>{{ key }}</td><td><code>{{ info.expression }}</code></td><td>{{ info.count }}</td></tr>
  {% endfor %}
  </tbody>
</table>
{% else %}
<p>No data quality failures.</p>
{% endif %}
<h2>Details</h2>
<pre class="small">{{ record.dq_details.get('output') | tojson(indent=2) }}</pre>
{% if data_preview %}
<h2>Data</h2>
<pre class="small">{{ data_preview }}</pre>
{% endif %}
{% endblock %}

