"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[7020],{96687:(e,a,t)=>{var i=t(29079),n=t(50090),r=t(97598),s=t.n(r),c=t(86326),l=t(35623),u=t(72956),o=t(42430),d=t(50528),m=t(68803),p=t(47279),y=t(56237),D=t(6423),g=t(85218),f=t(46145),v=t(96478),E=t(49528);const b=i.default.bind(null,{endpoint:"users.profile_picture_preview",rules:[{args:["source","user_id"],converters:{source:"AnyConverter",user_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"profile",isDynamic:!1},{data:"/",isDynamic:!1},{data:"picture",isDynamic:!1},{data:"/",isDynamic:!1},{data:"preview",isDynamic:!1},{data:"/",isDynamic:!1},{data:"source",isDynamic:!0}]},{args:["source"],converters:{source:"AnyConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user",isDynamic:!1},{data:"/",isDynamic:!1},{data:"profile",isDynamic:!1},{data:"/",isDynamic:!1},{data:"picture",isDynamic:!1},{data:"/",isDynamic:!1},{data:"preview",isDynamic:!1},{data:"/",isDynamic:!1},{data:"source",isDynamic:!0}]}]},"/"),_=i.default.bind(null,{endpoint:"users.save_profile_picture",rules:[{args:["user_id"],converters:{user_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"profile",isDynamic:!1},{data:"/",isDynamic:!1},{data:"picture",isDynamic:!1}]},{args:[],converters:{},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"user",isDynamic:!1},{data:"/",isDynamic:!1},{data:"profile",isDynamic:!1},{data:"/",isDynamic:!1},{data:"picture",isDynamic:!1}]}]},"/");function h({image:e,text:a,email:t,children:i,source:n}){const{input:{onChange:r,value:s}}=(0,o.useField)("source"),l=s===n;return c.createElement(d.A,{color:l?"blue":null,onClick:()=>r(n),style:l?{backgroundColor:"#f5f5f5"}:null},c.createElement(d.A.Description,null,e?c.createElement(m.A,{src:e,circular:!0,size:"tiny"}):c.createElement(p.A,{name:"question circle outline",size:"huge",className:"users-client-js-___ProfilePicture-module__placeholder___XTBq-"}),a),t&&c.createElement(g.TooltipIfTruncated,{useEventTarget:!0},c.createElement(d.A.Content,{extra:!0},c.createElement(v.Translate,null,"Based on ",c.createElement(v.Param,{name:"email",value:t})))),i&&c.createElement(d.A.Content,{extra:!0},i))}function C({onFileSelected:e}){const{submitting:a}=(0,o.useFormState)({subscription:{submitting:!0}}),{input:{onChange:t}}=(0,o.useField)("file",{allowNull:!0}),{getRootProps:i,getInputProps:n,open:r}=(0,u.VB)({onDropAccepted:([a])=>{e(a),t(a)},multiple:!1,noClick:!0,noKeyboard:!0,accept:[".png",".jpg",".jpeg",".gif",".webp"],disabled:a});return c.createElement("section",null,c.createElement("div",i(),c.createElement("input",n()),c.createElement(y.A,{disabled:a,type:"button",icon:"upload",content:v.Translate.string("Upload"),size:"small",onClick:e=>{e.stopPropagation(),r()}})))}h.propTypes={image:s().string,text:s().string.isRequired,email:s().string,children:s().node,source:s().oneOf(["standard","identicon","gravatar","custom"]).isRequired},h.defaultProps={image:null,email:null,children:null},C.propTypes={onFileSelected:s().func.isRequired};const A=(0,n.A)({field:"file",updates:e=>null===e?{}:{source:"custom"}});function w({userId:e,email:a,source:t}){const[i,n]=(0,c.useState)(null),[r,s]=(0,c.useState)("custom"===t),l=null!==e?{user_id:e}:{},u=(0,c.useCallback)((e=>{n(e),s(!0)}),[]);return c.createElement("div",{className:"users-client-js-___ProfilePicture-module__profile-picture-selection___YxVGi"},c.createElement(o.Form,{onSubmit:async e=>{const a=new FormData;"custom"===e.source&&a.append("picture",e.file),a.append("source",e.source);const t={headers:{"content-type":"multipart/form-data"}};try{await E.indicoAxios.post(_(l),a,t)}catch(e){return void(0,E.handleAxiosError)(e)}location.reload(),await new Promise((()=>{}))},initialValues:{file:null,source:t},validate:e=>"custom"!==e.source||e.file?{}:{source:"invalid"},subscription:{},decorators:[A]},(e=>c.createElement("div",null,c.createElement(D.A,{onSubmit:e.handleSubmit},c.createElement(d.A.Group,{itemsPerRow:4,centered:!0},c.createElement(h,{image:b({...l,source:"standard"}),text:v.Translate.string("System-assigned icon"),source:"standard"}),c.createElement(h,{image:b({...l,source:"identicon"}),text:"Identicon",source:"identicon",email:a}),c.createElement(h,{image:b({...l,source:"gravatar"}),text:"Gravatar",source:"gravatar",email:a}),c.createElement(h,{image:r?i?URL.createObjectURL(i):b({...l,source:"custom"}):null,text:v.Translate.string("Custom picture"),source:"custom"},c.createElement(C,{onFileSelected:u}))),c.createElement(f.FinalSubmitButton,{label:v.Translate.string("Save changes"),className:"submit-button"}))))))}w.propTypes={userId:s().number,email:s().string.isRequired,source:s().string.isRequired},w.defaultProps={userId:null},window.setupPictureSelection=function(e,a,t){document.addEventListener("DOMContentLoaded",(()=>{l.render(c.createElement(w,{userId:e,email:a,source:t}),document.querySelector("#profile-picture-selection"))}))}}},e=>{e.O(0,[4644,4394,2076],(()=>{return a=96687,e(e.s=a);var a}));e.O()}]);
//# sourceMappingURL=module_users.profile_picture.e0be2007.bundle.js.map