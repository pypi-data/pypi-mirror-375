(()=>{var be=Object.defineProperty;var ne=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var ae=(e,n,t)=>n in e?be(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,re=(e,n)=>{for(var t in n||(n={}))ye.call(n,t)&&ae(e,t,n[t]);if(ne)for(var t of ne(n))we.call(n,t)&&ae(e,t,n[t]);return e};var ie="rxxxt-on-",se=()=>new Date().getTime(),oe=new WeakMap;function F(e){var t,a,r;let n=oe.get(e);return n===void 0&&(n=JSON.stringify([e.context_id,e.handler_name,(t=e.options.debounce)!=null?t:null,(a=e.options.prevent_default)!=null?a:null,(r=e.options.throttle)!=null?r:null,...Object.entries(e.param_map).sort((l,f)=>l[0].localeCompare(f[0]))]),oe.set(e,n)),n}function xe(e){var t;let n=new Map;for(let a of e.getAttributeNames())if(a.startsWith(ie)){let r=a.substring(ie.length),l=JSON.parse(atob((t=e.getAttribute(a))!=null?t:""));n.set(r,l)}return n}function Ae(e,n){let t=e;try{for(let a of n.split("."))t=t[a];return typeof t=="string"||typeof t=="number"||typeof t=="boolean"?t:void 0}catch(a){return}}function le(e){let n=0,t=new WeakMap,a=new WeakMap,r=new Map,l=new Set,f=(o,g)=>{var p,T,v,U;let h=(p=t.get(o))!=null?p:[],E=h.filter(c=>l.has(c.descriptor.context_id));E.length!==h.length&&(t.set(o,E),x(o),h=E);for(let c of h.filter(H=>H.event===g.type)){let H=re({$handler_name:c.descriptor.handler_name},Object.fromEntries(Object.entries(c.descriptor.param_map).map(B=>[B[0],Ae(g,B[1])])));r.set(c.submitId,{context_id:c.descriptor.context_id,data:H}),c.timeoutHandle&&(clearTimeout(c.timeoutHandle),c.timeoutHandle=void 0),c.descriptor.options.prevent_default&&g.preventDefault();let L=Math.max(0,(T=c.descriptor.options.debounce)!=null?T:0,((v=c.lastCall)!=null?v:0)+((U=c.descriptor.options.throttle)!=null?U:0)-se());c.timeoutHandle=setTimeout(()=>{r.has(c.submitId)&&(c.lastCall=se(),e())},L)}},x=o=>{var E,p,T;let g=(E=a.get(o))!=null?E:new Map;a.set(o,g);let h=new Set((T=(p=t.get(o))==null?void 0:p.map(v=>v.event))!=null?T:[]);for(let v of Array.from(g.keys()))h.has(v)||(o.removeEventListener(v,g.get(v)),g.delete(v));for(let v of h)if(!g.has(v)){let U=c=>f(o,c);o.addEventListener(v,U),g.set(v,U)}},C=()=>{let o=Array.from(r.values());return r.clear(),o},k=o=>{var E;o.tagName==="RXXXT-META"&&l.add(o.id);let g=new Map(((E=t.get(o))!=null?E:[]).filter(p=>p.tag=="local").map(p=>[p.event,p])),h=xe(o);for(let p of g.values())h.has(p.event)||y(o,p.event,p.descriptor,"local");for(let p of h.entries())g.has(p[0])?g.get(p[0]).descriptor=p[1]:S(o,p[0],p[1],"local")},A=o=>{o.tagName==="RXXXT-META"&&l.delete(o.id)},S=(o,g,h,E="global")=>{var U;let p=F(h),T=(U=t.get(o))!=null?U:[];t.set(o,T);let v=T.find(c=>c.event===g&&F(c.descriptor)===p&&c.tag==E);v===void 0?T.push({descriptor:h,event:g,submitId:++n,tag:E}):v.descriptor=h,x(o)},y=(o,g,h,E="global")=>{var T;let p=F(h);t.set(o,((T=t.get(o))!=null?T:[]).filter(v=>v.event!=g||F(v.descriptor)!==p||v.tag!==E)),x(o)};return{registerEvent:S,unregisterEvent:y,onElementUpdated:k,onElementDeleted:A,popPendingEvents:C}}function de(e){let n,t=!1,a=!1,r=!1,l,f=()=>{if(t){a=!0;return}t=!0,a=!1,l(e.popPendingEvents())},x=(A,S)=>{e.onUpdate(A,S),t=!1,a&&f()},C=()=>{n==null||n.close(),n=void 0,l=async A=>{var y;let S=await fetch(location.href,{method:"POST",body:JSON.stringify({state_token:e.stateToken,events:A}),headers:{"Content-Type":"application/json"},credentials:"include"}).then(o=>o.json());x(S.html_parts,S.events),e.stateToken=(y=S.state_token)!=null?y:e.stateToken}},k=()=>{if(n!==void 0){console.warn("tried to switch to websocket again, despite using it already");return}let A=async y=>n==null?void 0:n.send(JSON.stringify({type:"update",events:y,location:location.href.substring(location.origin.length)})),S=new URL(location.href);S.protocol=location.protocol=="https:"?"wss":"ws",n=new WebSocket(S),n.addEventListener("close",C),n.addEventListener("open",()=>{l=A,n==null||n.send(JSON.stringify({type:"init",state_token:e.stateToken,enable_state_updates:e.enableWebSocketStateUpdates}))}),n.addEventListener("message",y=>{var g;if(typeof y.data!="string")return;let o=JSON.parse(y.data);e.stateToken=(g=o.state_token)!=null?g:e.stateToken,x(o.html_parts,o.events)})};return C(),{useHTTP:C,useWebSocket:k,update:()=>{r||(r=!0,setTimeout(()=>{r=!1,f()},0))}}}var pe=11;function Se(e,n){var t=n.attributes,a,r,l,f,x;if(!(n.nodeType===pe||e.nodeType===pe)){for(var C=t.length-1;C>=0;C--)a=t[C],r=a.name,l=a.namespaceURI,f=a.value,l?(r=a.localName||r,x=e.getAttributeNS(l,r),x!==f&&(a.prefix==="xmlns"&&(r=a.name),e.setAttributeNS(l,r,f))):(x=e.getAttribute(r),x!==f&&e.setAttribute(r,f));for(var k=e.attributes,A=k.length-1;A>=0;A--)a=k[A],r=a.name,l=a.namespaceURI,l?(r=a.localName||r,n.hasAttributeNS(l,r)||e.removeAttributeNS(l,r)):n.hasAttribute(r)||e.removeAttribute(r)}}var G,Ce="http://www.w3.org/1999/xhtml",w=typeof document>"u"?void 0:document,Ue=!!w&&"content"in w.createElement("template"),Oe=!!w&&w.createRange&&"createContextualFragment"in w.createRange();function ke(e){var n=w.createElement("template");return n.innerHTML=e,n.content.childNodes[0]}function Ne(e){G||(G=w.createRange(),G.selectNode(w.body));var n=G.createContextualFragment(e);return n.childNodes[0]}function De(e){var n=w.createElement("body");return n.innerHTML=e,n.childNodes[0]}function _e(e){return e=e.trim(),Ue?ke(e):Oe?Ne(e):De(e)}function J(e,n){var t=e.nodeName,a=n.nodeName,r,l;return t===a?!0:(r=t.charCodeAt(0),l=a.charCodeAt(0),r<=90&&l>=97?t===a.toUpperCase():l<=90&&r>=97?a===t.toUpperCase():!1)}function Ie(e,n){return!n||n===Ce?w.createElement(e):w.createElementNS(n,e)}function He(e,n){for(var t=e.firstChild;t;){var a=t.nextSibling;n.appendChild(t),t=a}return n}function Q(e,n,t){e[t]!==n[t]&&(e[t]=n[t],e[t]?e.setAttribute(t,""):e.removeAttribute(t))}var ue={OPTION:function(e,n){var t=e.parentNode;if(t){var a=t.nodeName.toUpperCase();a==="OPTGROUP"&&(t=t.parentNode,a=t&&t.nodeName.toUpperCase()),a==="SELECT"&&!t.hasAttribute("multiple")&&(e.hasAttribute("selected")&&!n.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),t.selectedIndex=-1)}Q(e,n,"selected")},INPUT:function(e,n){Q(e,n,"checked"),Q(e,n,"disabled"),e.value!==n.value&&(e.value=n.value),n.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,n){var t=n.value;e.value!==t&&(e.value=t);var a=e.firstChild;if(a){var r=a.nodeValue;if(r==t||!t&&r==e.placeholder)return;a.nodeValue=t}},SELECT:function(e,n){if(!n.hasAttribute("multiple")){for(var t=-1,a=0,r=e.firstChild,l,f;r;)if(f=r.nodeName&&r.nodeName.toUpperCase(),f==="OPTGROUP")l=r,r=l.firstChild;else{if(f==="OPTION"){if(r.hasAttribute("selected")){t=a;break}a++}r=r.nextSibling,!r&&l&&(r=l.nextSibling,l=null)}e.selectedIndex=t}}},W=1,ce=11,fe=3,ve=8;function _(){}function Me(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}function Pe(e){return function(t,a,r){if(r||(r={}),typeof a=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var l=a;a=w.createElement("html"),a.innerHTML=l}else a=_e(a);else a.nodeType===ce&&(a=a.firstElementChild);var f=r.getNodeKey||Me,x=r.onBeforeNodeAdded||_,C=r.onNodeAdded||_,k=r.onBeforeElUpdated||_,A=r.onElUpdated||_,S=r.onBeforeNodeDiscarded||_,y=r.onNodeDiscarded||_,o=r.onBeforeElChildrenUpdated||_,g=r.skipFromChildren||_,h=r.addChild||function(i,s){return i.appendChild(s)},E=r.childrenOnly===!0,p=Object.create(null),T=[];function v(i){T.push(i)}function U(i,s){if(i.nodeType===W)for(var m=i.firstChild;m;){var d=void 0;s&&(d=f(m))?v(d):(y(m),m.firstChild&&U(m,s)),m=m.nextSibling}}function c(i,s,m){S(i)!==!1&&(s&&s.removeChild(i),y(i),U(i,m))}function H(i){if(i.nodeType===W||i.nodeType===ce)for(var s=i.firstChild;s;){var m=f(s);m&&(p[m]=s),H(s),s=s.nextSibling}}H(t);function L(i){C(i);for(var s=i.firstChild;s;){var m=s.nextSibling,d=f(s);if(d){var u=p[d];u&&J(s,u)?(s.parentNode.replaceChild(u,s),X(u,s)):L(s)}else L(s);s=m}}function B(i,s,m){for(;s;){var d=s.nextSibling;(m=f(s))?v(m):c(s,i,!0),s=d}}function X(i,s,m){var d=f(s);if(d&&delete p[d],!m){var u=k(i,s);if(u===!1||(u instanceof HTMLElement&&(i=u,H(i)),e(i,s),A(i),o(i,s)===!1))return}i.nodeName!=="TEXTAREA"?Ee(i,s):ue.TEXTAREA(i,s)}function Ee(i,s){var m=g(i,s),d=s.firstChild,u=i.firstChild,P,O,R,$,N;e:for(;d;){for($=d.nextSibling,P=f(d);!m&&u;){if(R=u.nextSibling,d.isSameNode&&d.isSameNode(u)){d=$,u=R;continue e}O=f(u);var j=u.nodeType,D=void 0;if(j===d.nodeType&&(j===W?(P?P!==O&&((N=p[P])?R===N?D=!1:(i.insertBefore(N,u),O?v(O):c(u,i,!0),u=N,O=f(u)):D=!1):O&&(D=!1),D=D!==!1&&J(u,d),D&&X(u,d)):(j===fe||j==ve)&&(D=!0,u.nodeValue!==d.nodeValue&&(u.nodeValue=d.nodeValue))),D){d=$,u=R;continue e}O?v(O):c(u,i,!0),u=R}if(P&&(N=p[P])&&J(N,d))m||h(i,N),X(N,d);else{var Y=x(d);Y!==!1&&(Y&&(d=Y),d.actualize&&(d=d.actualize(i.ownerDocument||w)),h(i,d),L(d))}d=$,u=R}B(i,u,O);var te=ue[i.nodeName];te&&te(i,s)}var b=t,K=b.nodeType,ee=a.nodeType;if(!E){if(K===W)ee===W?J(t,a)||(y(t),b=He(t,Ie(a.nodeName,a.namespaceURI))):b=a;else if(K===fe||K===ve){if(ee===K)return b.nodeValue!==a.nodeValue&&(b.nodeValue=a.nodeValue),b;b=a}}if(b===a)y(t);else{if(a.isSameNode&&a.isSameNode(b))return;if(X(b,a,E),T)for(var z=0,Te=T.length;z<Te;z++){var q=p[T[z]];q&&c(q,q.parentNode,!1)}}return!E&&b!==t&&t.parentNode&&(b.actualize&&(b=b.actualize(t.ownerDocument||w)),t.parentNode.replaceChild(b,t)),b}}var Re=Pe(Se),ge=Re;var Le="root",I,me={stateToken:"",enableWebSocketStateUpdates:!1,onUpdate:(e,n)=>{for(let t of e)he(t);Z(n)},popPendingEvents:()=>M.popPendingEvents()},V=de(me),M=le(V.update),he=e=>{let n;if(e===void 0){let t=document.getElementById(Le);if(t===null)throw new Error("Update target not found!");n=t}else{let t=document.createElement("div");t.innerHTML=e;let a=t.children.item(0);if(a===null||a.tagName!=="rxxxt-meta".toUpperCase())throw new Error("Invalid update root!");let r=document.getElementById(a.id);if(r===null)throw new Error("Update target not found!");n=r,ge(n,a,{onNodeDiscarded:l=>{l instanceof Element&&M.onElementDeleted(l)}})}for(let t of n.getElementsByTagName("*"))M.onElementUpdated(t)},We={navigate:e=>{let n=new URL(e.location,location.href);I===void 0||I.origin!==n.origin||!n.pathname.startsWith(I.pathname)?location.assign(n):(window.history.pushState({},"",e.location),V.update())},"use-websocket":e=>{e.websocket?V.useWebSocket():V.useHTTP()},"set-cookie":e=>{var t;let n=["".concat(e.name,"=").concat((t=e.value)!=null?t:"")];typeof e.path=="string"&&n.push("path=".concat(e.path)),typeof e.expires=="string"&&n.push("expires=".concat(new Date(e.expires).toUTCString())),typeof e.max_age=="number"&&n.push("max-age=".concat(e.max_age)),typeof e.domain=="string"&&n.push("domain=".concat(e.domain)),e.secure&&n.push("secure"),e.http_only&&n.push("httponly"),document.cookie=n.join(";")},"event-modify-window":e=>{e.mode==="add"?M.registerEvent(window,e.name,e.descriptor):e.mode==="remove"&&M.unregisterEvent(window,e.name,e.descriptor)},"event-modify-query-selector":e=>{let n;if(e.all)n=Array.from(document.querySelectorAll(e.selector));else{let t=document.querySelector(e.selector);n=t===null?[]:[t]}for(let t of n)e.mode==="add"?M.registerEvent(t,e.name,e.descriptor):e.mode==="remove"&&M.unregisterEvent(t,e.name,e.descriptor)}},Z=e=>e.forEach(n=>We[n.event](n));window.rxxxt={navigate:e=>Z([{event:"navigate",location:new URL(e,location.href).href}]),init:e=>{I=new URL(location.href),I.pathname.endsWith(e.path)?I.pathname=I.pathname.slice(0,I.pathname.length-e.path.length):console.warn("Invalid base url!"),window.addEventListener("popstate",V.update),me.stateToken=e.state_token,Z(e.events),he()}};})();
