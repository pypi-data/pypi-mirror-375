{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "LLM Code Change Proposal",
    "type": "object",
    "additionalProperties": false,
    "properties": {
        "summary": {
            "description": "Brief summary of proposed changes.",
            "type": "string",
            "minLength": 1
        },
        "changes": {
            "description": "List of file changes to apply in order.",
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                    "filePath": {
                        "description": "POSIX-style relative path from repo root (no leading './').",
                        "type": "string",
                        "pattern": "^(?!\\./).+"
                    },
                    "action": {
                        "description": "Operation to perform.",
                        "type": "string",
                        "enum": [
                            "REPLACE",
                            "CREATE",
                            "DELETE"
                        ]
                    },
                    "content": {
                        "description": "Full file content for CREATE/REPLACE; empty string for DELETE.",
                        "type": "string"
                    },
                    "encoding": {
                        "description": "Optional encoding for binary assets; omit for text. Use 'base64' when set.",
                        "type": "string",
                        "enum": [
                            "base64"
                        ]
                    }
                },
                "required": [
                    "filePath",
                    "action",
                    "content"
                ],
                "allOf": [
                    {
                        "if": {
                            "properties": {
                                "action": {
                                    "const": "DELETE"
                                }
                            }
                        },
                        "then": {
                            "properties": {
                                "content": {
                                    "maxLength": 0
                                },
                                "encoding": false
                            }
                        }
                    },
                    {
                        "if": {
                            "properties": {
                                "action": {
                                    "enum": [
                                        "CREATE",
                                        "REPLACE"
                                    ]
                                }
                            }
                        },
                        "then": {
                            "properties": {
                                "content": {
                                    "minLength": 1
                                }
                            }
                        }
                    }
                ]
            }
        }
    },
    "required": [
        "summary",
        "changes"
    ]
}