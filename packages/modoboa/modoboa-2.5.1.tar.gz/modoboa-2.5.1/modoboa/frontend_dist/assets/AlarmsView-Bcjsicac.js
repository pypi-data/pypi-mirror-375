import{d as U}from"./index-DuzUMVLM.js";import{C as V,_ as T,b as G,n as q,g as h,c as k,w as a,a as s,e as H,f as d,v as D,k as n,t as m,l as x,F as w,i as y,o as u}from"./index-LhNzkzAh.js";import{_ as S}from"./MenuItems-BqIZW5av.js";import{V as N}from"./VMenu-nv0XOgg0.js";import{V as M,c as J}from"./VAvatar-DbuoZWmf.js";import{V as L}from"./VChip-CaQvfmkw.js";import{V as E,a as K}from"./VToolbar-BxX3W2kR.js";import{V as Q}from"./VTextField-DKbr4H5w.js";import{V as W}from"./forwardRefs-CpzzjgpX.js";import{V as X}from"./VDataTableServer-BqvNcIdw.js";import{a as Y}from"./VCard-DzjUT5OP.js";import"./VProgressCircular-qK6p5X_Y.js";import"./tag-3cfI1_f7.js";import"./VInput-DVKUObZe.js";import"./ssrBoot-BxIQ9ccA.js";import"./VDataTable-CL7yHvG7.js";import"./VSelect-CxCFMHyF.js";import"./VCheckboxBtn-CpFdBnTv.js";import"./VSelectionControl-C-6A4us5.js";import"./VTable-ldTxgQPW.js";import"./filter-rmxrcjKk.js";const b="alarms",v={getAll(i){return V.get(`${b}/`,{params:i})},switchStatus(i,e){return V.patch(`${b}/${i}/switch/`,e)},delete(i){return V.delete(`${b}/${i}/`)},bulkDelete(i){return V.post(`${b}/bulk_delete/`,{ids:i})}},Z={class:"text-right"},ee={__name:"AlarmList",setup(i){const{$gettext:e}=G(),p=q(),C=h([]),A=h(!1),f=h(""),g=h([]),$=h(0),O=[{title:e("Triggered"),key:"created"},{title:e("Status"),key:"status"},{title:e("Domain"),key:"domain.name",sortable:!1},{title:e("Mailbox"),key:"mailbox",sortable:!1},{title:e("Message"),key:"title"},{title:e("Actions"),key:"actions",sortable:!1,align:"right"}],z=[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"}];function I(){const l=[];return g.value.length>0&&l.push({label:e("Delete"),icon:"mdi-delete-outline",onClick:B,color:"red"}),l.push({label:e("Reload"),icon:"mdi-reload",onClick:r}),l}function P(l){const o=[];return o.push({label:e("Delete"),icon:"mdi-delete-outline",onClick:R,color:"red"}),l.status===y.ALARM_OPENED?o.push({label:e("Close alarm"),icon:"mdi-check",onClick:j,color:"green"}):o.push({label:e("Reopen alarm"),icon:"mdi-alert-circle-outline",onClick:F,color:"orange"}),o}function r({page:l,itemsPerPage:o,sortBy:t}){const _={page:l||1,page_size:o||10};t&&t.length&&(_.ordering=t.map(c=>c.order!=="asc"?`-${c.key}`:c.key).join(",")),f.value!==""&&(_.search=f.value),A.value=!0,v.getAll(_).then(c=>{C.value=c.data.results,$.value=c.data.count,A.value=!1})}async function R(l,o=!0){v.delete(l.id).then(()=>{o&&(p.displayNotification({msg:e("Alarm deleted")}),r({}))})}async function B(){await v.bulkDelete(g.value),p.displayNotification({msg:e("Alarms deleted")}),g.value=[],r({})}async function j(l){v.switchStatus(l.id,{status:y.ALARM_CLOSED}).then(()=>{p.displayNotification({msg:e("Alarm closed")}),r({})})}async function F(l){v.switchStatus(l.id,{status:y.ALARM_OPENED}).then(()=>{p.displayNotification({msg:e("Alarm re-opened")}),r({})})}return r=U(r,500),(l,o)=>(u(),k(Y,{class:"mt-6"},{default:a(()=>[s(X,{modelValue:g.value,"onUpdate:modelValue":o[1]||(o[1]=t=>g.value=t),headers:O,items:C.value,search:f.value,"item-value":"id","items-length":$.value,"items-per-page-options":z,loading:A.value,elevation:"0","show-select":"","onUpdate:options":r},{top:a(()=>[s(E,{color:"white",flat:""},{default:a(()=>[s(Q,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=t=>f.value=t),"prepend-inner-icon":"mdi-magnify",placeholder:d(e)("Search"),density:"compact",variant:"outlined","hide-details":"",flat:"","single-line":"",class:"flex-grow-0 w-33 mr-4"},null,8,["modelValue","placeholder"]),s(N,{location:"bottom"},{activator:a(({props:t})=>[s(M,D(t,{size:"small"}),{default:a(()=>[n(m(d(e)("Actions"))+" ",1),s(J,{right:""},{default:a(()=>o[2]||(o[2]=[n("mdi-chevron-down")])),_:1,__:[2]})]),_:2},1040)]),default:a(()=>[s(W,{density:"compact"},{default:a(()=>[s(d(S),{items:I()},null,8,["items"])]),_:1})]),_:1})]),_:1})]),"item.status":a(({item:t})=>[t.status===1?(u(),k(L,{key:0,color:"warning",size:"small"},{default:a(()=>[n(m(d(e)("Opened")),1)]),_:1})):(u(),k(L,{key:1,color:"info",size:"small"},{default:a(()=>[n(m(d(e)("Closed")),1)]),_:1}))]),"item.mailbox":a(({item:t})=>[t.mailbox?(u(),x(w,{key:0},[n(m(t.mailbox.address)+"@"+m(t.domain.name),1)],64)):(u(),x(w,{key:1},[n(" / ")],64))]),"item.created":a(({item:t})=>[n(m(l.$date(t.created)),1)]),"item.actions":a(({item:t})=>[H("div",Z,[s(N,{location:"bottom"},{activator:a(({props:_})=>[s(M,D({icon:"mdi-dots-horizontal"},_,{variant:"text"}),null,16)]),default:a(()=>[s(d(S),{items:P(t),obj:t},null,8,["items","obj"])]),_:2},1024)])]),_:2},1032,["modelValue","items","search","items-length","loading"])]),_:1}))}},te=T(ee,[["__scopeId","data-v-dd012795"]]),ae={__name:"AlarmsView",setup(i){return(e,p)=>(u(),x(w,null,[s(E,{flat:""},{default:a(()=>[s(K,null,{default:a(()=>[n(m(e.$gettext("Opened alarms")),1)]),_:1})]),_:1}),s(te)],64))}},xe=T(ae,[["__scopeId","data-v-d7e4ea18"]]);export{xe as default};
