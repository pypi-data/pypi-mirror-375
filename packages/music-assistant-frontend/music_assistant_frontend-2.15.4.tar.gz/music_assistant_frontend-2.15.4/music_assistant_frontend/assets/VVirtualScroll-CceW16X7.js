import{g as W,p as N,aG as X,w as _,D as Y,E as V,I as Z,G as oe,P as j,m as re,s as T,e as G,x as K,c as D,f as J,cY as ue,cr as ce,d as E,R as ie,cy as fe,c2 as ve,af as de,z as me,u as he,F as ge,a as O,ag as pe,ah as ye,ai as Se,o as we,cZ as Ve}from"./index-B-lUZalq.js";const Te=N({renderless:Boolean,...j()},"VVirtualScrollItem"),Ie=W()({name:"VVirtualScrollItem",inheritAttrs:!1,props:Te(),emits:{"update:height":l=>!0},setup(l,a){let{attrs:f,emit:s,slots:n}=a;const{resizeRef:o,contentRect:c}=X(void 0,"border");_(()=>c.value?.height,g=>{g!=null&&s("update:height",g)}),Y(()=>l.renderless?V(Z,null,[n.default?.({itemRef:o})]):V("div",oe({ref:o,class:["v-virtual-scroll__item",l.class],style:l.style},f),[n.default?.()]))}}),Re=-1,Pe=1,H=100,xe=N({itemHeight:{type:[Number,String],default:null},itemKey:{type:[String,Array,Function],default:null},height:[Number,String]},"virtual");function be(l,a){const f=re(),s=T(0);G(()=>{s.value=parseFloat(l.itemHeight||0)});const n=T(0),o=T(Math.ceil((parseInt(l.height)||f.height.value)/(s.value||16))||1),c=T(0),g=T(0),u=K(),m=K();let I=0;const{resizeRef:A,contentRect:x}=X();G(()=>{A.value=u.value});const y=D(()=>u.value===document.documentElement?f.height.value:x.value?.height||parseInt(l.height)||0),z=D(()=>!!(u.value&&m.value&&y.value&&s.value));let h=Array.from({length:a.value.length}),i=Array.from({length:a.value.length});const v=T(0);let b=-1;function Q(e){return h[e]||s.value}const k=ue(()=>{const e=performance.now();i[0]=0;const t=a.value.length;for(let r=1;r<=t-1;r++)i[r]=(i[r-1]||0)+Q(r-1);v.value=Math.max(v.value,performance.now()-e)},v),$=_(z,e=>{e&&($(),I=m.value.offsetTop,k.immediate(),S(),~b&&ie(()=>{fe&&window.requestAnimationFrame(()=>{L(b),b=-1})}))});J(()=>{k.clear()});function ee(e,t){const r=h[e],d=s.value;s.value=d?Math.min(s.value,t):t,(r!==t||d!==s.value)&&(h[e]=t,k())}function p(e){e=E(e,0,a.value.length-1);const t=Math.floor(e),r=e%1,d=t+1,P=i[t]||0,w=i[d]||P;return P+(w-P)*r}function C(e){return ke(i,e)}let F=0,R=0,M=0;_(y,(e,t)=>{t&&(S(),e<t&&requestAnimationFrame(()=>{R=0,S()}))});let B=-1;function te(){if(!u.value||!m.value)return;const e=u.value.scrollTop,t=performance.now();t-M>500?(R=Math.sign(e-F),I=m.value.offsetTop):R=e-F,F=e,M=t,window.clearTimeout(B),B=window.setTimeout(U,500),S()}function U(){!u.value||!m.value||(R=0,M=0,window.clearTimeout(B),S())}let q=-1;function S(){cancelAnimationFrame(q),q=requestAnimationFrame(le)}function le(){if(!u.value||!y.value||!s.value)return;const e=F-I,t=Math.sign(R),r=Math.max(0,e-H),d=E(C(r),0,a.value.length),P=e+y.value+H,w=E(C(P)+1,d+1,a.value.length);if((t!==Re||d<n.value)&&(t!==Pe||w>o.value)){const ne=p(n.value)-p(d),se=p(w)-p(o.value);Math.max(ne,se)>H?(n.value=d,o.value=w):(d<=0&&(n.value=d),w>=a.value.length&&(o.value=w))}c.value=p(n.value),g.value=p(a.value.length)-p(o.value)}function L(e){const t=p(e);!u.value||e&&!t?b=e:u.value.scrollTop=t}const ae=D(()=>a.value.slice(n.value,o.value).map((e,t)=>{const r=t+n.value;return{raw:e,index:r,key:ce(e,l.itemKey,r)}}));return _(a,()=>{h=Array.from({length:a.value.length}),i=Array.from({length:a.value.length}),k.immediate(),S()},{deep:1}),{calculateVisibleItems:S,containerRef:u,markerRef:m,computedItems:ae,paddingTop:c,paddingBottom:g,scrollToIndex:L,handleScroll:te,handleScrollend:U,handleItemResize:ee}}function ke(l,a){let f=l.length-1,s=0,n=0,o=null,c=-1;if(l[f]<a)return f;for(;s<=f;)if(n=s+f>>1,o=l[n],o>a)f=n-1;else if(o<a)c=n,s=n+1;else return o===a?n:s;return c}const Fe=N({items:{type:Array,default:()=>[]},renderless:Boolean,...xe(),...j(),...Se()},"VVirtualScroll"),Ae=W()({name:"VVirtualScroll",props:Fe(),setup(l,a){let{slots:f}=a;const s=ve("VVirtualScroll"),{dimensionStyles:n}=de(l),{calculateVisibleItems:o,containerRef:c,markerRef:g,handleScroll:u,handleScrollend:m,handleItemResize:I,scrollToIndex:A,paddingTop:x,paddingBottom:y,computedItems:z}=be(l,me(()=>l.items));return he(()=>l.renderless,()=>{function h(){const v=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)?"addEventListener":"removeEventListener";c.value===document.documentElement?(document[v]("scroll",u,{passive:!0}),document[v]("scrollend",m)):(c.value?.[v]("scroll",u,{passive:!0}),c.value?.[v]("scrollend",m))}we(()=>{c.value=Ve(s.vnode.el,!0),h(!0)}),J(h)}),Y(()=>{const h=z.value.map(i=>ge(Ie,{key:i.key,renderless:l.renderless,"onUpdate:height":v=>I(i.index,v)},{default:v=>f.default?.({item:i.raw,index:i.index,...v})}));return l.renderless?V(Z,null,[V("div",{ref:g,class:"v-virtual-scroll__spacer",style:{paddingTop:O(x.value)}},null),h,V("div",{class:"v-virtual-scroll__spacer",style:{paddingBottom:O(y.value)}},null)]):V("div",{ref:c,class:ye(["v-virtual-scroll",l.class]),onScrollPassive:u,onScrollend:m,style:pe([n.value,l.style])},[V("div",{ref:g,class:"v-virtual-scroll__container",style:{paddingTop:O(x.value),paddingBottom:O(y.value)}},[h])])}),{calculateVisibleItems:o,scrollToIndex:A}}});export{Ae as V};
