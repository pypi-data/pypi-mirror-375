# This file is auto-generated by generate_tools.py. DO NOT EDIT.
import logging
from pydantic import ValidationError
from multiconn_archicad.basic_types import Port
from tapir_archicad_mcp.context import multi_conn_instance
from tapir_archicad_mcp.tools.tool_registry import register_tool_for_dispatch

from multiconn_archicad.models.official.commands import (
    GetElementsRelatedToZonesParameters,
GetElementsRelatedToZonesResult
)


log = logging.getLogger()

def get_elements_related_to_zones(port: int, params: GetElementsRelatedToZonesParameters) -> GetElementsRelatedToZonesResult:
    """
    Returns related elements of the given zones. The related elements will be grouped by type. If multiple zones was given, then the order of the returned list is that of the given zones.
    """
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_command(
            command="API.GetElementsRelatedToZones",
            parameters=params.model_dump(mode='json')
        )
        return GetElementsRelatedToZonesResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for GetElementsRelatedToZones result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing GetElementsRelatedToZones on port {port}: {e}")
        raise e


register_tool_for_dispatch(
    get_elements_related_to_zones,
    name="elements_get_elements_related_to_zones",
    title="GetElementsRelatedToZones",
    description="Returns related elements of the given zones. The related elements will be grouped by type. If multiple zones was given, then the order of the returned list is that of the given zones.",
    params_model=GetElementsRelatedToZonesParameters,
    result_model=GetElementsRelatedToZonesResult
)
