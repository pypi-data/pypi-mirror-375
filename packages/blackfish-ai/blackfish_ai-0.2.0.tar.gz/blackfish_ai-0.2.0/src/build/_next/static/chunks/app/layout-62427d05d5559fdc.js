(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{721:function(e,t,n){Promise.resolve().then(n.bind(n,5693))},8516:function(e,t,n){"use strict";n.d(t,{JT:function(){return d},ZP:function(){return h},am:function(){return f}});var s=n(7437),r=n(2265),o=n(2219),i=n(4630),a=n(9124),l=n(2871),c=n(408),u=n(3680);let d=(0,r.createContext)(),f=e=>{let{children:t}=e,[n,o]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=localStorage.getItem("profile"),t=e?JSON.parse(e):null;console.debug("Restored profile",t),o(t)},[]),(0,s.jsx)(d.Provider,{value:{profile:n,setProfile:e=>{localStorage.setItem("profile",JSON.stringify(e)),o(e)}},children:t})};function h(e){let{selectedProfile:t,setSelectedProfile:n}=e,{profiles:r,error:d,isLoading:f}=(0,c.nw)();return f?(0,s.jsx)("div",{children:"Loading profiles..."}):d?(0,s.jsx)("div",{children:"Error!"}):0===r.length?(0,s.jsx)("div",{children:"No profiles found."}):(0,s.jsxs)(o.Ri,{value:t,onChange:n,children:[(0,s.jsx)(i.__,{className:"mt-2 block text-sm font-medium leading-6 text-gray-900",children:"Profile"}),t&&!r.map(e=>e.name).includes(t.name)&&(0,s.jsx)("div",{children:"Profile is missing."}),(0,s.jsxs)("div",{className:"relative mt-2 mb-2",children:[t?(0,s.jsx)(o.Y4,{className:"relative w-full cursor-default rounded-md bg-white py-1.5 pl-1 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:text-sm sm:leading-6",children:(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"ml-3 block truncate",children:t.name?t.name:""}),(0,s.jsxs)("span",{className:"ml-2 text-slate-400 text-sm font-light",children:["@",t.host?t.host:"localhost"]}),(0,s.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,s.jsx)(a.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]})}):(0,s.jsx)(o.Y4,{className:"relative w-full cursor-default rounded-md bg-white py-1.5 pl-1 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:text-sm sm:leading-6",children:(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"pointer-events-none flex-shrink-0 pl-3",children:(0,s.jsx)(u.Z,{className:"h-5 w-5 text-yellow-400","aria-hidden":"true"})}),(0,s.jsx)("span",{className:"ml-3 block truncate",children:"No profile selected"}),(0,s.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,s.jsx)(a.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]})}),(0,s.jsx)(o.O_,{className:"absolute z-10 mt-1 max-h-60 overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm w-[var(--button-width)]",anchor:"bottom",children:r.map(e=>(0,s.jsxs)(o.wt,{value:e,className:"group flex gap-2 bg-white data-[focus]:bg-blue-500 data-[focus]:text-white relative cursor-default select-none py-2 pl-1 pr-9 text-gray-900",children:[(0,s.jsx)("div",{className:"flex",children:(0,s.jsx)("span",{className:"ml-3 block truncate font-normal data-[selected]:font-semibold",children:e.name})}),(0,s.jsxs)("span",{className:"ml-1 text-slate-400 text-sm font-light data-[selected]:text-gray-100",children:["@",e.host?e.host:"localhost"]}),(0,s.jsx)("span",{className:"invisible group-data-[selected]:visible absolute inset-y-0 right-0 flex items-center pr-4 group-data-[focus]:text-white text-blue-600",children:(0,s.jsx)(l.Z,{className:"size-5"})})]},e.name))})]})]})}},9657:function(e,t,n){"use strict";n.d(t,{L:function(){return o},Z:function(){return r}});var s=n(257);function r(){let e=s.env.NEXT_PUBLIC_BLACKFISH_DOMAIN||"",t=s.env.NEXT_PUBLIC_BLACKFISH_HOST||"localhost",n=s.env.NEXT_PUBLIC_BLACKFISH_PORT||8e3;return e?"https://".concat(e,"/").concat(t,"/").concat(n,"/api"):"http://".concat(t,":").concat(n,"/api")}function o(){let e=s.env.NEXT_PUBLIC_BLACKFISH_DOMAIN||"",t=s.env.NEXT_PUBLIC_BLACKFISH_HOST||"localhost",n=s.env.NEXT_PUBLIC_BLACKFISH_PORT||8e3;return e?"https://".concat(e,"/").concat(t,"/").concat(n):"http://".concat(t,":").concat(n)}},5693:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var s=n(7437),r=n(6722),o=n.n(r);n(7960);var i=n(9376),a=n(8516),l=n(1886),c=n(2265),u=n(4405),d=n(3577),f=n(3145),h=n(7648),m=n(5129),p=n(7165),x=n(7203);function g(e){let{task:t}=e,n=(0,i.usePathname)().endsWith("login"),[r,o]=(0,c.useState)(!1),a=()=>o(!0),g=()=>o(!1);return(0,s.jsx)(l.pJ,{as:"nav",className:"bg-white",children:e=>{let{open:o}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex h-16 justify-between",children:[(0,s.jsx)("div",{className:"flex",children:(0,s.jsxs)("div",{className:"flex flex-shrink-0 items-center",children:[(0,s.jsx)(h.default,{href:"/dashboard",children:(0,s.jsx)(f.default,{height:"32",width:"32",src:(0,x.nC)("/img/orca.png"),alt:"blackfish"})}),(0,s.jsx)(h.default,{href:"/dashboard",children:(0,s.jsx)("div",{className:"pl-4 text-4xl text-gray-900 font-bold",children:"blackfish"})}),(0,s.jsx)("div",{className:"pl-4 text-4xl font-extralight text-slate-300 italic",children:t})]})}),!n&&(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)("button",{onClick:a,className:"text-black hover:text-blue-600 focus:outline-none transition-transform transform hover:scale-110","aria-label":"Help",children:(0,s.jsx)(m.Z,{className:"h-6 w-6"})})})]})}),r&&(0,s.jsx)(u.Vq,{open:r,onClose:g,className:"fixed inset-0 z-10 flex items-center justify-center p-4 bg-black bg-opacity-50",children:(0,s.jsxs)(u.EM,{className:"relative rounded-lg bg-white p-6 sm:max-w-lg shadow-md",children:[(0,s.jsx)("button",{onClick:g,className:"absolute top-3 right-3 text-black hover:text-gray-700 focus:outline-none","aria-label":"Close",children:(0,s.jsx)(p.Z,{className:"h-5 w-5"})}),(0,s.jsx)(u.$N,{className:"text-lg font-bold",children:"Having issues?"}),(0,s.jsx)(d.dk,{className:"mt-2 text-sm text-gray-600",children:"Check out our issues page on GitHub. There, you can search for known bugs, find solutions to common problems, or create a new issue if nothing seems to meet your needs. Go aheadâ€”drop us a line!"}),(0,s.jsx)("div",{className:"mt-5 sm:mt-6 sm:grid sm:grid-flow-row-dense sm:grid-cols-2 sm:gap-3",children:(0,s.jsx)("a",{type:"button",href:"https://github.com/princeton-ddss/blackfish/issues",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600 sm:col-start-2",children:"View on GitHub"})})]})})]})}})}function b(e){let{children:t}=e,n=(0,i.usePathname)();return(0,s.jsxs)("html",{lang:"en",children:[(0,s.jsx)("link",{rel:"icon",href:"/img/favicon.ico",sizes:"any"}),(0,s.jsx)("body",{className:o().className,children:(0,s.jsxs)(a.am,{children:[(0,s.jsx)(g,{task:n.slice(1)}),t]})})]})}},408:function(e,t,n){"use strict";n.d(t,{Su:function(){return a},bP:function(){return i},nw:function(){return l},of:function(){return c}});var s=n(3861),r=n(3347),o=n(7203);let i=(e,t)=>{let{data:n,error:o,isLoading:i}=(0,s.ZP)("models?profile=".concat(e?e.name:"default","&image=").concat(t),r.fm);return{models:n,error:o,isLoading:i}},a=(e,t)=>{let{data:n,error:i,isLoading:a,mutate:l}=(0,s.ZP)(()=>!!e&&"services?profile=".concat(e?e.name:null,"&image=").concat(t.replace("-","_")),r.Qz,{refreshInterval:3e4}),c=[o.$J.HEALTHY,o.$J.STARTING,o.$J.PENDING,o.$J.SUBMITTED,o.$J.STOPPED,o.$J.EXPIRED,o.$J.TIMEOUT,o.$J.FAILED];return{services:n?[...n].sort((e,t)=>{let n=c.indexOf(e.status)-c.indexOf(t.status);return 0!==n?n:new Date(t.created_at)-new Date(e.created_at)}):[],error:i,isLoading:a,mutate:l}},l=()=>{let{data:e,error:t,isLoading:n,mutate:o}=(0,s.ZP)("profiles",r.lU);return{profiles:e,error:t,isLoading:n,mutate:o}},c=e=>{let{data:t,error:n,isLoading:o,mutate:i}=(0,s.ZP)(e?"files?path=".concat(e):null,r.uB);return{files:t,error:n,isLoading:o,refresh:i}}},3347:function(e,t,n){"use strict";n.d(t,{Pp:function(){return u},Qz:function(){return i},UY:function(){return l},fm:function(){return o},lU:function(){return a},uB:function(){return r},wo:function(){return d}});let s=(0,n(9657).Z)();async function r(e){let t=await fetch("".concat(s,"/").concat(e));if(!t.ok){console.debug("from fetchFiles: failed to fetch files (status=".concat(t.status,")"));let e=Error("Failed to fetch files.");throw e.status=t.status,e}return t.json()}async function o(e){let t=await fetch("".concat(s,"/").concat(e,"&refresh=true"));if(!t.ok){console.debug("from fetchModels: failed to fetch models (status=".concat(t.status,")"));let e=Error("Failed to fetch models.");throw e.status=t.status,e}return(await t.json()).map(e=>({repo_id:e.repo,revision:e.revision,profile:e.profile,image:e.image,model_dir:e.model_dir}))}async function i(e){let t=await fetch("".concat(s,"/").concat(e));if(!t.ok){console.debug("from fetchServices: failed to fetch services (status=".concat(t.status,")"));let e=Error("Failed to fetch services.");throw e.status=t.status,e}return await t.json()}async function a(){let e=await fetch("".concat(s,"/profiles"));if(!e.ok){console.debug("from fetchProfiles: failed to fetch profiles (status=".concat(e.status,")"));let t=Error("Failed to fetch profiles.");throw t.status=e.status,t}return await e.json()}async function l(e,t,n,r,o){let i;if("slurm"===o.type)i={name:n.name,image:e.replace("-","_"),repo_id:t.repo_id,profile:o,container_config:{...r,revision:t.revision,model_dir:"speech-recognition"===e?c(t.model_dir):t.model_dir,port:null},job_config:n,mount:r.input_dir,grace_period:180};else if("local"===o.type){let a=await fetch("".concat(s,"/ports"));if(!a.ok){let e=Error("Unable to find available local port");throw e.status=a.status,e}let l=await a.json();i={name:n.name,image:e.replace("-","_"),repo_id:t.repo_id,profile:o,container_config:{...r,revision:t.revision,model_dir:"speech-recognition"===e?c(t.model_dir):t.model_dir,port:l},job_config:{gres:n.gres},mount:r.input_dir,grace_period:180}}else throw Error("Unsupported job profile type: ".concat(o.type));return console.debug("from runService: body =",i),await fetch("".concat(s,"/services"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})}function c(e){let t=e.split("/"),n=t.length;return t.slice(0,n-1).join("/")}async function u(e){let t=JSON.stringify({delay:0}),n=await fetch("".concat(s,"/services/").concat(e,"/stop"),{method:"PUT",headers:{"Content-Type":"application/json"},mode:"cors",body:t});if(!n.ok)throw Error("Failed to stop the service");return n.json()}async function d(e){let t=JSON.stringify({force:!1});if(!(await fetch("".concat(s,"/services/?id=").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"},mode:"cors",body:t})).ok)throw Error("Failed to delete the service")}},7203:function(e,t,n){"use strict";n.d(t,{$J:function(){return i},AK:function(){return o},_v:function(){return s},nC:function(){return r}});let s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(t=>setTimeout(t,e))},r=e=>"".concat("").concat(e),o=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ")},i=Object.freeze({SUBMITTED:"submitted",PENDING:"pending",STARTING:"starting",HEALTHY:"healthy",UNHEALTHY:"unhealthy",TIMEOUT:"timeout",STOPPED:"stopped",EXPIRED:"expired",FAILED:"failed"})},7960:function(){}},function(e){e.O(0,[361,501,313,145,953,971,117,744],function(){return e(e.s=721)}),_N_E=e.O()}]);