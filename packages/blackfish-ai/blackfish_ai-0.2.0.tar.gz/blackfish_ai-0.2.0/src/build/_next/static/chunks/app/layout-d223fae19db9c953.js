(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{721:function(e,t,s){Promise.resolve().then(s.bind(s,5693))},8516:function(e,t,s){"use strict";s.d(t,{JT:function(){return d},ZP:function(){return m},am:function(){return f}});var n=s(7437),r=s(2265),i=s(2219),o=s(4630),a=s(9124),l=s(2871),c=s(408),u=s(3680);let d=(0,r.createContext)(),f=e=>{let{children:t}=e,[s,i]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=localStorage.getItem("profile"),t=e?JSON.parse(e):null;console.debug("Restored profile",t),i(t)},[]),(0,n.jsx)(d.Provider,{value:{profile:s,setProfile:e=>{localStorage.setItem("profile",JSON.stringify(e)),i(e)}},children:t})};function m(e){let{selectedProfile:t,setSelectedProfile:s}=e,{profiles:r,error:d,isLoading:f}=(0,c.nw)();return f?(0,n.jsx)("div",{children:"Loading profiles..."}):d?(0,n.jsx)("div",{children:"Error!"}):0===r.length?(0,n.jsx)("div",{children:"No profiles found."}):(0,n.jsxs)(i.Ri,{value:t,onChange:s,children:[(0,n.jsx)(o.__,{className:"mt-2 block text-sm font-medium leading-6 text-gray-900",children:"Profile"}),t&&!r.map(e=>e.name).includes(t.name)&&(0,n.jsx)("div",{children:"Profile is missing."}),(0,n.jsxs)("div",{className:"relative mt-2 mb-2",children:[t?(0,n.jsx)(i.Y4,{className:"relative w-full cursor-default rounded-md bg-white py-1.5 pl-1 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:text-sm sm:leading-6",children:(0,n.jsxs)("span",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"ml-3 block truncate",children:t.name?t.name:""}),(0,n.jsxs)("span",{className:"ml-2 text-slate-400 text-sm font-light",children:["@",t.host?t.host:"localhost"]}),(0,n.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,n.jsx)(a.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]})}):(0,n.jsx)(i.Y4,{className:"relative w-full cursor-default rounded-md bg-white py-1.5 pl-1 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:text-sm sm:leading-6",children:(0,n.jsxs)("span",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"pointer-events-none flex-shrink-0 pl-3",children:(0,n.jsx)(u.Z,{className:"h-5 w-5 text-yellow-400","aria-hidden":"true"})}),(0,n.jsx)("span",{className:"ml-3 block truncate",children:"No profile selected"}),(0,n.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,n.jsx)(a.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]})}),(0,n.jsx)(i.O_,{className:"absolute z-10 mt-1 max-h-60 overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm w-[var(--button-width)]",anchor:"bottom",children:r.map(e=>(0,n.jsxs)(i.wt,{value:e,className:"group flex gap-2 bg-white data-[focus]:bg-blue-500 data-[focus]:text-white relative cursor-default select-none py-2 pl-1 pr-9 text-gray-900",children:[(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)("span",{className:"ml-3 block truncate font-normal data-[selected]:font-semibold",children:e.name})}),(0,n.jsxs)("span",{className:"ml-1 text-slate-400 text-sm font-light data-[selected]:text-gray-100",children:["@",e.host?e.host:"localhost"]}),(0,n.jsx)("span",{className:"invisible group-data-[selected]:visible absolute inset-y-0 right-0 flex items-center pr-4 group-data-[focus]:text-white text-blue-600",children:(0,n.jsx)(l.Z,{className:"size-5"})})]},e.name))})]})]})}},9657:function(e,t,s){"use strict";s.d(t,{x:function(){return a}});var n=s(257);let r=n.env.NEXT_PUBLIC_BLACKFISH_DOMAIN||"",i=n.env.NEXT_PUBLIC_BLACKFISH_HOST||"localhost",o=n.env.NEXT_PUBLIC_BLACKFISH_PORT||8e3,a=r?"https://".concat(r,"/").concat(i,"/").concat(o):"http://".concat(i,":").concat(o)},5693:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var n=s(7437),r=s(6722),i=s.n(r);s(7960);var o=s(9376),a=s(8516),l=s(1886),c=s(2265),u=s(4405),d=s(3577),f=s(3145),m=s(7648),h=s(5129),p=s(7165);function x(e){let{task:t}=e,s=(0,o.usePathname)().endsWith("login"),[r,i]=(0,c.useState)(!1),a=()=>i(!0),x=()=>i(!1);return(0,n.jsx)(l.pJ,{as:"nav",className:"bg-white",children:e=>{let{open:i}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mx-auto px-4 sm:px-6 lg:px-8",children:(0,n.jsxs)("div",{className:"flex h-16 justify-between",children:[(0,n.jsx)("div",{className:"flex",children:(0,n.jsxs)("div",{className:"flex flex-shrink-0 items-center",children:[(0,n.jsx)(m.default,{href:"/dashboard",children:(0,n.jsx)(f.default,{height:"32",width:"32",src:"img/orca.png",alt:"blackfish"})}),(0,n.jsx)(m.default,{href:"/dashboard",children:(0,n.jsx)("div",{className:"pl-4 text-4xl text-gray-900 font-bold",children:"blackfish"})}),(0,n.jsx)("div",{className:"pl-4 text-4xl font-extralight text-slate-300 italic",children:t})]})}),!s&&(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsx)("button",{onClick:a,className:"text-black hover:text-blue-600 focus:outline-none transition-transform transform hover:scale-110","aria-label":"Help",children:(0,n.jsx)(h.Z,{className:"h-6 w-6"})})})]})}),r&&(0,n.jsx)(u.Vq,{open:r,onClose:x,className:"fixed inset-0 z-10 flex items-center justify-center p-4 bg-black bg-opacity-50",children:(0,n.jsxs)(u.EM,{className:"relative rounded-lg bg-white p-6 sm:max-w-lg shadow-md",children:[(0,n.jsx)("button",{onClick:x,className:"absolute top-3 right-3 text-black hover:text-gray-700 focus:outline-none","aria-label":"Close",children:(0,n.jsx)(p.Z,{className:"h-5 w-5"})}),(0,n.jsx)(u.$N,{className:"text-lg font-bold",children:"Having issues?"}),(0,n.jsx)(d.dk,{className:"mt-2 text-sm text-gray-600",children:"Check out our issues page on GitHub. There, you can search for known bugs, find solutions to common problems, or create a new issue if nothing seems to meet your needs. Go aheadâ€”drop us a line!"}),(0,n.jsx)("div",{className:"mt-5 sm:mt-6 sm:grid sm:grid-flow-row-dense sm:grid-cols-2 sm:gap-3",children:(0,n.jsx)("a",{type:"button",href:"https://github.com/princeton-ddss/blackfish/issues",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600 sm:col-start-2",children:"View on GitHub"})})]})})]})}})}function g(e){let{children:t}=e,s=(0,o.usePathname)();return(0,n.jsxs)("html",{lang:"en",children:[(0,n.jsx)("link",{rel:"icon",href:"/img/favicon.ico",sizes:"any"}),(0,n.jsx)("body",{className:i().className,children:(0,n.jsxs)(a.am,{children:[(0,n.jsx)(x,{task:s.slice(1)}),t]})})]})}},408:function(e,t,s){"use strict";s.d(t,{Su:function(){return a},bP:function(){return o},nw:function(){return l},of:function(){return c}});var n=s(3861),r=s(3347),i=s(7203);let o=(e,t)=>{let{data:s,error:i,isLoading:o}=(0,n.ZP)("models?profile=".concat(e?e.name:"default","&image=").concat(t),r.fm);return{models:s,error:i,isLoading:o}},a=(e,t)=>{let{data:s,error:o,isLoading:a,mutate:l}=(0,n.ZP)(()=>!!e&&"services?profile=".concat(e?e.name:null,"&image=").concat(t.replace("-","_")),r.Qz,{refreshInterval:3e4}),c=[i.$J.HEALTHY,i.$J.STARTING,i.$J.PENDING,i.$J.SUBMITTED,i.$J.STOPPED,i.$J.EXPIRED,i.$J.TIMEOUT,i.$J.FAILED];return{services:s?[...s].sort((e,t)=>{let s=c.indexOf(e.status)-c.indexOf(t.status);return 0!==s?s:new Date(t.created_at)-new Date(e.created_at)}):[],error:o,isLoading:a,mutate:l}},l=()=>{let{data:e,error:t,isLoading:s,mutate:i}=(0,n.ZP)("profiles",r.lU);return{profiles:e,error:t,isLoading:s,mutate:i}},c=e=>{let{data:t,error:s,isLoading:i,mutate:o}=(0,n.ZP)(e?"files?path=".concat(e):null,r.uB);return{files:t,error:s,isLoading:i,refresh:o}}},3347:function(e,t,s){"use strict";s.d(t,{Pp:function(){return u},Qz:function(){return o},UY:function(){return l},fm:function(){return i},lU:function(){return a},uB:function(){return r},wo:function(){return d}});var n=s(9657);async function r(e){let t=await fetch("".concat(n.x,"/api/").concat(e));if(!t.ok){console.debug("from fetchFiles: failed to fetch files (status=".concat(t.status,")"));let e=Error("Failed to fetch files.");throw e.status=t.status,e}return t.json()}async function i(e){let t=await fetch("".concat(n.x,"/api/").concat(e,"&refresh=true"));if(!t.ok){console.debug("from fetchModels: failed to fetch models (status=".concat(t.status,")"));let e=Error("Failed to fetch models.");throw e.status=t.status,e}return(await t.json()).map(e=>({repo_id:e.repo,revision:e.revision,profile:e.profile,image:e.image,model_dir:e.model_dir}))}async function o(e){let t=await fetch("".concat(n.x,"/api/").concat(e));if(!t.ok){console.debug("from fetchServices: failed to fetch services (status=".concat(t.status,")"));let e=Error("Failed to fetch services.");throw e.status=t.status,e}return await t.json()}async function a(){let e=await fetch("".concat(n.x,"/api/profiles"));if(!e.ok){console.debug("from fetchProfiles: failed to fetch profiles (status=".concat(e.status,")"));let t=Error("Failed to fetch profiles.");throw t.status=e.status,t}return await e.json()}async function l(e,t,s,r,i){let o;if("slurm"===i.type)o={name:s.name,image:e.replace("-","_"),repo_id:t.repo_id,profile:i,container_config:{...r,revision:t.revision,model_dir:"speech-recognition"===e?c(t.model_dir):t.model_dir,port:null},job_config:s,mount:r.input_dir,grace_period:180};else if("local"===i.type){let a=await fetch("".concat(n.x,"/api/ports"));if(!a.ok){let e=Error("Unable to find available local port");throw e.status=a.status,e}let l=await a.json();o={name:s.name,image:e.replace("-","_"),repo_id:t.repo_id,profile:i,container_config:{...r,revision:t.revision,model_dir:"speech-recognition"===e?c(t.model_dir):t.model_dir,port:l},job_config:{gres:s.gres},mount:r.input_dir,grace_period:180}}else throw Error("Unsupported job profile type: ".concat(i.type));return console.debug("from runService: body =",o),await fetch("".concat(n.x,"/api/services"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})}function c(e){let t=e.split("/"),s=t.length;return t.slice(0,s-1).join("/")}async function u(e){let t=JSON.stringify({delay:0}),s=await fetch("".concat(n.x,"/api/services/").concat(e,"/stop"),{method:"PUT",headers:{"Content-Type":"application/json"},mode:"cors",body:t});if(!s.ok)throw Error("Failed to stop the service");return s.json()}async function d(e){let t=JSON.stringify({force:!1});if(!(await fetch("".concat(n.x,"/api/services/?id=").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"},mode:"cors",body:t})).ok)throw Error("Failed to delete the service")}},7203:function(e,t,s){"use strict";s.d(t,{$J:function(){return i},AK:function(){return r},_v:function(){return n}});let n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(t=>setTimeout(t,e))},r=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter(Boolean).join(" ")},i=Object.freeze({SUBMITTED:"submitted",PENDING:"pending",STARTING:"starting",HEALTHY:"healthy",UNHEALTHY:"unhealthy",TIMEOUT:"timeout",STOPPED:"stopped",EXPIRED:"expired",FAILED:"failed"})},7960:function(){}},function(e){e.O(0,[361,501,399,953,971,117,744],function(){return e(e.s=721)}),_N_E=e.O()}]);