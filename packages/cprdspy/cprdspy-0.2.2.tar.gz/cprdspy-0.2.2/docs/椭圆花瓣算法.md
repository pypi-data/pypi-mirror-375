# 椭圆花瓣算法
![alt text](./images/两椭圆相交.png)
如图：
两椭圆相交,椭圆1：
$$
\frac{x^2}{a^2}+\frac{(y-\frac{d}{2})^2}{b^2}=1
$$
椭圆2：
$$
\frac{x^2}{a^2}+\frac{(y+\frac{d}{2})^2}{b^2}=1
$$
$其中a,b,d为常数，a>b>d>0$
## 问题一：A或B的坐标点$(-x_0,0),(x_0,0)$表达式。
**解**：
令$y=0$，则
$$
\frac{x_0^2}{a^2}+\frac{(\frac{d}{2})^2}{b^2}=1
$$
$$
x_0=\frac{a}{2b}\sqrt{4b^2-d^2}
$$
故$A(-\frac{a}{2b}\sqrt{4b^2-d^2},0)$,$B(\frac{a}{2b}\sqrt{4b^2-d^2},0)$
## 问题二：如何旋转弧ACB和弧ADB组成的花瓣，要求A点平移到原点后以A为中心。
**解**：
椭圆参数方程为：
$$
% 椭圆参数方程
\begin{cases}
x=a\cos\theta\\
y=b\sin\theta
\end{cases}
$$
将$A(-x_0,0)$点平移到原点后，椭圆参数方程变为：
$$
\begin{cases}
x=a\cos\theta+x_0\\
y=b\sin\theta\pm\frac{d}{2}
\end{cases}
$$
椭圆弧ACB的参数方程为：
$$
\begin{cases}
x=a\cos\theta+x_0\\
y=b\sin\theta-\frac{d}{2}
\end{cases}，\theta\in[\frac{\pi}{2}-\beta,\frac{\pi}{2}+\beta]\\
$$
椭圆弧ADB的参数方程为：
$$
\begin{cases}
x=a\cos\theta+x_0\\
y=b\sin\theta+\frac{d}{2}
\end{cases}，\theta\in[\frac{3\pi}{2}-\beta,\frac{3\pi}{2}+\beta]$$ 
$$\\
\beta=\arctan\frac{AE}{CE}=\arctan\frac{x_0}{\frac{d}{2}}\\
=\arctan\frac{2x_0}{d}=\arctan\frac{a}{bd\sqrt{4b^2-d^2}}
$$
旋转椭圆参数方程写为矩阵形式为：
$$
\begin{bmatrix}
x-x_0\\
y\pm\frac{d}{2}
\end{bmatrix}
=
\begin{bmatrix}
\cos\alpha&-\sin\alpha\\
\sin\alpha&\cos\alpha
\end{bmatrix}
\begin{bmatrix}
a\cos\theta\\
b\sin\theta
\end{bmatrix},\alpha为旋转角
$$
展开即得：
$$% 旋转椭圆参数方程
\begin{cases}
x=a\cos\theta\cos\alpha-a\sin\theta\sin\alpha+x_0\\
y=b\sin\theta\cos\alpha+a\cos\theta\sin\alpha\pm\frac{d}{2}
\end{cases}$$
为了用Python代码实现以上效果，我们先构建会旋转的椭圆弧代码：
```python
import numpy as np
import matplotlib.pyplot as plt
def oval_arc(a,b,angle1,angle2,angle=0,color='#0f0',alpha=1,center=(0,0),points=1000):
    angle1 = np.deg2rad(angle1)
    angle2 = np.deg2rad(angle2)
    theta = np.linspace(angle1, angle2, points)
    angle_rad = np.deg2rad(angle)
    x = a * np.cos(theta)  * np.cos(angle_rad)  - b * np.sin(theta)  * np.sin(angle_rad)  + center[0]
    y = a * np.cos(theta)  * np.sin(angle_rad)  + b * np.sin(theta)  * np.cos(angle_rad)  + center[1]
    return x, y
```
接着，实现椭圆花瓣算法：
```python
def oval_petal(a, b, d, rotate=0, color="#0f0", alpha=1, center=(0, 0), points=1000):
    x0 = b / (2 * a) * np.sqrt(4 * a**2 - d**2)
    beta = np.arctan((2 * x0) / d)
    beta_b1 = np.pi / 2 - beta
    beta_e1 = np.pi / 2 + beta
    beta_b2 = 3*np.pi/2 - beta
    beta_e2 = 3 * np.pi/2 + beta
    center1 = (center[0] + x0, center[1] - d / 2)
    center2 = (center[0] + x0, center[1] + d / 2)
    x1, y1 = oval_arc(
        a,
        b,
        np.rad2deg(beta_b1),
        np.rad2deg(beta_e1),
        angle=0,
        center=center1,
        points=points,
    )
    x2, y2 = oval_arc(
        a,
        b,
        np.rad2deg(beta_b2),
        np.rad2deg(beta_e2),
        angle=0,
        center=center2,
        points=points,
    )

    A1= np.vstack((x1+x0, y1))  # shape (2, N)
    A2= np.vstack((x2+x0, y2))  # shape (2, N)
    
    # 旋转
    R = np.array([[np.cos(rotate), -np.sin(rotate)], [np.sin(rotate), np.cos(rotate)]])
    B1 = R @ A1
    B2 = R @ A2
    x1, y1 = B1[0], B1[1]
    x2, y2 = B2[0], B2[1]
    plt.plot(x1, y1, color=color, alpha=alpha)
    plt.plot(x2, y2, color=color, alpha=alpha)

```

