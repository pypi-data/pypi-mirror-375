when:
  branch: main
  event: push

steps:
  build:
    image: ghcr.io/astral-sh/uv:python3.13-alpine
    commands:
      - apk add zip
      - uv sync --frozen
      - uv run python -mfediverse_pasture_inputs docs
      - uv run python -mfediverse_pasture_inputs zip-file
      - cp CHANGES.md docs/
      - cp -r assets docs/assets/
      - zip -r docs/assets/fediverse_pasture_assets.zip assets/
      - uv run mkdocs build
  deploy:
    image: codeberg.org/xfix/plugin-codeberg-pages-deploy:1
    settings:
      folder: site
      ssh_key:
        from_secret: deploy_ssh_key
