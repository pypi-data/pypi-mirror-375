[build-system]
requires = ["setuptools>=45", "setuptools_scm[toml]>=6.2"]
build-backend = "setuptools.build_meta"

[tool.setuptools_scm]
version_scheme = "guess-next-dev"

[project]
name = "lima2-client"
requires-python = ">= 3.10"
dynamic = ["version"]
authors = [{ name = "BCU (ESRF)" }]
description = "Python client library for Lima2 detector"
readme = "README.md"
license = { file = "LICENSE" }
classifiers = [
    "Intended Audience :: Science/Research",
    "License :: OSI Approved :: MIT License",
    "Programming Language :: Python :: 3",
]
dependencies = [
    "pytango",
    "gevent",
    "jsonschema",
    "jsonschema-default",
    "beartype",
    "numpy<2.3",          # CI runner (CentOS 7) has glibc2.17, numpy>=2.3 needs glibc2.28+
    "pyyaml",
    "typing-extensions",
    "h5py",
]

[project.urls]
Repository = "https://gitlab.esrf.fr/limagroup/lima2-client"
Documentation = "https://limagroup.gitlab-pages.esrf.fr/lima2-client/"

[project.scripts]
lima2_shell = "lima2.client.shell:main [dev]"

[project.optional-dependencies]
dev = [
    "black==22.3",
    "mypy",
    "types-pyyaml",
    "types-jsonschema",
    "types-gevent",
    "flake8",
    "ipython",
    "nosqltangodb",
    "pytango-db",
    "pytest",
    "pytest-forked",
    "pytest-asyncio",
    "pytest-cov",
]
docs = [
    "sphinx",
    "sphinxcontrib-mermaid",
    "sphinxcontrib-napoleon",
    "sphinx-immaterial",
    "recommonmark",
]

[tool.pytest.ini_options]
addopts = "-v"
testpaths = "tests"
required_plugins = [
    "pytest-cov>=6.0.0",
    "pytest-forked>=1.6.0",
    "pytest-asyncio>=0.25.3",
]

[tool.coverage.run]
omit = ["src/lima2/client/shell.py"]
