# This file is auto-generated by generate_tools.py. DO NOT EDIT.
import logging
from pydantic import ValidationError
from multiconn_archicad.basic_types import Port
from tapir_archicad_mcp.context import multi_conn_instance
from tapir_archicad_mcp.tools.tool_registry import register_tool_for_dispatch

from multiconn_archicad.models.tapir.commands import (
    GetAddOnVersionResult,
GetCurrentWindowTypeResult
)


log = logging.getLogger()

def get_add_on_version(port: int) -> GetAddOnVersionResult:
    """
    Retrieves the version of the Tapir Additional JSON Commands Add-On.
    """
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="GetAddOnVersion",
            parameters={}
        )
        return GetAddOnVersionResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for GetAddOnVersion result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing GetAddOnVersion on port {port}: {e}")
        raise e


register_tool_for_dispatch(
    get_add_on_version,
    name="app_get_add_on_version",
    title="GetAddOnVersion",
    description="Retrieves the version of the Tapir Additional JSON Commands Add-On.",
    params_model=None,
    result_model=GetAddOnVersionResult
)


def get_current_window_type(port: int) -> GetCurrentWindowTypeResult:
    """
    Returns the type of the current (active) window.
    """
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="GetCurrentWindowType",
            parameters={}
        )
        return GetCurrentWindowTypeResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for GetCurrentWindowType result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing GetCurrentWindowType on port {port}: {e}")
        raise e


register_tool_for_dispatch(
    get_current_window_type,
    name="app_get_current_window_type",
    title="GetCurrentWindowType",
    description="Returns the type of the current (active) window.",
    params_model=None,
    result_model=GetCurrentWindowTypeResult
)
