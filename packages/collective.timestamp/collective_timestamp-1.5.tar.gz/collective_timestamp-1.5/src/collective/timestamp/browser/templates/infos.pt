<metal:main use-macro="context/main_template/macros/master"
            xmlns="http://www.w3.org/1999/xhtml"
            xmlns:tal="http://xml.zope.org/namespaces/tal"
            xmlns:metal="http://xml.zope.org/namespaces/metal"
            xmlns:i18n="http://xml.zope.org/namespaces/i18n"
   i18n:domain="collective.timestamp">


  <metal:slot fill-slot="main">

    <h1 class="documentFirstHeading"
       i18n:translate=""
    >Timestamp Information</h1>

    <p class="documentDescription"
       i18n:translate=""
    >
      Detailed information about the timestamping of this content.
    </p>

    <div class="ms-0">
      <a class="btn btn-outline-secondary btn-sm"
         tal:attributes="href context/absolute_url">
        <i class="bi bi-arrow-left me-1"></i>
        <tal:text i18n:translate="">Back to content</tal:text>
      </a>
    </div>

    <!-- Dublin Core metadata -->
    <div class="card border-0 shadow-sm my-4">
      <div class="card-header bg-white border-bottom">
        <h2 class="h4 mb-0 text-dark" i18n:translate="">Timestamped item</h2>
      </div>
      <div class="card-body">
        <tal:define
           tal:define="toLocalizedTime nocall: context/@@plone/toLocalizedTime">

          <dl class="row mb-0">
            <!-- Title -->
            <dt class="col-sm-3 text-muted fw-normal small" i18n:domain="plone" i18n:translate="">Title</dt>
            <dd class="col-sm-9 mb-2 small"
               tal:content="context/Title | string:—">—
            </dd>

            <!-- Description -->
            <dt class="col-sm-3 text-muted fw-normal small" i18n:domain="plone" i18n:translate="">Description</dt>
            <dd class="col-sm-9 mb-2 small"
               tal:condition="context/Description"
               tal:content="context/Description">Value
            </dd>
            <dd class="col-sm-9 mb-2 small" tal:condition="not:context/Description">—</dd>

            <!-- Creators -->
            <dt class="col-sm-3 text-muted fw-normal small" i18n:domain="plone" i18n:translate="creators">Creators</dt>
            <dd class="col-sm-9 mb-2 small"
               tal:define="creators python:(context.Creators() if hasattr(context, 'Creators') else getattr(context, 'creators', []))"
               tal:content="python:', '.join(creators) if creators else '—'">—
            </dd>

            <!-- Created -->
            <dt class="col-sm-3 text-muted fw-normal small" i18n:domain="zope" i18n:translate="">Created</dt>
            <dd class="col-sm-9 mb-2 small"
               tal:define="c python:(getattr(context, 'CreationDate', None)() if hasattr(context, 'CreationDate') else getattr(context, 'creation_date', None))"
               tal:content="python:toLocalizedTime(c, long_format=1) if c else '—'">—
            </dd>

            <!-- Modified -->
            <dt class="col-sm-3 text-muted fw-normal small" i18n:domain="zope" i18n:translate="">Modified</dt>
            <dd class="col-sm-9 mb-2 small"
               tal:define="m python:context.modification_date"
               tal:content="python:toLocalizedTime(m, long_format=1) if m else '—'">—
            </dd>

            <!-- Effective -->
            <dt class="col-sm-3 text-muted fw-normal small" i18n:domain="plone" i18n:translate="label_effective_date">
              Effective
            </dt>
            <dd class="col-sm-9 mb-2 small"
               tal:define="e python:context.effective_date"
               tal:content="python:toLocalizedTime(e, long_format=1) if e else '—'">—
            </dd>

            <!-- Expires -->
            <dt class="col-sm-3 text-muted fw-normal small" i18n:domain="plone" i18n:translate="expiration_date">
              Expires
            </dt>
            <dd class="col-sm-9 mb-2 small"
               tal:define="x python:context.expiration_date"
               tal:content="python:toLocalizedTime(x, long_format=1) if x else '—'">—
            </dd>

            <!-- Timestamped file -->
            <dt class="col-sm-3 text-muted fw-normal small" i18n:translate="">Timestamped file</dt>
            <dd class="col-sm-9 mb-2 small"
               tal:condition="view/timestamp_file_link"
               tal:define="f view/timestamp_file_link">
              <a tal:attributes="href f/url"
                class="text-decoration-none">
                <i class="bi bi-download me-1"></i>
                <span tal:content="f/label">—</span>
              </a>
            </dd>
            <dd class="col-sm-9 mb-2 small" tal:condition="not:view/timestamp_file_link">—</dd>

            <!-- TSR file -->
            <dt class="col-sm-3 text-muted fw-normal small" i18n:translate="">Time Stamp Response (TSR) file</dt>
            <dd class="col-sm-9 mb-2 small"
               tal:condition="view/timestamp_tsr_link"
               tal:define="f view/timestamp_tsr_link">
              <a tal:attributes="href f/url"
                class="text-decoration-none">
                <i class="bi bi-download me-1"></i>
                <span tal:content="f/label">—</span>
              </a>
            </dd>
            <dd class="col-sm-9 mb-2 small" tal:condition="not:view/timestamp_tsr_link">—</dd>

          </dl>
        </tal:define>
      </div>
    </div>


    <!-- Timestamp Information -->
    <div
       tal:condition="view/is_timestamped"
       tal:define="toLocalizedTime nocall: context/@@plone/toLocalizedTime;" class="my-4">
      <!-- Certificate Information -->
      <div class="row g-4 mb-4">
        <!-- Main Timestamp Information -->
        <div class="col-lg-7">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-bottom">
              <h2 class="h4 mb-0 text-dark" i18n:translate="">Timestamp Information</h2>
            </div>
            <div class="card-body">

              <dl class="row mb-0">
                <dt class="col-sm-4 text-muted fw-normal small" i18n:translate="">Timestamped on</dt>
                <dd
                  class="col-sm-8 mb-2 small" tal:content="python:toLocalizedTime(view.timestamp_date(), long_format=1)">
                  Value
                </dd>
                <dt class="col-sm-4 text-muted fw-normal small" i18n:translate="">Hash Algorithm</dt>
                <dd class="col-sm-8 mb-2 small" tal:content="view/timestamp_algorithm">Value</dd>
                <dt class="col-sm-4 text-muted fw-normal small" i18n:translate="">Serial</dt>
                <dd class="col-sm-8 mb-2 small"><code tal:content="view/timestamp_serial_number">Value</code></dd>
                <dt class="col-sm-4 text-muted fw-normal small" i18n:translate="">Hashed Message</dt>
                <dd class="col-sm-8 mb-2 small"><code tal:content="view/timestamp_hash">Value</code></dd>
              </dl>
            </div>
          </div>
        </div>
        <!-- Timestamp Authority (TSA) -->
        <div class="col-lg-5">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-bottom">
              <h3 class="h4 mb-0 text-dark" i18n:translate="">Timestamp Authority (TSA)</h3>
            </div>
            <div class="card-body">
              <dl class="row mb-0" tal:define="tsa view/timestamp_authority">
                <tal:repeat repeat="item tsa/items">
                  <dt class="col-sm-4 text-muted fw-normal small" tal:content="python: item[1]['label']">Label</dt>
                  <dd class="col-sm-8 mb-2 small" tal:content="python: item[1]['value']">Value</dd>
                </tal:repeat>
              </dl>
            </div>
          </div>
        </div>
      </div>
      <!-- Certificate Chain -->
      <div class="card border-0 shadow-sm mb-4 pb-2">
        <div class="card-header bg-white border-bottom">
          <h3 class="h4 mb-0 text-dark" i18n:translate="">Certificate Chain</h3>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-sm mb-0">
              <thead class="table-light">
              <tr>
                <th scope="col" class="text-center">#</th>
                <th scope="col" i18n:translate="">Subject CN</th>
                <th scope="col" i18n:translate="">Issuer CN</th>
                <th scope="col" i18n:translate="">Serial</th>
                <th scope="col" i18n:translate="">Valid From</th>
                <th scope="col" i18n:translate="">Valid To</th>
              </tr>
              </thead>
              <tbody tal:repeat="cert view/certificate_chain_info">
              <tr class="align-middle">
                <td class="text-center" tal:content="python: repeat.cert.index + 1">1</td>
                <td tal:content="cert/subject/common_name/value | string:—">Subject</td>
                <td tal:content="cert/issuer/common_name/value | string:—">Issuer</td>
                <td>
                  <code class="small" tal:content="cert/serial_number">Serial</code>
                </td>
                <td tal:content="python:toLocalizedTime(cert['not_before'], long_format=1)"></td>
                <td tal:content="python:toLocalizedTime(cert['not_after'], long_format=1)"></td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Additional Information -->
      <div class="text-end text-center" tal:condition="view/more_infos_url">
        <a tal:attributes="href view/more_infos_url"
          class="btn btn-primary text-white btn-sm" target="_blank" rel="noopener noreferrer">
          <i class="bi bi-info-circle me-1"></i>
          <tal:text i18n:translate="">More about timestamping</tal:text>
        </a>
      </div>
    </div>

    <!-- Not Timestamped -->
    <div tal:condition="not:view/is_timestamped" class="container my-4">
      <div class="alert alert-warning border-0 shadow-sm" role="alert">
        <h4 class="alert-heading h6" i18n:translate="">Content Not Timestamped</h4>
        <p class="mb-0" i18n:translate="">This content is not timestamped.</p>
      </div>
    </div>
  </metal:slot>
</metal:main>
