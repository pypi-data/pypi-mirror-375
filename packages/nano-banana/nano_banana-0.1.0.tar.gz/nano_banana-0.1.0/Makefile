# Nano Banana Package - UV æé€Ÿå·¥ä½œæµ ğŸŒâš¡
# åŸºäº Gemini 2.5 Flash Image çš„å›¾åƒç”Ÿæˆå’Œåˆ†æåŒ…

.PHONY: sync test build publish clean dev format lint check release

# ğŸš€ åˆå§‹åŒ–é¡¹ç›® (ä»…éœ€è¿è¡Œä¸€æ¬¡)
init:
	@echo "ğŸ‰ ä½¿ç”¨ uv åˆå§‹åŒ– nano-banana é¡¹ç›®..."
	uv sync
	@echo "âœ… é¡¹ç›®åˆå§‹åŒ–å®Œæˆï¼"

# ğŸ“¦ åŒæ­¥ä¾èµ– (è¶…å¿«é€Ÿåº¦)
sync:
	@echo "âš¡ åŒæ­¥ä¾èµ–..."
	uv sync

# ğŸ§ª è¿è¡Œæµ‹è¯• (UV ç¯å¢ƒ)
test:
	@echo "ğŸ§ª è¿è¡Œ nano-banana æµ‹è¯•..."
	uv run python tests/simple_test.py
	uv run python tests/quick_test.py
	uv run python tests/nano_banana_test.py
	@echo "ğŸ§ª è¿è¡Œ pytest..."
	uv run pytest tests/ -v

# ğŸš€ å¼€å‘æ¨¡å¼æµ‹è¯•
dev:
	@echo "ğŸš€ å¼€å‘æ¨¡å¼æµ‹è¯•..."
	uv run python -c "import nano_banana as nb; print('âœ… å¯¼å…¥æˆåŠŸ')"
	uv run python -c "from nano_banana import NanoBanana; client = NanoBanana(); print('âœ… å®¢æˆ·ç«¯åˆ›å»ºæˆåŠŸ')"
	@echo "ğŸ’¡ æç¤ºï¼šè¯·ç¡®ä¿å·²è®¾ç½® SIMEN_AI_API_KEY æˆ– OPENAI_API_KEY ç¯å¢ƒå˜é‡"

# ğŸ”¨ æ„å»ºåŒ… (UV åŸç”Ÿæ„å»º)
build:
	@echo "ğŸ”¨ ä½¿ç”¨ uv æ„å»º nano-banana åŒ…..."
	uv build

# ğŸ§ª å‘å¸ƒåˆ° TestPyPI (UV åŸç”Ÿ)
test-publish:
	@echo "ğŸ§ª å‘å¸ƒåˆ° TestPyPI..."
	@echo "ğŸ’¡ éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡: export UV_PUBLISH_TOKEN=your-testpypi-token"
	uv publish --token $$UV_PUBLISH_TOKEN --repository testpypi

# ğŸš€ å‘å¸ƒåˆ° PyPI (UV åŸç”Ÿ)
publish:
	@echo "ğŸš€ å‘å¸ƒåˆ° PyPI..."
	@echo "ğŸ’¡ éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡: export UV_PUBLISH_TOKEN=your-pypi-token"
	uv publish --token $$UV_PUBLISH_TOKEN

# ğŸ¢ å‘å¸ƒåˆ°ç§æœ‰ä»“åº“
publish-private:
	@echo "ğŸ¢ å‘å¸ƒåˆ°ç§æœ‰ä»“åº“..."
	uv publish --repository-url http://your-private-pypi.com/simple/

# ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶
clean:
	@echo "ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶..."
	rm -rf build/
	rm -rf dist/
	rm -rf *.egg-info/
	rm -rf .uv_cache/
	find . -type d -name __pycache__ -delete
	find . -type f -name "*.pyc" -delete

# ğŸ“Š ä»£ç è´¨é‡æ£€æŸ¥
lint:
	@echo "ğŸ“Š ä»£ç è´¨é‡æ£€æŸ¥..."
	uv run ruff check src/
	uv run mypy src/nano_banana/

# ğŸ¨ ä»£ç æ ¼å¼åŒ–
format:
	@echo "ğŸ¨ ä»£ç æ ¼å¼åŒ–..."
	uv run ruff format src/

# âœ… å®Œæ•´æ£€æŸ¥
check: lint test
	@echo "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼"

# ğŸ‰ å®Œæ•´å‘å¸ƒæµç¨‹ (æé€Ÿç‰ˆ)
release: clean check build test-publish
	@echo "ğŸ‰ ç‰ˆæœ¬å‘å¸ƒå®Œæˆ! æ£€æŸ¥ TestPyPI åè¿è¡Œ 'make publish' å‘å¸ƒåˆ°æ­£å¼ PyPI"

# âš¡ æ·»åŠ ä¾èµ– (ç¤ºä¾‹)
add-dep:
	@echo "ç¤ºä¾‹: uv add openai"
	@echo "ç¤ºä¾‹: uv add --dev pytest"
	@echo "ç¤ºä¾‹: uv add --dev ruff"

# ğŸ”„ æ›´æ–°æ‰€æœ‰ä¾èµ–
update:
	@echo "ğŸ”„ æ›´æ–°æ‰€æœ‰ä¾èµ–..."
	uv sync --upgrade

# ğŸ“‹ æ˜¾ç¤ºä¾èµ–æ ‘
tree:
	@echo "ğŸ“‹ ä¾èµ–æ ‘..."
	uv tree

# ğŸ¯ å¿«é€Ÿå¼€å§‹ (æ–°å¼€å‘è€…)
quickstart: init test dev
	@echo "ğŸ¯ å¿«é€Ÿå¼€å§‹å®Œæˆï¼å¯ä»¥å¼€å§‹å¼€å‘äº†"

# ğŸ“„ è¿è¡Œç¤ºä¾‹è„šæœ¬
examples:
	@echo "ğŸ¯ è¿è¡Œ nano-banana ç¤ºä¾‹..."
	@echo "1ï¸âƒ£ æ–‡æœ¬ç”Ÿæˆå›¾ç‰‡æµ‹è¯•:"
	uv run tests/text_to_image_test.py
	@echo "\n2ï¸âƒ£ å›¾ç‰‡åˆ°å›¾ç‰‡æµ‹è¯•:"
	uv run tests/image_to_image_test.py
	@echo "\n3ï¸âƒ£ å›¾ç‰‡åˆ†ææµ‹è¯•:"
	uv run tests/simple_test.py

# ğŸ”§ è®¾ç½®å‘å¸ƒè®¤è¯
setup-auth:
	@echo "ğŸ”§ è®¾ç½®å‘å¸ƒè®¤è¯..."
	@echo "1. è·å– PyPI API Token: https://pypi.org/manage/account/token/"
	@echo "2. è·å– TestPyPI API Token: https://test.pypi.org/manage/account/token/"
	@echo "3. è®¾ç½®ç¯å¢ƒå˜é‡:"
	@echo "   export UV_PUBLISH_TOKEN=your-pypi-token"
	@echo "4. ç„¶åè¿è¡Œ: make test-publish æˆ– make publish"

# ğŸŒ nano-banana ä¸“ç”¨å‘½ä»¤

# ğŸ¨ æµ‹è¯•æ–‡æœ¬ç”Ÿæˆå›¾ç‰‡
test-text2img:
	@echo "ğŸ¨ æµ‹è¯•æ–‡æœ¬ç”Ÿæˆå›¾ç‰‡åŠŸèƒ½..."
	uv run python -c "import nano_banana as nb; result = nb.text_to_image('ä¸€åªå¯çˆ±çš„æ©™è‰²å°çŒ«'); print('ç”Ÿæˆç»“æœ:', result[:100] + '...')"

# ğŸ” æµ‹è¯•å›¾ç‰‡åˆ†æ
test-analyze:
	@echo "ğŸ” æµ‹è¯•å›¾ç‰‡åˆ†æåŠŸèƒ½..."
	uv run python tests/simple_test.py

# ğŸ”„ æµ‹è¯•å›¾ç‰‡åˆ°å›¾ç‰‡
test-img2img:
	@echo "ğŸ”„ æµ‹è¯•å›¾ç‰‡åˆ°å›¾ç‰‡åŠŸèƒ½..."
	uv run python tests/image_to_image_test.py

# ğŸŒ æ£€æŸ¥ç¯å¢ƒå˜é‡
check-env:
	@echo "ğŸŒ æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®..."
	@if [ -z "$$SIMEN_AI_API_KEY" ] && [ -z "$$OPENAI_API_KEY" ]; then \
		echo "âŒ æœªè®¾ç½® API å¯†é’¥ï¼"; \
		echo "è¯·è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ä¹‹ä¸€:"; \
		echo "  export SIMEN_AI_API_KEY=your-simen-key"; \
		echo "  export OPENAI_API_KEY=your-openai-key"; \
	else \
		echo "âœ… API å¯†é’¥å·²é…ç½®"; \
	fi
	@if [ -n "$$SIMEN_BASEURL" ]; then \
		echo "âœ… SIMEN_BASEURL: $$SIMEN_BASEURL"; \
	else \
		echo "ğŸ’¡ å¯é€‰ï¼šè®¾ç½® SIMEN_BASEURL=https://api.simen.ai/v1"; \
	fi

# ğŸ‰ å®Œæ•´åŠŸèƒ½æµ‹è¯•
test-all: check-env test-text2img test-analyze test-img2img
	@echo "ğŸ‰ æ‰€æœ‰åŠŸèƒ½æµ‹è¯•å®Œæˆï¼"

# ğŸ“š æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
help:
	@echo "ğŸŒ Nano Banana Makefile å‘½ä»¤å¸®åŠ©"
	@echo ""
	@echo "ğŸ“¦ é¡¹ç›®ç®¡ç†:"
	@echo "  init          - åˆå§‹åŒ–é¡¹ç›®"
	@echo "  sync          - åŒæ­¥ä¾èµ–"
	@echo "  clean         - æ¸…ç†æ„å»ºæ–‡ä»¶"
	@echo ""
	@echo "ğŸ§ª å¼€å‘æµ‹è¯•:"
	@echo "  dev           - å¼€å‘æ¨¡å¼æµ‹è¯•"
	@echo "  test          - è¿è¡Œæ‰€æœ‰æµ‹è¯•"
	@echo "  check-env     - æ£€æŸ¥ç¯å¢ƒå˜é‡"
	@echo "  test-all      - å®Œæ•´åŠŸèƒ½æµ‹è¯•"
	@echo ""
	@echo "ğŸŒ nano-banana ä¸“ç”¨:"
	@echo "  test-text2img - æµ‹è¯•æ–‡æœ¬ç”Ÿæˆå›¾ç‰‡"
	@echo "  test-analyze  - æµ‹è¯•å›¾ç‰‡åˆ†æ"
	@echo "  test-img2img  - æµ‹è¯•å›¾ç‰‡åˆ°å›¾ç‰‡"
	@echo ""
	@echo "ğŸ”¨ æ„å»ºå‘å¸ƒ:"
	@echo "  build         - æ„å»ºåŒ…"
	@echo "  test-publish  - å‘å¸ƒåˆ° TestPyPI"
	@echo "  publish       - å‘å¸ƒåˆ° PyPI"
	@echo "  release       - å®Œæ•´å‘å¸ƒæµç¨‹"
	@echo ""
	@echo "ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹ï¼š"
	@echo "  make quickstart  # å¿«é€Ÿå¼€å§‹"
	@echo "  make test-all    # æµ‹è¯•æ‰€æœ‰åŠŸèƒ½"
	@echo "  make release     # å‘å¸ƒæ–°ç‰ˆæœ¬"
