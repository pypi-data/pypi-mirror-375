#!/bin/bash
## Run regenie for binary traits
#################################
## NOTE #########################
## regenie: v3.2.9
#################################
## ARGUMENTS ####################
## bfile ï¼šprefix
## phenoFile: phenoFile path
## phenoColList: e.g. "B1,B2"
## covarFile: covarFile path
## covarColList: e.g. "sex,age,PC1_AVG,PC2_AVG,PC3_AVG,PC4_AVG,PC5_AVG,PC6_AVG,PC7_AVG,PC8_AVG,PC9_AVG,PC10_AVG"
## catCovarList: e.g. "sex"
## out : output prefix
## nthreads : number of threads
## bsize : e.g. 1000
#################################

regenie \
  --step 1 \
  --bt \
  --bed ${bfile} \
  --covarFile ${covarFile} \
  --covarColList ${covarColList} \
  --catCovarList ${catCovarList} \
  --phenoFile ${phenoFile} \
  --phenoColList ${phenoColList} \
  --bsize ${bsize} \
  --maxCatLevels 99 \
  --lowmem \
  --threads ${nthreads} \
  --lowmem-prefix tmp_rg \
  --out ${out}

  regenie_3_2_9 \
  --step 2 \
  --af-cc \
  --bed ${bgenfile} \
  --chr ${chr} \
  --covarFile ${phenotypeFile} \
  --covarColList ${covarColList} \
  --catCovarList "sex" \
  --maxCatLevels 3 \
  --phenoFile ${phenotypeFile} \
  --phenoColList ${phenotype} \
  --bsize 400 \
  --ref-first \
  --minMAC 5 \
  --bt \
  --threads ${nThreads} \
  --firth --approx \
  --pThresh 0.05 \
  --firth-se \
  --write-samples \
  --print-pheno \
  --pred ${step1out}_pred.list \
  --out ${step2out}_${chr}