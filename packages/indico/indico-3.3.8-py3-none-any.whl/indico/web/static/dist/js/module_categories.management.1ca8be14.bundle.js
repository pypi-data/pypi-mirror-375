"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[6921],{69305:(e,t,a)=>{var n=a(637),o=a.n(n),r=a(86326),c=a(35623),s=a(8196),i=a(65035),l=a(25584),d=a(24720);!function(e){const t={};function a(e){void 0===t[e]&&(t[e]=e,$.ajax({url:build_url(Indico.Urls.Categories.info,{category_id:e}),dataType:"json",error(e){e.status&&403!==e.status&&handleAjaxError(e)},success(a){t[e]=a}}))}function n(e,t,a){const n=o().isObject(t)?t.category.id:t,r={category_id:e};$("<div>").categorynavigator({category:t,confirmation:!0,openInDialog:!0,actionButtonText:l.$T.gettext("Move here"),dialogTitle:l.$T.ngettext("Move category","Move categories",e.length),dialogSubtitle:l.$T.ngettext("Select new category parent for the category","Select new category parent for {0} selected categories",e.length).format(e.length),actionOn:{categoriesWithoutCategoryManagementRights:{disabled:!0},categoriesDescendingFrom:{disabled:!0,ids:e},categories:{disabled:!0,groups:[{ids:[n],message:l.$T.ngettext("The category is already here","The selected categories are already here",e.length)},{ids:e,message:l.$T.ngettext("This is the category you are trying to move","This is one of the categories you are trying to move",e.length)}]}},onAction(e){$.ajax({url:a,type:"POST",data:$.extend({target_category_id:e.id},r),error:handleAjaxError,success(e){e.success&&location.reload()}})}})}e.setupCategoryMoveButton=function(e){e&&a(e),$(".js-move-category").on("click",(function(){const a=$(this);n([a.data("categoryId")],t[e],a.data("href"))}))},e.setupCategoryTable=function(e){a(e);const o=$("table.category-management"),r=o.find("tbody"),c=$(".js-bulk-delete-category"),s=$(".js-bulk-move-category"),i="tr[data-category-id]",g="input[name=category_id]";function u(){return r.find(i).map((function(){return $(this).data("category-id")})).toArray()}function h(e){return $.ajax({url:o.data("sort-url"),method:"POST",data:JSON.stringify({categories:e}),dataType:"json",contentType:"application/json",error:handleAjaxError})}function y(e){e?$(".banner .js-delete-category").removeClass("disabled").attr("title",l.$T.gettext("Delete category")):$(".banner .js-delete-category").addClass("disabled").attr("title",l.$T.gettext("This category cannot be deleted because it is not empty."))}function m(){return o.find(i).find(`${g}:checked`).map((function(){return this.value})).toArray()}function f(){return o.find(i).has(`${g}:checked`)}$(".js-sort-categories").on("click",(function(){const e=$(this).data("sort-order"),t=u();!function(e){r.find(i).sort(((t,a)=>([t,a]=[$(t),$(a)],e*function(e,t){const a=(0,d.v)(e.title.toLowerCase(),t.title.toLowerCase());if(0===a)return e.id<t.id?-1:1;return a}({title:t.data("category-title"),id:t.data("category-id")},{title:a.data("category-title"),id:a.data("category-id")})))).detach().appendTo(r)}(e),h(u()),cornerMessage({actionLabel:l.$T.gettext("Undo"),actionCallback:function(){var e;return e=t,$.each(e,((e,t)=>{r.find(`[data-category-id=${t}]`).not(".js-move-category").detach().appendTo(r)})),h(t)},feedbackMessage:l.$T.gettext("The category order has been restored."),duration:1e4,message:l.$T.gettext("The category list has been sorted.")})})),s.on("click",(function(a){const o=$(this);a.preventDefault(),o.hasClass("disabled")||n(m(),t[e],o.data("href"))})),o.find(".js-move-category").on("click",(function(){const a=$(this);n([a.data("categoryId")],t[e],a.data("href"))})),o.find(".js-delete-category").on("indico:confirmed",(function(e){e.preventDefault();const t=$(this);$.ajax({url:t.data("href"),method:"POST",error:handleAjaxError,success(e){t.closest(i).remove(),y(e.is_parent_empty)}})})),enableIfChecked(r,g,c,(e=>0===e.filter(":not([data-is-empty=true])").length)),c.on("click",(function(){const e=f();ajaxDialog({url:o.data("bulk-delete-url"),method:"POST",title:l.$T.gettext("Delete categories"),data:{category_id:m()},onClose(t){t&&t.success&&(e.find("input[type=checkbox]").prop("checked",!1),e.remove(),y(t.is_empty))}})})).qtip({suppress:!1,content:{text:function(){const e=f();return e.length?c.hasClass("disabled")?l.$T.gettext("At least one selected category cannot be deleted because it is not empty."):l.$T.ngettext("Delete the selected category","Delete {0} selected categories",e.length).format(e.length):l.$T.gettext("Select the categories to delete first.")}}}),enableIfChecked(r,g,s),s.qtip({suppress:!1,content:{text:function(){const e=f();return e.length?l.$T.ngettext("Move the selected category","Move the {0} selected categories",e.length).format(e.length):l.$T.gettext("Select the categories to move first.")}}}),r.sortable({axis:"y",containment:"parent",cursor:"move",handle:".js-handle",items:"> tr",tolerance:"pointer",update(){h(u())}})},e.setupCategoryEventList=function(e){const t=paginatedSelectAll({containerSelector:"#event-management",checkboxSelector:"input:checkbox[name=event_id]",allSelectedSelector:"input:checkbox[name=all_selected]",selectionMessageSelector:"#selection-message",totalRows:$("#event-management").data("total"),messages:{allSelected:e=>l.$T.ngettext("*","All {0} events in this category are currently selected.").format(e),pageSelected:(e,t)=>l.$T.ngettext("Only {0} out of {1} events is currently selected.","Only {0} out of {1} events are currently selected.",e).format(e,t)}}).isEverythingSelected;a(e),[].forEach.call(document.querySelectorAll(".js-move-event-to-subcategory-container"),(t=>{c.render(r.createElement(s.wu,{eventId:+t.dataset.eventId,currentCategoryId:e,hasPendingMoveRequest:void 0!==t.dataset.pendingRequest,inCategoryManagement:!0}),t)}));const n=document.querySelector("#js-move-events-to-subcategory-container");c.render(r.createElement(s.aF,{currentCategoryId:e,getEventData:()=>{const e=t(),a=[].map.call(document.querySelectorAll("#event-management input[name=event_id][type=checkbox]:checked"),(e=>e.value));return{allSelected:e,eventIds:e?null:a,eventCount:e?$("#event-management").data("total"):a.length}}}),n),enableIfChecked("#event-management","input[name=event_id]",".js-enabled-if-checked")},e.setupCategoryRolesList=function(){!function(){const e=$("#event-roles");e.on("click",".toggle-members",(function(){const e=$(this).closest("tr").next("tr").find(".slide");e.css("max-height",`${e[0].scrollHeight}px`),e.toggleClass("open close")})),e.on("indico:htmlUpdated",(function(){$(this).find(".slide").each((function(){$(this).css("max-height",`${this.scrollHeight}px`)}))}))}(),function(){const e=document.querySelector("#event-roles").dataset.searchToken;$("#event-roles").on("click",".js-add-members",(async t=>{t.stopPropagation();const a=$(t.target),n=await(0,i.showUserSearch)({withExternalUsers:!0,searchToken:e});n.length&&$.ajax({url:a.data("href"),method:a.data("method"),data:JSON.stringify({users:n}),dataType:"json",contentType:"application/json",error:handleAjaxError,complete:IndicoUI.Dialogs.Util.progress(),success(e){updateHtml(a.data("update"),e)}})}))}()}}(window)}},e=>{e.O(0,[4644,4394,2076],(()=>{return t=69305,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_categories.management.1ca8be14.bundle.js.map