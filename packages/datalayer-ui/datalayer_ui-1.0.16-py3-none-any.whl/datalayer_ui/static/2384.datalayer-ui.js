"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[2384],{17523:(e,t,n)=>{n.d(t,{WS:()=>d});var r=n(88037),s=n(41630),a=n(98754),i=n(18683);function o(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class l extends r._Q{constructor(e){super(),o(this,"_rows",void 0),o(this,"_mimeType",void 0),this._mimeType=e.mimeType,this._rows=[]}renderModel(e){const t=e.data[this._mimeType].split("\n").map(e=>e.split(";"));return this._rows=t,Promise.resolve()}render(){return 0===(this._rows.length>0?this._rows[0].length:0)?(0,i.jsx)("div",{children:"No data found!"}):(0,i.jsx)(s.NP,{children:this._rows.map(e=>(0,i.jsx)(a.A,{mt:3,children:e}))})}}const d={safe:!0,mimeTypes:["application/vnd.datalayer.csv"],createRenderer:e=>new l(e)}},22062:(e,t,n)=>{n.d(t,{H:()=>D});var r=n(14809),s=n(20568),a=n(88037),i=n(3353),o=n(9387),l=n(17310),d=n(41630),c=n(98754),u=n(70985),m=n(58875),p=n(11029),h=n(48824),x=n(99180),v=n(34429),f=n(38621),g=n(56944),j=n(10069),b=n(4116),y=n(18683);function k(e){const{createAIAgent:t}=(0,g.w)(),{aiAgents:n,addAIAgent:r}=(0,j.Ks)(),{cell:s,extensionProps:a}=e,{notebookId:i}=a,[k,C]=(0,o.useState)(!1),[S,w]=(0,o.useState)(),[_,A]=(0,o.useState)({prompt:""}),[N,M]=(0,o.useState)({prompt:void 0});(0,o.useEffect)(()=>{const e=(e,t)=>{if("datalayer"===t.key&&S)for(const e of s.model.sharedModel.getMetadata("datalayer")?.ai?.messages??[])if(e.parent_id===S){w(void 0);break}};return s.model.sharedModel.metadataChanged.connect(e),()=>{s.model?.sharedModel.metadataChanged.disconnect(e)}},[s,S]),(0,o.useEffect)(()=>{S||C(!1)},[S]),(0,o.useEffect)(()=>{M({...N,prompt:void 0===_.prompt?void 0:_.prompt.length>0})},[_]);const P=(0,o.useCallback)(async()=>{const e=a.panel.context.sessionContext.session?.kernel,o=e?.serverSettings,l=e?.id;n.find(e=>e.documentId===i&&e.runtimeId===l)||(await t(i,"notebook_persist",o?.baseUrl,o?.token,l),r({documentId:i,runtimeId:l}));const d=(0,b.f)();!function(e,t,n){const r=e.model.getMetadata("datalayer")??{},s=r.ai??{prompts:[],messages:[]},a=s.prompts??[];a.push({id:t,prompt:n,username:void 0,timestamp:Date.now()}),s.prompts=a,r.ai=s,e.model.setMetadata("datalayer",r)}(s,d,_.prompt),w(d)},[n,s,a.panel.context.sessionContext.session?.kernel,_.prompt,i,t]),I=(0,o.useCallback)(e=>{e.ctrlKey&&"Enter"===e.key&&P()},[P]);return(0,y.jsx)(d.NP,{children:(0,y.jsx)(c.A,{display:"flex",style:{justifyContent:"right"},children:(0,y.jsx)(c.A,{className:"dla-Cell-ai-agent-button",children:(0,y.jsxs)(u.W,{open:k,onOpenChange:e=>C(e),children:[(0,y.jsx)(u.W.Anchor,{id:"custom-anchor-id",children:(0,y.jsx)(m.K,{icon:f.SD8,variant:"invisible","aria-label":"AI Agents menu"})}),(0,y.jsx)(u.W.Overlay,{width:"large",children:(0,y.jsxs)(c.A,{as:"form",m:3,children:[(0,y.jsxs)(p.A,{children:[(0,y.jsx)(p.A.Label,{visuallyHidden:!0}),(0,y.jsx)(h.Ay,{block:!0,value:_.prompt,onChange:e=>{A(t=>({...t,prompt:e.target.value}))},disabled:!!S,onKeyDown:I})]}),(0,y.jsxs)(c.A,{sx:{display:"flex",width:"100%",gap:"2px",marginTop:"var(--stack-gap-normal)"},children:[(0,y.jsx)(c.A,{flexGrow:1}),(0,y.jsx)(x.Q,{onClick:e=>C(!1),variant:"default",children:"Cancel"}),(0,y.jsx)(x.Q,{leadingVisual:l.A,onClick:P,disabled:!N.prompt||!!S,variant:"primary",children:S?(0,y.jsx)(v.A,{size:"small"}):"Ask AI"})]})]})})]})})})})}var C=n(34447),S=n(87324),w=n(94247),_=n(35903);const A=e=>{const{cell:t}=e,{datasources:n}=(0,_.Gr)(),[r,s]=(0,o.useState)(),[a,l]=(0,o.useState)("df");(0,o.useEffect)(()=>{const e=(e,t)=>{if("datalayer"===(t?.key??"datalayer")){const t=(e=>{const t=e.getMetadata("datalayer");if(t){const e=t.datasource;if(e)return e.id}})(e);if(t)for(const e of n)if(t===e.id){s(t);break}}};return e(t.model),t.model.metadataChanged.connect(e),()=>{t.model?.metadataChanged.disconnect(e)}},[t,n]);const c=e=>{const n=t.model.getMetadata("datalayer");e?(t.model.setMetadata("datalayer",{...n,sql:!0,datasource:{id:e.id,variant:e.variant,name:e.name,description:e.description,database:e.database,outputBucket:e.outputBucket,destinationVar:a??"df"}}),s(e.id),t.editor.model.mimeType=w.bd):(t.model.setMetadata("datalayer",{...n,sql:!1,datasource:{}}),s(void 0),t.editor.model.mimeType=w.dC)};return(0,y.jsx)(d.NP,{children:(0,y.jsx)(i.az,{display:"flex",style:{justifyContent:"right"},children:(0,y.jsx)(i.az,{className:"dla-Cell-datasource-button",children:(0,y.jsxs)(u.W,{children:[(0,y.jsx)(u.W.Anchor,{id:"custom-anchor-id",children:(0,y.jsx)(m.K,{icon:f.bN0,variant:"invisible","aria-label":"Open Datasources menu"})}),(0,y.jsx)(u.W.Overlay,{width:"medium",children:(0,y.jsx)(C.l,{selectionVariant:"single",showDividers:!0,children:(0,y.jsxs)(C.l.Group,{children:[(0,y.jsx)(C.l.GroupHeading,{children:"Datasources"}),0===n.length&&(0,y.jsxs)(C.l.Item,{onSelect:()=>{},children:["No Datasource available",(0,y.jsx)(C.l.Description,{variant:"block",children:"Create a new Datasource to connect your cell."})]}),n.map(e=>(0,y.jsxs)(C.l.Item,{onSelect:()=>c(e),selected:e.id===r,children:[e.name,(0,y.jsx)(C.l.Description,{variant:"block",children:e.description})]},e.id)),(0,y.jsx)(C.l.Divider,{}),(0,y.jsx)(C.l.Item,{onSelect:e=>{e.preventDefault()},children:(0,y.jsxs)(p.A,{children:[(0,y.jsx)(p.A.Label,{children:"Destination variable"}),(0,y.jsx)(S.A,{size:"small",value:a,disabled:!r,onChange:e=>(e=>{l(e);const n=t.model.getMetadata("datalayer");t.model.setMetadata("datalayer",{...n,sql:!0,datasource:{...n.datasource,destinationVar:e??"df"}})})(e.target.value)})]})}),(0,y.jsx)(C.l.Divider,{}),(0,y.jsx)(C.l.Item,{variant:"danger",onSelect:()=>c(void 0),children:"None"})]})})})]})})})})};function N(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const M="dla-CellToolbar-Container";class P extends a._Q{constructor(e,t){super(),N(this,"_cell",void 0),N(this,"_props",void 0),this._cell=e,this._props=t,this.addClass(M)}render(){return(0,y.jsxs)(i.az,{display:"flex",children:[(0,y.jsx)(i.az,{flexGrow:1}),(0,y.jsxs)(s.fS,{initialEntries:["/"],children:[(0,y.jsx)(s.BV,{children:(0,y.jsx)(s.qh,{path:"*",element:(0,y.jsx)(k,{cell:this._cell,extensionProps:this._props})})}),(0,y.jsx)(A,{cell:this._cell,extensionProps:this._props})]})]})}}function I(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class z extends r.x0{constructor(e,t){super(),I(this,"_panel",void 0),I(this,"_props",void 0),this._panel=e,this._props=t,this.updateConnectedCell=this.updateConnectedCell.bind(this);const n=()=>{const e=this._panel.content.model?.cells;if(e){e.changed.connect(this.updateConnectedCell);for(let t=0;t<e.length;++t)this._registerCellChanges(e.get(t))}};n(),this._panel.content.modelChanged.connect(()=>{n()})}updateConnectedCell(e,t){t.oldValues.forEach(this._deregisterCellChanges.bind(this)),t.newValues.forEach(this._registerCellChanges.bind(this))}_deregisterCellChanges(e){}_registerCellChanges(e){const t=this._getCodeCell(e);t?(t.displayChanged.connect(()=>{this._updateCodeCell(t)}),t.inViewportChanged.connect(()=>{this._updateCodeCell(t)}),this._updateCodeCell(t)):"code"===e.type&&console.error(`Could not find code cell for model: ${e}`)}_getCodeCell(e){return"code"===e.type?this._panel.content.widgets.find(t=>t.model===e):null}_updateCodeCell(e){if(e.inputArea){const t=e.layout;if(t){const n=t;n.widgets[1].hasClass(M)||n.insertWidget(1,new P(e,this._props))}}}}class D{constructor(){var e,t,n;e=this,n=void 0,(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t="_props"))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}init(e){this._props=e}createNew(e,t){new z(e,this._props)}get component(){return null}}},52384:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{NotebookEdit:()=>ue,default:()=>me});var s=n(9387),a=n(20568),i=n(97789),o=n(16950),l=n(17781),d=n(34447),c=n(81461),u=n(21538),m=n(72533),p=n(48824),h=n(93054),x=n(70985),v=n(11029),f=n(87324),g=n(54617),j=n(99180),b=n(58875),y=n(38621),k=n(32916),C=n(2606),S=n(5700),w=n(73553),_=n(42389),A=n(2159),N=n(16476),M=n(27446),P=n(14551),I=n(3353),z=n(3188),D=n(46871),U=n(98970),T=n(6543),$=n(68652),L=n(75345),E=n(83051),O=n(56944),R=n(34279),V=n(60105),W=n(17788),F=n(66210),K=n(41273),B=n(99179),G=n(10069),J=n(9570),Q=n(35903),H=n(26127),q=n(14178),X=n(92131),Y=n(83626),Z=n(6417),ee=n(26480),te=n(17523),ne=n(1162),re=n(74349),se=n(22062),ae=n(53537),ie=n(60294),oe=n(18683),le=e([ne]),de=le.then?(await le)():le;ne=de[0];const ce=new _.Od;function ue(){const{notebookId:e}=(0,a.g)();if(!e)return(0,oe.jsx)(oe.Fragment,{});const t=(0,B.J)(),r=(0,l.S)(),_=(0,W.Z)(),le=(0,F.G)(e),{checkIsPlatformFeaturesPreviewer:de}=(0,R.x)(),ue=de(t),{configuration:me}=(0,J._O)(),{credits:pe,token:he}=(0,H.Y)(),{configuration:xe,multiServiceManager:ve,jupyterLabAdapter:fe,runtimeModels:ge}=(0,X.c6)(),[je,be]=(0,s.useState)(ce),[ye,ke]=(0,s.useState)(void 0),[Ce,Se]=(0,s.useState)(),[we,_e]=(0,s.useState)(!1),[Ae,Ne]=(0,s.useState)(),[Me,Pe]=(0,s.useState)(!1),[Ie,ze]=(0,s.useState)(!0),[De,Ue]=(0,s.useState)(""),[Te,$e]=(0,s.useState)(null),[Le,Ee]=(0,s.useState)(),[Oe,Re]=(0,s.useState)(),[Ve,We]=(0,s.useState)(),[Fe,Ke]=(0,s.useState)(),[Be,Ge]=(0,s.useState)({name:"",nameConfirm:"",description:""}),[Je,Qe]=(0,s.useState)({name:void 0,nameConfirm:void 0,description:void 0}),{enqueueToast:He,trackAsyncTask:qe}=(0,K.d)(),{selectNotebookModel:Xe,reset:Ye}=(0,N.Gx)(),{screenCapture:Ze,space:et,hideBackdrop:tt,setItem:nt,setScreenCapture:rt,showBackdrop:st,showScreenshot:at,triggerItemsRefresh:it}=(0,q.l5)(),{cloneNotebook:ot,deleteItem:lt,getDatasources:dt,getNotebook:ct,refreshDatasources:ut,refreshNotebook:mt,updateNotebook:pt,updateNotebookModel:ht}=(0,V.E)(),{updateDatasources:xt}=(0,Q.Gr)(),{updateAIAgent:vt}=(0,G.Ks)(),{patchAIAgent:ft}=(0,O.w)(),gt=(0,s.useMemo)(()=>{const e=me?.runUrl;if(e&&he)return new z.k({runUrl:e,token:he})},[me,e,he]),jt=(0,s.useMemo)(()=>[new se.H,new A._({factory:S.N})],[]),bt=(0,s.useMemo)(()=>new o.J,[]),yt=(0,s.useMemo)(()=>[te.WS],[]),kt=(0,s.useMemo)(()=>(0,Y.Kp)(),[]);(0,s.useEffect)(()=>{(0,ne.wj)()},[]),(0,s.useEffect)(()=>{if(ge&&ge.length>0&&!Ae){const e=ge[0];St({runtimeDesc:{name:e.environment_name,language:"",location:"remote",displayName:e.given_name,kernelId:e.id,burningRate:e.burning_rate,podName:e.pod_name},runtimeModel:e})}},[ge]),(0,s.useEffect)(()=>{Te&&Te.sharedModel.awareness.setLocalStateField("user",{username:t.id,name:t.handle,display_name:t.displayName,initials:`${t.firstName[0]?.toLocaleUpperCase()??"?"}${t.lastName[0]?.toLocaleUpperCase()||"?"}`,color:kt,avatar_url:t.avatarUrl})},[Te,t,kt]),(0,s.useEffect)(()=>(st(),mt(e).then(t=>{if(tt(),t.success){const t=ct(e);t?(Ee(t),Re(t.nbformat),nt(t),Ge({name:t.name,nameConfirm:"",description:t.description})):_("/")}else He(t.message,{variant:"error"})}).finally(()=>{tt()}),()=>{je.dispose(),Ee(void 0),Ye(),nt(void 0)}),[e]),(0,s.useEffect)(()=>{ut().then(e=>{if(e.success){const e=dt();xt(e)}})},[e]),(0,s.useEffect)(()=>{le&&De&&le.runtimeId!==ye&&(ft(e,je.serverSettings.baseUrl,je.serverSettings.token,ye),vt(e,ye))},[le,ye,e,De,je]),(0,s.useEffect)(()=>{Qe({...Je,name:void 0===Be.name?void 0:Be.name.length>2,nameConfirm:Be.nameConfirm===Le?.name,description:void 0===Be.description?void 0:Be.description.length>2})},[Be]);const Ct=(0,s.useCallback)(async()=>{st(),pt(e,Be.name,Be.description).then(e=>{e.success&&(He("The notebook is successfully updated.",{variant:"success"}),it(),Ee({...Le,name:Be.name,description:Be.description}))}).finally(()=>{tt()})},[e,Be.name,Be.description,Le]),St=(0,s.useCallback)(async({runtimeDesc:r,runtimeModel:s,transferState:a})=>{const o=Xe(e);o?.model&&Re(o.model.toJSON()),Se(r);const l=r?.location;switch(Ue(""),l){case void 0:ke(void 0),ze(!0),_e(!1),be(ce);break;case"browser":if(ve?.browser){if(fe){if(!fe.jupyterLab.hasPlugin("@jupyterlite/pyodide-kernel-extension:kernel")){const e=await Promise.all([n.e(484),n.e(5378)]).then(n.bind(n,28924));fe.jupyterLab.registerPluginModule(e)}fe.jupyterLab.isPluginActivated("@jupyterlite/pyodide-kernel-extension:kernel")||await fe.jupyterLab.activatePlugin("@jupyterlite/pyodide-kernel-extension:kernel")}ke(void 0),ze(!1),_e(!0),be(ve.browser)}else console.error("Unable to use browser kernel. No service manager for it.");break;case"remote":{if(!ve?.remote){console.error("Unable to use a remote runtime. No service manager for it.");break}let n;if(a&&je&&je===ve?.browser&&Ae?.kernel)try{st();let e=!0;const t=Ae.kernel.id,r=`pyodide-${t}`,s=(0,ee.T)({connection:Ae.kernel,metadata:{filename:`${r}.data`},onUploadProgress:()=>{e&&(e=!1,(0,Z.Ay)().then(e=>{n=e.find(e=>e.name===r)}))}});if(qe(s,{error:{message:e=>`Failed to save the browser kernel state. ${e}`},pending:{message:"Saving the browser kernel state…"},success:{message:()=>"Browser kernel state saved."}}),await s,!n)throw Error("Unable to find snapshot for pyodide state.");await ve.browser.kernels.shutdown(t)}finally{tt()}if(!s){const{name:e,displayName:a,params:i}=r,o=await(ve?.remote?.runtimesManager.startNew({environmentName:e,type:"notebook",givenName:a,creditsLimit:i?.creditsLimit??(pe?.available??0)/Math.max(xe.maxCellRuntimes-ge.filter(e=>"cell"!==e.type).length,1),capabilities:i?.capabilities,snapshot:n?.id},{username:t?.handle,handleComms:!0}));s=await ve.remote.runtimesManager.findById(o.id),o.dispose()}_e(!1),ke(s.id),ze(!1),Ue(s.pod_name);const o=ve.remote.runtimesManager.getServices(s.pod_name),l=new i.ServiceManager({contents:o?.contents,kernels:o?.kernels,kernelspecs:o?.kernelspecs,serverSettings:o?.serverSettings,sessions:o?.sessions,events:{dispose:()=>{}},terminals:{connectionFailure:{connect:()=>{}},dispose:()=>{},isAvailable:()=>!1}});be(l),We("storage");const d=o?.serverSettings.baseUrl.replace("/jupyter/server","/mcp")+"/mcp";fetch(d+"/../api/connect",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({provider:"datalayer",runtime_url:o?.serverSettings.baseUrl,runtime_id:s.id,runtime_token:o?.serverSettings.token,document_url:me.spacerRunUrl,document_id:e,document_token:he})}).then(e=>{He("Jupyter MCP Server connected successfully.",{variant:"success"}),We("ai-agents"),Ke(d)})}}wt(void 0)},[xe,pe,fe,e,ve,ge,je,Ae]),wt=(0,s.useCallback)(e=>{Ne(e||void 0)},[]),_t=(0,s.useCallback)(async()=>{r({title:"Are you sure?",content:"Please confirm you want to clone this notebook in your private library."}).then(t=>{t&&(st(),ot(e).then(e=>{tt(),e.success&&(He(e.message,{variant:"success"}),it(),_("/my-library"))}))})},[r,Le]),At=(0,s.useCallback)(e=>{$e(e)},[]),Nt=(0,s.useCallback)(()=>{if(!Ie&&Te?.cells){st("Saving the notebook...");const t=Te.toJSON();ht(e,t).then(n=>{n.success&&(He("The notebook is successfully updated.",{variant:"success"}),Ee({...Le,id:e,nbformat:t}))}).finally(()=>{tt()})}},[e,Te,Ie]),Mt=(0,s.useCallback)(()=>{We("storage"!==Ve&&je&&je!==ce?"storage":void 0)},[Ve,je]);return(0,oe.jsxs)(oe.Fragment,{children:[(0,oe.jsxs)(g.z,{"aria-label":Le?.name,children:[(0,oe.jsx)(g.z.TitleArea,{variant:"subtitle",children:(0,oe.jsx)(g.z.Title,{children:Le?.name})}),(0,oe.jsx)(g.z.Actions,{children:Le&&et&&(0,oe.jsxs)(I.az,{sx:{flex:"0 0 auto",display:"flex",alignItems:"center"},children:[ve?.remote&&Ae&&Ae.kernel&&(0,oe.jsx)(U.m,{kernelId:Ae.kernel.id,serviceManager:ve.remote,onClick:()=>{_("/runtimes")}},"credits-indicator"),(0,oe.jsx)(D.P,{assignRuntime:St,sessionConnection:Ae},"runtime-picker"),(0,oe.jsx)(T.C,{connection:Ae?.kernel??void 0,multiServiceManager:ve,podName:De,disabled:void 0===Ce?.location,children:"Snapshots"}),(0,oe.jsx)(j.Q,{title:"Browse content on the Remote Runtime",variant:"invisible",size:"small",disabled:!je||je===ce,leadingVisual:()=>(0,oe.jsx)(P.Cx,{type:"content"}),onClick:Mt,children:"Storage"},"content"),(0,oe.jsx)(L.E,{commandRegistry:bt,runtimeDesc:Ce,save:Nt,sessionConnection:Ae},"toolbar"),(0,oe.jsx)(j.Q,{variant:"invisible",size:"small",leadingVisual:y.tSI,onClick:e=>We("ai-agents"===Ve?void 0:"ai-agents"),children:"AI Agent"},"clone"),(0,oe.jsxs)(x.W,{children:[(0,oe.jsx)(x.W.Anchor,{children:(0,oe.jsx)(b.K,{variant:"invisible",icon:y.tno,"aria-label":"Open menu"})}),(0,oe.jsx)(x.W.Overlay,{width:"medium",children:(0,oe.jsxs)(d.l,{children:[(0,oe.jsxs)(d.l.Item,{onSelect:()=>_t(),children:[(0,oe.jsx)(d.l.LeadingVisual,{children:(0,oe.jsx)(y.Nc$,{})}),"Duplicate"]}),ue&&(0,oe.jsxs)(oe.Fragment,{children:[(0,oe.jsx)(d.l.Divider,{}),(0,oe.jsxs)(d.l.Item,{onSelect:()=>{at()},children:[(0,oe.jsx)(d.l.LeadingVisual,{children:(0,oe.jsx)(y.rVi,{})}),"Capture Screen"]}),(0,oe.jsxs)(d.l.Item,{onSelect:()=>Pe(!Me),children:[(0,oe.jsx)(d.l.LeadingVisual,{children:(0,oe.jsx)(P.Cx,{type:"share"})}),"Share"]}),(0,oe.jsxs)(d.l.Item,{onSelect:()=>_(`/new/page/notebook/${e}`),children:[(0,oe.jsx)(d.l.LeadingVisual,{children:(0,oe.jsx)(P.Cx,{type:"page"})}),"Publish"]})]}),(0,oe.jsx)(d.l.Divider,{}),(0,oe.jsxs)(d.l.Item,{onSelect:()=>We("mcp-server"===Ve?void 0:"mcp-server"),children:[(0,oe.jsx)(d.l.LeadingVisual,{children:(0,oe.jsx)(k.A,{})}),"MCP Server"]}),(0,oe.jsx)(d.l.Divider,{}),(0,oe.jsxs)(d.l.Item,{onSelect:()=>We("properties"===Ve?void 0:"properties"),children:[(0,oe.jsx)(d.l.LeadingVisual,{children:(0,oe.jsx)(y.L64,{})}),"Properties"]})]})})]}),"datalayer"===gt?.type&&Te&&(0,oe.jsx)(E.P,{awareness:Te.sharedModel.awareness,currentUserHandle:t.handle},"peers")]})})]}),(0,oe.jsxs)(h.O7,{children:[(0,oe.jsxs)(h.O7.Content,{"aria-label":"Notebook Editor",width:"full",padding:"none",children:[Ze&&(0,oe.jsx)(I.az,{mt:3,children:(0,oe.jsxs)(I.az,{display:"flex",children:[(0,oe.jsx)(I.az,{children:(0,oe.jsx)("img",{src:Ze})}),(0,oe.jsx)(I.az,{children:(0,oe.jsx)(u.A,{href:"javascript: return false;",onClick:e=>rt(void 0),children:(0,oe.jsx)(y.uv5,{})})})]})}),Me&&(0,oe.jsx)(I.az,{sx:{flexGrow:1},children:(0,oe.jsx)(re.a,{})}),Oe&&gt&&(void 0===Ce?.location?(0,oe.jsx)(I.az,{sx:{"& .jp-Cell":{marginTop:30}},children:(0,oe.jsx)(C.j,{nbformat:Oe,outputs:!0})}):(0,oe.jsx)(I.az,{children:(0,oe.jsx)(w.k,{commands:bt,extensions:jt,id:e,collaborationProvider:gt,nbformat:Oe,readonly:Ie,renderers:yt,kernelId:ye,serviceManager:je,startDefaultKernel:we,height:"calc(100vh - 150px)",maxHeight:"calc(100vh - 150px)",cellSidebarMargin:32,onNotebookModelChanged:At,onSessionConnection:wt})}))]}),Ve&&(0,oe.jsxs)(h.O7.Pane,{"aria-label":"Notebook Sidebar",position:"start",width:"large",children:["storage"===Ve&&je.contents&&(0,oe.jsx)($.XV,{contents:je.contents,documentRegistry:fe?.jupyterLab.docRegistry}),"properties"===Ve&&(0,oe.jsxs)(I.az,{as:"form",sx:{label:{marginTop:2}},children:[(0,oe.jsxs)(v.A,{children:[(0,oe.jsx)(v.A.Label,{children:"Name"}),(0,oe.jsx)(f.A,{block:!0,value:Be.name,onChange:e=>{Ge(t=>({...t,name:e.target.value}))}}),!1===Je.name&&(0,oe.jsx)(v.A.Validation,{variant:"error",children:"Name must have more than 2 characters."})]}),(0,oe.jsxs)(v.A,{children:[(0,oe.jsx)(v.A.Label,{children:"Description"}),(0,oe.jsx)(p.Ay,{block:!0,value:Be.description,onChange:e=>{Ge(t=>({...t,description:e.target.value}))}}),!1===Je.description&&(0,oe.jsx)(v.A.Validation,{variant:"error",children:"Description must have more than 2 characters."})]}),(0,oe.jsx)(v.A,{children:(0,oe.jsx)(j.Q,{variant:"primary",disabled:!Je.name||!Je.description,style:{marginTop:2},onClick:Ct,children:"Update Notebook Properties"})}),(0,oe.jsx)(I.az,{mt:3}),(0,oe.jsx)(M.R,{variant:"default",data:Oe,fileName:`notebook-${e}`,extension:"ipynb"}),(0,oe.jsxs)(I.az,{sx:{marginTop:3},children:[(0,oe.jsx)(c.A,{as:"h2",sx:{fontSize:4,fontWeight:"normal",color:"danger.fg",mb:2},children:"Danger zone"}),(0,oe.jsxs)(I.az,{sx:{border:"1px solid",borderColor:"danger.emphasis",borderRadius:2,p:3,alignItems:"center",justifyContent:"space-between",gap:3},children:[(0,oe.jsxs)(I.az,{sx:{display:"grid",gap:1},children:[(0,oe.jsx)(m.A,{sx:{fontSize:1,fontWeight:"bold",color:"danger.fg"},children:"Confirm the notebook name to delete"}),(0,oe.jsx)(v.A,{children:(0,oe.jsx)(f.A,{block:!0,value:Be.nameConfirm,onChange:e=>{Ge(t=>({...t,nameConfirm:e.target.value}))}})}),(0,oe.jsx)(m.A,{sx:{fontSize:1,color:"fg.muted"},children:"This operation is not reversible."})]}),(0,oe.jsx)(j.Q,{variant:"danger",disabled:!Je.nameConfirm,onClick:async()=>{st("Deleting the notebook..."),lt(Le.id).then(e=>{e.success&&(He("The notebook is successfully deleted.",{variant:"success"}),_("/my-library"))}).finally(()=>{tt()})},children:"Delete notebook"})]})]})]}),"ai-agents"===Ve&&Fe&&(0,oe.jsx)(ae.z,{mcpServerUrl:Fe}),"mcp-server"===Ve&&gt&&Ae&&Ae.kernel&&(0,oe.jsx)(ie.m,{documentServer:{baseURL:me.spacerRunUrl,token:he,documentName:e,type:gt.type},runtimeId:Ae.kernel.id,runtimeSettings:Ae.serverSettings})]})]})]})}const me=ue;r()}catch(pe){r(pe)}})},53537:(e,t,n)=>{n.d(t,{z:()=>a});var r=n(35769),s=n(18683);const a=e=>{const{mcpServerUrl:t}=e;return(0,s.jsx)(s.Fragment,{children:t?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(r.n,{mcpServerUrl:t,height:"calc(100vh - 245px)"})}):(0,s.jsx)(s.Fragment,{})})}},60294:(e,t,n)=>{n.d(t,{m:()=>d});var r=n(81461),s=n(72533),a=n(32916),i=n(3353),o=n(45077),l=n(18683);const d=e=>{const{documentServer:t,runtimeId:n,runtimeSettings:d}=e;return(0,l.jsxs)(i.az,{children:[(0,l.jsxs)(r.A,{children:[(0,l.jsx)(a.A,{})," MCP Server"]}),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(i.az,{children:[(0,l.jsx)(s.A,{children:"Start a Jupyter MCP Server"}),(0,l.jsx)(o.O,{code:`jupyter-mcp-server start   --transport streamable-http   --provider datalayer   --document-url ${t.baseURL}   --document-id ${t.documentName}   --document-token ${t.token}   --runtime-url ${d.baseUrl}   --start-new-runtime false   --runtime-id ${n}   --runtime-token ${d.token}   --port 4040\n`})]}),(0,l.jsxs)(i.az,{sx:{mb:2},children:[(0,l.jsx)(s.A,{children:"Connect a running Jupyter MCP Server"}),(0,l.jsx)(o.O,{code:`jupyter-mcp-server start   --transport streamable-http   --provider datalayer   --start-new-runtime false\n \njupyter-mcp-server connect   --provider datalayer   --document-url ${t.baseURL}   --document-id ${t.documentName}   --document-token ${t.token}   --runtime-url ${d.baseUrl}   --runtime-id ${n}   --runtime-token ${d.token}   --jupyter-mcp-server-url http://localhost:4040\n`})]}),(0,l.jsxs)(i.az,{sx:{mb:2},children:[(0,l.jsx)(s.A,{children:"Run Code on the Runtime"}),(0,l.jsx)(o.O,{code:`import os\n\nfrom platform import node\nfrom jupyter_kernel_client import KernelClient\n\nkernel = KernelClient(\n  server_url="${d.baseUrl}",\n  kernel_id="${n}",\n  token="${d.token}"\n)\nkernel.start()\ncode = """import os\nfrom platform import node\nx=f"Hey {os.environ.get('USER', 'Foo Bar')} from {node()}."\nprint(x)\n"""\nreply = kernel.execute(code)\nprint(reply)\nassert reply["execution_count"] > 1\nassert reply["status"] == "ok"\nassert len(reply["outputs"]) > 0\n\n`})]}),(0,l.jsxs)(i.az,{children:[(0,l.jsx)(s.A,{children:"Connect to the Room, add a Cell and run it."}),(0,l.jsx)(o.O,{code:`from jupyter_nbmodel_client import NbModelClient, get_notebook_websocket_url\n\nws_url = get_notebook_websocket_url(\n  server_url = "${t.baseURL}",\n  path = "${t.documentName}",\n  token = "${t.token}",\n  provider = "datalayer"\n)\n\nasync with NbModelClient(ws_url) as notebook:\n    cell_index = notebook.add_code_cell("1+1")\n    results = notebook.execute_cell(cell_index, kernel)\n    print(results)\n    assert results["status"] == "ok"\n    assert len(results["outputs"]) > 0\n\n`})]})]})]})}}}]);