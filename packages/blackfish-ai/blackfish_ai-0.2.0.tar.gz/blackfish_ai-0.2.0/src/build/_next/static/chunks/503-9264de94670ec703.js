"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[503],{5288:function(e,s,t){t.d(s,{T:function(){return o}});var l=t(7437),r=t(2265);t(3145);var n=t(408),a=t(8516),i=t(7660);function o(e){let{task:s,children:t}=e,{profile:o}=(0,r.useContext)(a.JT),{services:c,error:d,isLoading:m}=(0,n.Su)(o,s),{selectedService:u,setSelectedServiceId:x}=function(e){var s;let[t,l]=(0,r.useState)(null),n=null!==(s=null==e?void 0:e.find(e=>e.id===t))&&void 0!==s?s:null;return(0,r.useEffect)(()=>{e&&0!==e.length?n||l(e[0].id):l(null)},[e,n]),{selectedService:n,setSelectedServiceId:l}}(c);return d?(0,l.jsxs)("div",{className:"flex flex-col flex-shrink-0 justify-center h-[calc(100vh-64px)]",children:[(0,l.jsx)("div",{className:"flex flex-row justify-center items-center",children:(0,l.jsx)("img",{className:"h-16 w-auto mb-8",src:"img/dead-fish.png",alt:"blackfish-error"})}),(0,l.jsx)("div",{className:"flex flex-row justify-center items-center",children:"There's something fishy going on here."}),(0,l.jsx)("div",{className:"flex flex-row justify-center items-center",children:d.status})]}):m?(0,l.jsx)("div",{className:"flex flex-col flex-shrink-0 justify-center h-[calc(100vh-64px)]",children:(0,l.jsx)("div",{className:"flex flex-row justify-center items-center",children:(0,l.jsx)("img",{className:"animate-bounce h-16 w-auto mb-8",src:"img/orca.png",alt:"blackfish-loading"})})}):(0,l.jsx)("div",{className:"flex flex-row h-[calc(100vh-64px)]",children:(0,l.jsx)(i.Z,{selectedService:u,setSelectedServiceId:x,children:t})})}},8516:function(e,s,t){t.d(s,{JT:function(){return m},ZP:function(){return x},am:function(){return u}});var l=t(7437),r=t(2265),n=t(2219),a=t(4630),i=t(9124),o=t(2871),c=t(408),d=t(3680);let m=(0,r.createContext)(),u=e=>{let{children:s}=e,[t,n]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=localStorage.getItem("profile"),s=e?JSON.parse(e):null;console.debug("Restored profile",s),n(s)},[]),(0,l.jsx)(m.Provider,{value:{profile:t,setProfile:e=>{localStorage.setItem("profile",JSON.stringify(e)),n(e)}},children:s})};function x(e){let{selectedProfile:s,setSelectedProfile:t}=e,{profiles:r,error:m,isLoading:u}=(0,c.nw)();return u?(0,l.jsx)("div",{children:"Loading profiles..."}):m?(0,l.jsx)("div",{children:"Error!"}):0===r.length?(0,l.jsx)("div",{children:"No profiles found."}):(0,l.jsxs)(n.Ri,{value:s,onChange:t,children:[(0,l.jsx)(a.__,{className:"mt-2 block text-sm font-medium leading-6 text-gray-900",children:"Profile"}),s&&!r.map(e=>e.name).includes(s.name)&&(0,l.jsx)("div",{children:"Profile is missing."}),(0,l.jsxs)("div",{className:"relative mt-2 mb-2",children:[s?(0,l.jsx)(n.Y4,{className:"relative w-full cursor-default rounded-md bg-white py-1.5 pl-1 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:text-sm sm:leading-6",children:(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"ml-3 block truncate",children:s.name?s.name:""}),(0,l.jsxs)("span",{className:"ml-2 text-slate-400 text-sm font-light",children:["@",s.host?s.host:"localhost"]}),(0,l.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,l.jsx)(i.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]})}):(0,l.jsx)(n.Y4,{className:"relative w-full cursor-default rounded-md bg-white py-1.5 pl-1 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:text-sm sm:leading-6",children:(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"pointer-events-none flex-shrink-0 pl-3",children:(0,l.jsx)(d.Z,{className:"h-5 w-5 text-yellow-400","aria-hidden":"true"})}),(0,l.jsx)("span",{className:"ml-3 block truncate",children:"No profile selected"}),(0,l.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,l.jsx)(i.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]})}),(0,l.jsx)(n.O_,{className:"absolute z-10 mt-1 max-h-60 overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm w-[var(--button-width)]",anchor:"bottom",children:r.map(e=>(0,l.jsxs)(n.wt,{value:e,className:"group flex gap-2 bg-white data-[focus]:bg-blue-500 data-[focus]:text-white relative cursor-default select-none py-2 pl-1 pr-9 text-gray-900",children:[(0,l.jsx)("div",{className:"flex",children:(0,l.jsx)("span",{className:"ml-3 block truncate font-normal data-[selected]:font-semibold",children:e.name})}),(0,l.jsxs)("span",{className:"ml-1 text-slate-400 text-sm font-light data-[selected]:text-gray-100",children:["@",e.host?e.host:"localhost"]}),(0,l.jsx)("span",{className:"invisible group-data-[selected]:visible absolute inset-y-0 right-0 flex items-center pr-4 group-data-[focus]:text-white text-blue-600",children:(0,l.jsx)(o.Z,{className:"size-5"})})]},e.name))})]})]})}},6824:function(e,s,t){t.d(s,{Z:function(){return a}});var l=t(7437),r=t(2265),n=t(5402);function a(e){let{label:s,help:t,units:a,placeholder:i,value:o,setValue:c,validate:d,type:m,disabled:u}=e;r.useEffect(()=>{let e=d(o);e.ok||(h(!1),g(e.message))},[o]);let[x,h]=r.useState(!0),[f,g]=r.useState(null);return(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium leading-6 text-gray-900",children:s}),t&&(0,l.jsx)("p",{className:"mt-1 text-sm leading-6 text-gray-600",children:t}),(0,l.jsxs)("div",{className:"relative mt-2 rounded-md shadow-sm",children:[(0,l.jsx)("input",{type:m,disabled:u,className:function(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter(Boolean).join(" ")}(x?"ring-gray-300 focus:ring-blue-500":"text-red-600 ring-red-300 placeholder:text-red-300 focus:ring-red-600","block w-full rounded-md border-0 py-1.5 pr-10 ring-inset focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6 disabled:bg-gray-100 disabled:ring-1 disabled:ring-gray-300 ring-1"),placeholder:i,value:o,onChange:e=>{c(e.target.value);let s=d(e.target.value);s.ok?(h(!0),g(null)):(h(!1),g(s.message))},"aria-invalid":"true","aria-describedby":"email-error"}),x&&(0,l.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 font-light italic text-sm text-slate-500",children:a}),!x&&(0,l.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3",children:(0,l.jsx)(n.Z,{className:"h-5 w-5 text-red-600","aria-hidden":"true"})})]}),!x&&(0,l.jsx)("p",{className:"mt-2 text-sm text-red-600",id:"email-error",children:f})]})}},14:function(e,s,t){t.d(s,{_:function(){return V}});var l=t(7437),r=t(2265),n=t(8516),a=t(7472),i=t(4630),o=t(2219),c=t(5926),d=t(2530),m=t(9124),u=t(2871),x=t(3175),h=t(408),f=t(7203),g=t(7660);let p=["stopped","expired"];function j(e){let{profile:s,task:t}=e,{services:n,error:j,isLoading:b}=(0,h.Su)(s,t),{selectedService:v,setSelectedServiceId:N}=(0,r.useContext)(g.o);return j?(0,l.jsx)("div",{className:"rounded-md bg-red-50 border-red-100 ring-1 ring-red-300 p-4 mt-2 mb-4",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)(x.Z,{"aria-hidden":"true",className:"size-5 text-red-500"})}),(0,l.jsxs)("div",{className:"ml-3",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Failed to fetch services"}),(0,l.jsx)("div",{className:"mt-2 font-light text-sm text-red-800",children:(0,l.jsx)("p",{children:"We ran into an issue while fetching the services available for this profile."})})]})]})}):b?(0,l.jsx)("div",{className:"animate-pulse rounded-md bg-gray-100 p-4 mt-2 mb-4 h-72"}):s&&0===n.length?(0,l.jsxs)(a.g,{children:[(0,l.jsx)(i.__,{className:"pt-2 block text-sm font-medium leading-6 text-gray-900",children:"Services"}),(0,l.jsx)("div",{className:"rounded-md bg-yellow-50 border-yellow-100 ring-1 ring-yellow-300 p-4 mt-2 mb-4",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)(d.Z,{"aria-hidden":"true",className:"h-5 w-5 text-yellow-400"})}),(0,l.jsxs)("div",{className:"ml-3",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"No services available"}),(0,l.jsx)("div",{className:"mt-2 font-light text-sm text-yellow-800",children:(0,l.jsx)("p",{children:"Click on the button below to create a new service under the selected profile."})})]})]})})]}):(0,l.jsx)(o.Ri,{value:v,onChange:N,children:e=>{let{open:t}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.__,{className:"pt-2 block text-sm font-medium leading-6 text-gray-900",children:"Services"}),(0,l.jsxs)("div",{className:"relative mt-2",children:[v?(0,l.jsxs)(o.Y4,{className:"relative w-full cursor-default rounded-md bg-white py-1.5 pl-3 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:text-sm sm:leading-6",children:[(0,l.jsxs)("span",{className:"flex items-center",children:[v&&(0,l.jsx)("span",{"aria-label":v.status===f.$J.HEALTHY?"Online":"Offline",className:(0,f.AK)(p.includes(v.status)?"bg-gray-200":v.status===f.$J.HEALTHY?"bg-green-500":v.status===f.$J.TIMEOUT||v.status===f.$J.FAILED?"bg-red-500":v.status===f.$J.SUBMITTED?"bg-yellow-500":v.status===f.$J.STARTING||v.status===f.$J.PENDING?"animate-pulse bg-green-500":"bg-transparent border border-gray-300","inline-block h-2 w-2 flex-shrink-0 rounded-full")}),(0,l.jsx)("span",{className:"ml-3 block truncate",children:v?v.name:""})]}),(0,l.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,l.jsx)(m.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}):s?(0,l.jsxs)(o.Y4,{className:"relative w-full cursor-default rounded-md bg-white py-1.5 pl-3 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 sm:text-sm sm:leading-6",children:[(0,l.jsxs)("span",{className:"flex items-center",children:[v&&(0,l.jsx)("span",{"aria-label":v.status===f.$J.HEALTHY?"Online":"Offline",className:(0,f.AK)(p.includes(v.status)?"bg-gray-200":v.status===f.$J.HEALTHY?"bg-green-500":v.status===f.$J.TIMEOUT||v.status===f.$J.FAILED?"bg-red-500":v.status===f.$J.SUBMITTED?"bg-yellow-500":v.status===f.$J.STARTING||v.status===f.$J.PENDING?"animate-pulse bg-green-500":"bg-transparent border border-gray-300","inline-block h-2 w-2 flex-shrink-0 rounded-full")}),(0,l.jsx)("span",{className:"ml-3 block truncate",children:"No service selected"})]}),(0,l.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,l.jsx)(m.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}):(0,l.jsx)(o.Y4,{className:"relative w-full cursor-default rounded-md bg-gray-50 py-1.5 pl-1 pr-10 text-left text-gray-400 font-light shadow-sm ring-1 ring-inset ring-gray-200 focus:outline-none sm:text-sm sm:leading-6",disabled:!0,children:(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"pointer-events-none flex-shrink-0 pl-3",children:(0,l.jsx)(d.Z,{className:"h-5 w-5 text-gray-300","aria-hidden":"true"})}),(0,l.jsx)("span",{className:"ml-3 block truncate",children:"No profile selected"}),(0,l.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,l.jsx)(m.Z,{className:"h-5 w-5 text-gray-300","aria-hidden":"true"})})]})}),(0,l.jsx)(c.u,{show:t,as:r.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,l.jsx)(o.O_,{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:n.map(e=>(0,l.jsx)(o.wt,{className:e=>{let{focus:s}=e;return(0,f.AK)(s?"bg-blue-500 text-white":"text-gray-900","relative cursor-default select-none py-2 pl-3 pr-9")},value:e.id,children:s=>{let{selected:t,focus:r}=s;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:(0,f.AK)(p.includes(e.status)?"bg-gray-200":e.status===f.$J.HEALTHY?"bg-green-500":e.status===f.$J.TIMEOUT||e.status===f.$J.FAILED?"bg-red-500":e.status===f.$J.SUBMITTED?"bg-yellow-500":e.status===f.$J.STARTING||e.status===f.$J.PENDING?"animate-pulse bg-green-500":"bg-transparent border border-gray-300","inline-block h-2 w-2 flex-shrink-0 rounded-full"),"aria-hidden":"true"}),(0,l.jsxs)("span",{className:(0,f.AK)(t?"font-semibold":"font-normal","ml-3 block truncate"),children:[e.name,(0,l.jsxs)("span",{className:"sr-only",children:[" ","is"," ",e.status===f.$J.HEALTHY?"online":"offline"]})]})]}),t?(0,l.jsx)("span",{className:(0,f.AK)(r?"text-white":"text-blue-600","absolute inset-y-0 right-0 flex items-center pr-4"),children:(0,l.jsx)(u.Z,{className:"h-5 w-5","aria-hidden":"true"})}):null]})}},e.id))})})]})]})}})}var b=t(9055),v=t(3365),N=t(322),y=t(8059),w=t(1331),k=t(8159),T=t(3354),E=t(3347);let _=(e,s)=>{let t=Math.abs(s-e),l=t%1e3,r=(t=(t-l)/1e3)%60,n=(t=(t-r)/60)%60,a=(t=(t-n)/60)%24,i=(t-a)/24;return i>0?"".concat(i," days ").concat(n," min"):a>0?"".concat(a," hr ").concat(n," min"):n>0?"".concat(n," min ").concat(r," sec"):"".concat(r," sec")},S=e=>{let{refTime:s}=e,[t,n]=r.useState(new Date);return r.useEffect(()=>{let e=setInterval(()=>{n(new Date)},3e4);return()=>clearInterval(e)},[]),(0,l.jsx)("div",{children:_(s,t)})};function I(e){let{service:s,profile:t,task:n}=e,{mutate:a}=(0,h.Su)(t,n),[i,o]=r.useState(!1),c=async()=>{if(null!=s){o(!0);try{await (0,E.Pp)(s.id),await a()}catch(e){console.error("An error occurred while stopping a service:",e)}o(!1)}},d=async()=>{if(null!=s){o(!0);try{await (0,E.wo)(s.id),await a()}catch(e){console.error("An error occurred while deleting a service:",e)}o(!1)}},m=()=>{if(!s||(null==s?void 0:s.status)==null)return!1;switch(s.status){case f.$J.UNHEALTHY:case f.$J.HEALTHY:return!0;case f.$J.STARTING:case f.$J.PENDING:case f.$J.SUBMITTED:case f.$J.STOPPED:case f.$J.EXPIRED:case f.$J.TIMEOUT:case f.$J.FAILED:default:return!1}};return t&&!s?(0,l.jsx)(l.Fragment,{}):t?(0,l.jsx)("div",{className:"flex flex-row justify-start",children:(0,l.jsxs)("div",{className:"grow flex flex-col justify-center mt-3 mb-0",children:[(0,l.jsxs)("div",{className:"mt-2 ml-1 font-light text-sm sm:flex sm:flex-col",children:[(0,l.jsxs)("div",{className:"mb-1 ml-0 inline-flex justify-start items-center",children:[(0,l.jsx)(b.Z,{className:"h-6 w-6 text-gray-600 mr-1"}),(0,l.jsx)("div",{className:"grow font-medium text-sm mr-1",children:"Model "}),(null==s?void 0:s.model)?s.model.split("/")[1]||s.model:"-"]}),(0,l.jsxs)("div",{className:"mb-1 ml-0 inline-flex justify-start items-center capitalize",children:[(0,l.jsx)(v.Z,{className:"h-6 w-6 text-gray-600 mr-1"}),(0,l.jsx)("div",{className:"grow font-medium text-sm mr-1",children:"Status "}),i?(0,l.jsx)("div",{className:"bg-gray-300 rounded-md h-4 w-28 animate-pulse"}):(0,l.jsx)("div",{className:(null==s?void 0:s.status)===f.$J.STARTING?"animate-pulse":"",children:(null==s?void 0:s.status)?s.status.toLowerCase():"-"})]}),(0,l.jsxs)("div",{className:"mb-1 ml-0 inline-flex items-center",children:[(0,l.jsx)(N.Z,{className:"h-6 w-6 text-gray-600 mr-1"}),(0,l.jsx)("div",{className:"grow font-medium text-sm mr-1",children:"Time "}),(null==s?void 0:s.created_at)&&m()?(0,l.jsx)(S,{refTime:new Date(s.created_at)}):"-"]}),(0,l.jsxs)("div",{className:"mb-1 ml-0 inline-flex items-center",children:[(0,l.jsx)(y.Z,{className:"h-6 w-6 text-gray-600 mr-1"}),(0,l.jsx)("div",{className:"grow font-medium text-sm mr-1",children:"Host "}),(null==s?void 0:s.host)&&m()?s.port?"".concat(s.host,":").concat(s.port):s.host:"-"]}),(0,l.jsxs)("div",{className:"mb-1 ml-0 inline-flex items-center",children:[(0,l.jsx)(w.Z,{className:"h-6 w-6 text-gray-600 mr-1"}),(0,l.jsx)("div",{className:"grow font-medium text-sm mr-1",children:"Cores "}),(null==s?void 0:s.ntasks_per_node)||"-"]}),(0,l.jsxs)("div",{className:"mb-1 ml-0 inline-flex items-center",children:[(0,l.jsx)(k.Z,{className:"h-6 w-6 text-gray-600 mr-1"}),(0,l.jsx)("div",{className:"grow font-medium text-sm mr-1",children:"Memory "}),(null==s?void 0:s.mem)||"-"]}),(0,l.jsxs)("div",{className:"mb-1 ml-0 inline-flex items-center",children:[(0,l.jsx)(T.Z,{className:"h-6 w-6 text-gray-600 mr-1"}),(0,l.jsx)("div",{className:"grow font-medium text-sm mr-1",children:"GPU "}),(null==s?void 0:s.gres)?(null==s?void 0:s.gres)>0?"\uD83D\uDD25".repeat(s.gres):"\uD83E\uDDCA":"-"]}),(null==s?void 0:s.updated_at)?(0,l.jsxs)("div",{className:"grow text-center mt-2 font-light text-xs mb-4",children:["Last updated",(0,l.jsx)(S,{refTime:new Date(s.updated_at),currentTime:new Date})]}):(0,l.jsx)("div",{className:"grow text-center mt-2 font-light text-xs mb-2",children:(0,l.jsx)("div",{})})]}),(()=>{if(!s)return console.warn("Service is missing."),null;if((null==s?void 0:s.status)==null)return null;switch(s.status){case f.$J.UNHEALTHY:case f.$J.HEALTHY:return(0,l.jsx)("button",{type:"button",className:"w-full flex flex-row justify-center gap-x-2 rounded-md  bg-transparent px-3.5 py-1.5 text-sm font-regular shadow-sm  hover:bg-slate-50 focus-visible:outline focus-visible:outline-2  focus-visible:outline-offset-2 border",onClick:c,children:"Stop"});case f.$J.STARTING:case f.$J.PENDING:case f.$J.SUBMITTED:return(0,l.jsx)("button",{type:"button",className:"w-full flex flex-row justify-center gap-x-2 rounded-md  bg-transparent px-3.5 py-1.5 text-sm font-regular shadow-sm  hover:bg-slate-50 focus-visible:outline focus-visible:outline-2  focus-visible:outline-offset-2 border",onClick:c,children:"Cancel"});case f.$J.STOPPED:case f.$J.EXPIRED:case f.$J.TIMEOUT:case f.$J.FAILED:return(0,l.jsx)("button",{type:"button",className:"w-full flex flex-row justify-center gap-x-2 rounded-md  bg-transparent px-3.5 py-1.5 text-sm font-regular shadow-sm  hover:bg-slate-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 border",onClick:d,children:"Delete"});default:return null}})()]})}):(0,l.jsx)("div",{className:"flex flex-row justify-start",children:(0,l.jsxs)("div",{className:"grow flex flex-col justify-center mt-3 mb-0",children:[(0,l.jsxs)("div",{className:"mt-2 ml-1 font-light text-sm sm:flex sm:flex-col text-gray-400",children:[(0,l.jsxs)("div",{className:"mb-1 ml-0 inline-flex justify-start items-center",children:[(0,l.jsx)(b.Z,{className:"h-6 w-6 text-gray-300 mr-1"}),(0,l.jsx)("div",{className:"grow font-regular text-sm mr-1",children:"Model "}),(0,l.jsx)("span",{className:"mr-2",children:"-"})]}),(0,l.jsxs)("div",{className:"mb-1 ml-0 inline-flex justify-start items-center capitalize",children:[(0,l.jsx)(v.Z,{className:"h-6 w-6 text-gray-300 mr-1"}),(0,l.jsx)("div",{className:"grow font-regular text-sm mr-1",children:"Status "}),(0,l.jsx)("span",{className:"mr-2",children:"-"})]}),(0,l.jsxs)("div",{className:"mb-1 ml-0 inline-flex items-center",children:[(0,l.jsx)(N.Z,{className:"h-6 w-6 text-gray-300 mr-1"}),(0,l.jsx)("div",{className:"grow font-regular text-sm mr-1",children:"Time "}),(0,l.jsx)("span",{className:"mr-2",children:"-"})]}),(0,l.jsxs)("div",{className:"mb-1 ml-0 inline-flex items-center",children:[(0,l.jsx)(y.Z,{className:"h-6 w-6 text-gray-300 mr-1"}),(0,l.jsx)("div",{className:"grow font-regular text-sm mr-1",children:"Host "}),(0,l.jsx)("span",{className:"mr-2",children:"-"})]}),(0,l.jsxs)("div",{className:"mb-1 ml-0 inline-flex items-center",children:[(0,l.jsx)(w.Z,{className:"h-6 w-6 text-gray-300 mr-1"}),(0,l.jsx)("div",{className:"grow font-regular text-sm mr-1",children:"Cores "}),(0,l.jsx)("span",{className:"mr-2",children:"-"})]}),(0,l.jsxs)("div",{className:"mb-1 ml-0 inline-flex items-center",children:[(0,l.jsx)(k.Z,{className:"h-6 w-6 text-gray-300 mr-1"}),(0,l.jsx)("div",{className:"grow font-regular text-sm mr-1",children:"Memory "}),(0,l.jsx)("span",{className:"mr-2",children:"-"})]}),(0,l.jsxs)("div",{className:"mb-1 ml-0 inline-flex items-center",children:[(0,l.jsx)(T.Z,{className:"h-6 w-6 text-gray-300 mr-1"}),(0,l.jsx)("div",{className:"grow font-regular text-sm mr-1",children:"GPU "}),(0,l.jsx)("span",{className:"mr-2",children:"-"})]})]}),(0,l.jsxs)("div",{className:"grow text-center mt-2 font-light text-xs mb-4 text-gray-300",children:["Last updated",(0,l.jsx)("div",{children:"-"})]})]})})}function J(e){let{profile:s,task:t,children:n}=e,{selectedService:a}=(0,r.useContext)(g.o);return(0,l.jsxs)("div",{children:[(0,l.jsx)(j,{profile:s,task:t}),(0,l.jsx)(I,{service:a,profile:s,task:t}),n]})}var F=t(4405);function C(e){let{header:s,message:t}=e;return(0,l.jsx)("div",{className:"border-l-4 border-yellow-400 bg-yellow-50 p-3",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)(d.Z,{className:"h-5 w-5 text-yellow-400","aria-hidden":"true"})}),(0,l.jsxs)("div",{className:"ml-3",children:[(0,l.jsx)("div",{children:(0,l.jsx)("p",{className:"text-sm text-yellow-700",children:s})}),(0,l.jsx)("div",{children:(0,l.jsx)("p",{className:"font-light text-yellow-700 hover:text-yellow-600",children:t})})]})]})})}var P=t(1677);function $(e){let{header:s,message:t}=e;return(0,l.jsx)("div",{className:"border-l-4 border-blue-400 bg-blue-50 p-4",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)(P.Z,{className:"h-5 w-5 text-blue-400","aria-hidden":"true"})}),(0,l.jsx)("div",{className:"ml-3",children:(0,l.jsxs)("div",{className:"text-sm text-blue-600",children:[s+" ",(0,l.jsx)("div",{className:"font-light text-blue-600 hover:text-blue-500",children:t})]})})]})})}function A(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter(Boolean).join(" ")}function Z(e){let{models:s,setRepoId:t,disabled:n}=e,[d,x]=(0,r.useState)(null),h=s?s.filter((e,s,t)=>t.map(e=>e.repo_id).indexOf(e.repo_id)===s):[];return((0,r.useEffect)(()=>{d&&t(d.repo_id)},[d,t]),(0,r.useEffect)(()=>{s&&s.length>0?x(s[0]):x(null)},[s]),null===d)?(0,l.jsx)(l.Fragment,{}):(0,l.jsx)(a.g,{disabled:n,children:(0,l.jsx)(o.Ri,{value:d,onChange:function(e){x(e)},children:e=>{let{open:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.__,{className:"block text-sm font-medium leading-6 text-gray-900",children:"Model"}),(0,l.jsxs)("div",{className:"relative mt-2",children:[(0,l.jsxs)(o.Y4,{className:A(n?"bg-gray-100 ring-gray-300 ring-1":"bg-white focus:outline-none focus:ring-2 focus:ring-blue-500","relative w-full cursor-default rounded-md py-1.5 pl-1 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 sm:text-sm sm:leading-6"),children:[(0,l.jsx)("span",{className:"flex items-center",children:(0,l.jsx)("span",{className:"ml-2 mr-2 block truncate",children:d.repo_id})}),!n&&(0,l.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,l.jsx)(m.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,l.jsx)(c.u,{show:s,as:r.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,l.jsx)(o.O_,{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:h.map(e=>(0,l.jsx)(o.wt,{className:e=>{let{focus:s}=e;return A(s?"bg-blue-500 text-white":"text-gray-900","relative cursor-default select-none py-2 pl-1 pr-9")},value:e,children:s=>{let{selected:t,focus:r}=s;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"flex items-center",children:(0,l.jsx)("span",{className:A(t?"font-semibold":"font-normal","ml-3 block truncate"),children:e.repo_id})}),t?(0,l.jsx)("span",{className:A(r?"text-white":"text-blue-600","absolute inset-y-0 right-0 flex items-center pr-4"),children:(0,l.jsx)(u.Z,{className:"h-5 w-5","aria-hidden":"true"})}):null]})}},e.revision))})})]})]})}})})}function D(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter(Boolean).join(" ")}function L(e){let{models:s,repoId:t,setModel:n,disabled:d}=e,[x,h]=(0,r.useState)(null),f=s.filter(e=>e.repo_id===t);return((0,r.useEffect)(()=>{let e=s.filter(e=>e.repo_id===t);e&&e.length>0?h(e[0]):h(null)},[s,t]),(0,r.useEffect)(()=>{x&&n(x)},[x,n]),null===x)?(0,l.jsx)(l.Fragment,{}):(0,l.jsx)(a.g,{disabled:d,children:(0,l.jsx)(o.Ri,{value:x,onChange:function(e){h(e)},children:e=>{let{open:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.__,{className:"block text-sm font-medium leading-6 text-gray-900",children:"Revision"}),(0,l.jsxs)("div",{className:"relative mt-2",children:[(0,l.jsxs)(o.Y4,{className:D(d?"bg-gray-100 ring-gray-300 ring-1":"bg-white focus:outline-none focus:ring-2 focus:ring-blue-500","relative w-full cursor-default rounded-md py-1.5 pl-1 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 sm:text-sm sm:leading-6"),children:[(0,l.jsx)("span",{className:"flex items-center",children:(0,l.jsx)("span",{className:"ml-2 mr-2 block truncate",children:x.revision})}),!d&&(0,l.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,l.jsx)(m.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,l.jsx)(c.u,{show:s,as:r.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,l.jsx)(o.O_,{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:f.map(e=>(0,l.jsx)(o.wt,{className:e=>{let{focus:s}=e;return D(s?"bg-blue-500 text-white":"text-gray-900","relative cursor-default select-none py-2 pl-1 pr-9")},value:e,children:s=>{let{selected:t,focus:r}=s;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"flex items-center",children:(0,l.jsx)("span",{className:D(t?"font-semibold":"font-normal","ml-3 block truncate"),children:e.revision})}),t?(0,l.jsx)("span",{className:D(r?"text-white":"text-blue-600","absolute inset-y-0 right-0 flex items-center pr-4"),children:(0,l.jsx)(u.Z,{className:"h-5 w-5","aria-hidden":"true"})}):null]})}},e.revision))})})]})]})}})})}var O=t(6824);let U=e=>{if(""===e)return"";let[s,t,l]=e.split(":").map(e=>Number.parseInt(e));return 60*s+t},M=e=>Math.min(Math.max(Math.ceil(e/36),1),4);function H(e){let{models:s,services:t,setModel:n,jobOptions:a,setJobOptions:i,setValidationErrors:o,disabled:c,profile:m,task:u,children:x}=e,[h,f]=r.useState(null),g=new Map([["text-generation","text-generation"],["speech-recognition","automatic-speech-recognition"]]);return m?(0,l.jsxs)("div",{className:"max-w-2xl space-y-6 md:col-span-2",children:[(0,l.jsx)("fieldset",{children:(0,l.jsx)(O.Z,{type:"text",label:"Name",help:"Give your service a name (or use our wonderful suggestion).",value:a.name,setValue:e=>{i(s=>({...s,name:e}))},validate:e=>(function(e,s){if(s.map(e=>e.name).includes(e)){let e={message:"Name is already in use by another service.",ok:!1};return o(s=>({...s,name:e})),e}return o(e=>({...e,name:null})),{ok:!0}})(e,t),disabled:c})}),s.length?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("fieldset",{children:(0,l.jsx)(Z,{models:s,repoId:h,setRepoId:f,disabled:c})}),(0,l.jsx)("fieldset",{children:(0,l.jsx)(L,{models:s,repoId:h,setModel:n,disabled:c})})]}):function(){let e=u.replaceAll("-"," "),s="https://huggingface.co/models?pipeline_tag=".concat(g.get(u),"&sort=trending");return(0,l.jsx)("div",{className:"rounded-md bg-yellow-50 border-yellow-100 ring-1 ring-yellow-300 p-4 mt-2 mb-4",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)(d.Z,{"aria-hidden":"true",className:"h-5 w-5 text-yellow-400"})}),(0,l.jsxs)("div",{className:"ml-3",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"No models are available"}),(0,l.jsx)("div",{className:"mt-2 font-light text-sm text-yellow-800",children:(0,l.jsxs)("p",{children:["Switch profiles or download a ",e," model from ",(0,l.jsx)("a",{className:"underline",href:s,children:"Hugging Face"}),"."]})})]})]})})}(),"slurm"===m.type?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("fieldset",{children:[(0,l.jsx)("legend",{className:"text-sm font-semibold leading-6 text-gray-900",children:"Time"}),(0,l.jsx)("p",{className:"mt-1 text-sm leading-6 text-gray-600",children:"How long would you like to run this model?"}),(0,l.jsx)("div",{className:"mt-3 space-y-3",children:(0,l.jsx)(O.Z,{type:"number",units:"minutes",disabled:c,value:U(a.time),setValue:e=>{i({...a,time:""===e?e:"00:".concat(String(e).padStart(2,"0"),":00")})},validate:function(e){let s=Number(String(e).trim());if(Number.isInteger(s)&&""!==s){if(s<1){let e={message:"Time should be greater than or equal to 1.",ok:!1};return o(s=>({...s,time:e})),e}if(s>180){let e={message:"Time should be less than 180.",ok:!1};return o(s=>({...s,time:e})),e}}else{let e={message:"Time should be a valid positive integer.",ok:!1};return o(s=>({...s,time:e})),e}return o(e=>({...e,time:null})),{ok:!0}}})})]}),(0,l.jsxs)("fieldset",{children:[(0,l.jsx)("legend",{className:"text-sm font-semibold leading-6 text-gray-900",children:"Resources"}),(0,l.jsx)("p",{className:"mt-1 text-sm leading-6 text-gray-600",children:"Request resources for the model."}),(0,l.jsx)("div",{className:"mt-2 text-sm font-medium inline-flex",children:(0,l.jsx)(C,{header:"Warning",message:"Changing the settings below may cause your service to fail or over utilize resources."})}),(0,l.jsxs)("div",{className:"mt-6 space-y-3",children:[(0,l.jsx)(O.Z,{type:"number",disabled:c,label:"CPU",units:"cores",value:a.ntasks_per_node,setValue:e=>{i(s=>({...s,ntasks_per_node:e}))},validate:function(e){let s=Number(String(e).trim());if(Number.isInteger(s)){if(s<8){let e={message:"CPU cores should be greater than or equal to 8.",ok:!1};return o(s=>({...s,cpus:e})),e}if(s>128){let e={message:"CPU cores should be less than 128.",ok:!1};return o(s=>({...s,cpus:e})),e}}else{let e={message:"CPU cores should be a valid integer.",ok:!1};return o(s=>({...s,cpus:e})),e}return o(e=>({...e,cpus:null})),{ok:!0}}}),(0,l.jsx)(O.Z,{type:"number",disabled:c,label:"Memory",units:"GB",value:a.mem,setValue:e=>{i(s=>({...s,mem:e,gres:s.gres>0?M(e):0}))},validate:function(e){let s=Number(String(e).trim());if(Number.isInteger(s)){if(s<8){let e={message:"Memory should be greater than or equal to 8 GB.",ok:!1};return o(s=>({...s,mem:e})),e}if(s>256){let e={message:"Memory should be less than 256.",ok:!1};return o(s=>({...s,mem:e})),e}}else{let e={message:"Memory should be a valid integer.",ok:!1};return o(s=>({...s,mem:e})),e}return o(e=>({...e,mem:null})),{ok:!0}}}),(0,l.jsxs)("div",{className:"relative flex gap-x-3",children:[(0,l.jsx)("div",{className:"flex h-6 items-center",children:(0,l.jsx)("input",{id:"gpu-checkbox",name:"gpu-checkbox",type:"checkbox",disabled:c,checked:a.gres>0,onChange:()=>{a.gres>0?i(e=>({...e,gres:0})):i(e=>({...e,gres:M(e.mem)}))},className:"h-4 w-4 rounded border-gray-300 text-blue-500 focus:ring-blue-500 disabled:bg-gray-100"})}),(0,l.jsxs)("div",{className:"text-sm leading-6",children:[(0,l.jsx)("label",{htmlFor:"offers",className:"font-medium text-gray-900",children:"Accelerate"}),(0,l.jsx)("p",{className:"text-gray-500",children:"Use GPUs to accelerate inference. Recommended for most models."})]})]})]})]})]}):(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("fieldset",{children:[(0,l.jsx)("legend",{className:"text-sm font-semibold leading-6 text-gray-900",children:"Resources"}),(0,l.jsx)("p",{className:"mt-1 text-sm leading-6 text-gray-600",children:"Request resources for the model."}),(0,l.jsx)("div",{className:"mt-2 text-sm font-medium inline-flex",children:(0,l.jsx)($,{header:"Note",message:"Services running locally can utilize all CPU, memory and GPU resources made available through the container provider and will run until stopped."})}),(0,l.jsx)("div",{className:"mt-6 space-y-3",children:(0,l.jsxs)("div",{className:"relative flex gap-x-3",children:[(0,l.jsx)("div",{className:"flex h-6 items-center",children:(0,l.jsx)("input",{id:"gpu-checkbox",name:"gpu-checkbox",type:"checkbox",disabled:c,checked:a.gres>0,onChange:()=>{a.gres>0?i(e=>({...e,gres:0})):i(e=>({...e,gres:1}))},className:"h-4 w-4 rounded border-gray-300 text-blue-500 focus:ring-blue-500 disabled:bg-gray-100"})}),(0,l.jsxs)("div",{className:"text-sm leading-6",children:[(0,l.jsx)("label",{htmlFor:"offers",className:"font-medium text-gray-900",children:"Accelerate"}),(0,l.jsx)("p",{className:"text-gray-500",children:"Use GPUs to accelerate inference. Recommended for most models."})]})]})})]})}),x]}):(0,l.jsx)(l.Fragment,{})}var R=t(1586),G=t(6332);function Y(e){let{error:s,onClick:t}=e;return(0,l.jsx)("div",{className:"rounded-md bg-red-50 p-4 mb-4",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"shrink-0",children:(0,l.jsx)(R.Z,{"aria-hidden":"true",className:"h-5 w-5 text-red-400"})}),(0,l.jsxs)("div",{className:"ml-3",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Failed to launch service."}),(0,l.jsx)("div",{className:"mt-2 text-sm text-red-700",children:(0,l.jsx)("ul",{role:"list",className:"list-disc space-y-1 pl-5",children:(0,l.jsx)("li",{children:s.message})})})]}),(0,l.jsx)("div",{className:"ml-auto pl-3",children:(0,l.jsx)("div",{className:"-mx-1.5 -my-1.5",children:(0,l.jsxs)("button",{type:"button",onClick:t,className:"inline-flex rounded-md bg-red-50 p-1.5 text-red-500 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-red-600 focus:ring-offset-2 focus:ring-offset-red-50",children:[(0,l.jsx)("span",{className:"sr-only",children:"Dismiss"}),(0,l.jsx)(G.Z,{"aria-hidden":"true",className:"h-5 w-5"})]})})})]})})}function B(){return"blackfish-".concat(1e4+Math.floor(11e3*Math.random()))}function z(e){let{task:s,open:t,setOpen:n,defaultContainerOptions:a,containerOptions:i,setContainerOptions:o,launchSuccess:d,setLaunchSuccess:m,isLaunching:u,setIsLaunching:x,launchError:p,setLaunchError:j,validationErrors:b,setValidationErrors:v,profile:N,children:y}=e,w=r.useMemo(()=>({name:B(),time:"00:30:00",ntasks_per_node:8,mem:16,gres:1,partition:null,constraint:null}),[]),{services:k,isLoading:T,error:_,mutate:S}=(0,h.Su)(N,s),{models:J,isLoading:C,error:P}=(0,h.bP)(N,s),{selectedService:$,setSelectedServiceId:A}=(0,r.useContext)(g.o),[Z,D]=r.useState({...w,name:B()}),[L,O]=(0,r.useState)(null);(0,r.useEffect)(()=>{J&&J.length>0&&O(J[0])},[J]),(0,r.useEffect)(()=>{t&&(D({...w,name:B()}),o({...a}),m(!1),x(!1),j(null),v({}))},[t,o,w,a,m,j,x,v]);let U=(0,r.useRef)(null),M=async()=>{console.debug("from handleFormSubmit: attempting to launch service"),x(!0),j(null);let e=await (0,E.UY)(s,L,Z,i,N);if(!e.ok){let s=Error("A service request failed with message:",await e.text());console.error(s),x(!1),j(s);return}let t=await e.json();console.debug("from handleFormSubmit: received response",t.id),console.debug("from handleFormSubmit: attempting to find service");for(let e=0;e<3;e+=1){await (0,f._v)(5e3);let s=await S(),l=s.map(e=>e.id).indexOf(t.id);if(l>-1){let e=s[l];console.debug("from handleFormSubmit: found service",e),A(e.id),x(!1),m(!0);break}if(2===e){let e=Error("Maximum wait time (".concat(15," seconds) exceeded."));console.error(e),x(!1),j(e)}else console.debug("from handleFormSubmit: service details not found: re-trying in ".concat(5," seconds (attempts remaining: ").concat(3-e,")"))}};return(0,l.jsx)(c.u,{show:t,as:r.Fragment,children:(0,l.jsxs)(F.Vq,{as:"div",className:"relative z-10",initialFocus:U,onClose:()=>{n(!1)},children:[(0,l.jsx)(c.x,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,l.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),(0,l.jsx)("div",{className:"fixed inset-0 z-10 w-screen overflow-y-auto",children:(0,l.jsx)("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:(0,l.jsx)(c.x,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,l.jsxs)(F.EM,{className:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl sm:p-6 sm:pl-6",children:[(0,l.jsx)("div",{children:(0,l.jsxs)("div",{children:[(0,l.jsx)(F.$N,{as:"h3",className:"text-base font-semibold leading-6 text-gray-900"}),p&&(0,l.jsx)(Y,{error:p,onClick:()=>j(null)}),(0,l.jsx)("form",{className:"mt-2",children:(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-x-12 gap-y-10 border-b border-gray-900/10 pb-12 md:grid-cols-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-base font-semibold leading-7 text-gray-900",children:"Summary"}),u?(0,l.jsx)("div",{className:"flex justify-center items-center h-48",children:(0,l.jsxs)("span",{className:"relative flex h-5 w-5",children:[(0,l.jsx)("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"}),(0,l.jsx)("span",{className:"relative inline-flex rounded-full h-5 w-5 bg-blue-500"})]})}):(0,l.jsx)(I,{service:d?$:{model:L?L.repo_id:null,name:Z.name,status:null,created_at:null,updated_at:null,host:N?"local"===N.type?"localhost":N.host:null,port:null,ntasks_per_node:N?"local"===N.type?null:Z.ntasks_per_node:null,mem:N?"local"===N.type?null:Z.mem:null,gres:Z.gres},profile:N})]}),(0,l.jsx)(H,{models:J,services:k,setModel:O,jobOptions:Z,setJobOptions:D,setValidationErrors:v,disabled:u||p||d,profile:N,task:s,children:y})]})})})]})}),d?(0,l.jsx)("div",{className:"mt-5 sm:mt-6 sm:grid sm:grid-flow-row-dense sm:grid-cols-2 sm:gap-3",children:(0,l.jsx)("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:col-start-1 sm:col-span-2 sm:mt-0",onClick:()=>{n(!1)},ref:U,children:"Close"})}):(0,l.jsxs)("div",{className:"mt-5 sm:mt-6 sm:grid sm:grid-flow-row-dense sm:grid-cols-2 sm:gap-3",children:[(0,l.jsx)("button",{type:"button",className:"inline-flex w-full justify-center rounded-md bg-blue-500 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 sm:col-start-2 disabled:bg-blue-200",onClick:M,disabled:!(!b||0===Object.keys(b).length||Object.values(b).every(e=>null===e))||u,children:"Launch"}),(0,l.jsx)("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:col-start-1 sm:mt-0",onClick:()=>n(!1),ref:U,children:"Cancel"})]})]})})})})]})})}function K(e){let{profile:s,task:t,defaultContainerOptions:n,ContainerOptionsFormComponent:a}=e,{models:i,isLoading:o}=(0,h.bP)(s,t),[c,d]=r.useState(!1),[m,u]=r.useState(!1),[x,f]=r.useState(!1),[g,p]=r.useState(null),[j,b]=r.useState({...n}),[v,N]=r.useState({});return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"pb-4 mb-4 border-b",children:(0,l.jsx)("button",{type:"button",className:"mt-1 w-full flex flex-row justify-center gap-x-2 rounded-md bg-tranparent px-3.5 py-1.5 text-sm font-regular shadow-sm hover:bg-blue-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 border bg-blue-500 text-white disabled:bg-gray-50 disabled:text-gray-400 disabled:animate-pulse",onClick:()=>{d(!0)},disabled:!s||!i&&o,children:"Open Launcher"})}),(0,l.jsx)(z,{task:t,open:c,setOpen:d,defaultContainerOptions:n,containerOptions:j,setContainerOptions:b,launchSuccess:m,setLaunchSuccess:u,isLaunching:x,setIsLaunching:f,launchError:g,setLaunchError:p,validationErrors:v,setValidationErrors:N,profile:s,children:(0,l.jsx)(a,{containerOptions:j,setContainerOptions:b,setValidationErrors:N,disabled:x||m})})]})}function V(e){let{task:s,defaultContainerOptions:t,ContainerOptionsFormComponent:a,children:i}=e,{profile:o,setProfile:c}=(0,r.useContext)(n.JT);return(0,l.jsxs)("div",{className:"flex flex-col w-96 p-8 pr-12 bg-white overflow-auto",children:[(0,l.jsx)(n.ZP,{selectedProfile:o,setSelectedProfile:c}),(0,l.jsx)(J,{profile:o,task:s,children:(0,l.jsx)(K,{profile:o,task:s,defaultContainerOptions:t,ContainerOptionsFormComponent:a})}),i]})}},6936:function(e,s,t){t.d(s,{$:function(){return r}});var l=t(7437);function r(e){let{children:s}=e;return(0,l.jsx)("div",{className:"flex flex-col grow p-4 pt-6 pl-8 bg-white",children:s})}},9657:function(e,s,t){t.d(s,{x:function(){return r}});var l=t(257);let r=l.env.NEXT_PUBLIC_BLACKFISH_URL?l.env.NEXT_PUBLIC_BLACKFISH_URL:""},408:function(e,s,t){t.d(s,{Su:function(){return i},bP:function(){return a},nw:function(){return o},of:function(){return c}});var l=t(3861),r=t(3347),n=t(7203);let a=(e,s)=>{let{data:t,error:n,isLoading:a}=(0,l.ZP)("models?profile=".concat(e?e.name:"default","&image=").concat(s),r.fm);return{models:t,error:n,isLoading:a}},i=(e,s)=>{let{data:t,error:a,isLoading:i,mutate:o}=(0,l.ZP)(()=>!!e&&"services?profile=".concat(e?e.name:null,"&image=").concat(s.replace("-","_")),r.Qz,{refreshInterval:3e4}),c=[n.$J.HEALTHY,n.$J.STARTING,n.$J.PENDING,n.$J.SUBMITTED,n.$J.STOPPED,n.$J.EXPIRED,n.$J.TIMEOUT,n.$J.FAILED];return{services:t?[...t].sort((e,s)=>{let t=c.indexOf(e.status)-c.indexOf(s.status);return 0!==t?t:new Date(s.created_at)-new Date(e.created_at)}):[],error:a,isLoading:i,mutate:o}},o=()=>{let{data:e,error:s,isLoading:t,mutate:n}=(0,l.ZP)("profiles",r.lU);return{profiles:e,error:s,isLoading:t,mutate:n}},c=e=>{let{data:s,error:t,isLoading:n,mutate:a}=(0,l.ZP)(e?"files?path=".concat(e):null,r.uB);return{files:s,error:t,isLoading:n,refresh:a}}},3347:function(e,s,t){t.d(s,{Pp:function(){return d},Qz:function(){return a},UY:function(){return o},fm:function(){return n},lU:function(){return i},uB:function(){return r},wo:function(){return m}});var l=t(9657);async function r(e){let s=await fetch("".concat(l.x,"/api/").concat(e));if(!s.ok){console.debug("from fetchFiles: failed to fetch files (status=".concat(s.status,")"));let e=Error("Failed to fetch files.");throw e.status=s.status,e}return s.json()}async function n(e){let s=await fetch("".concat(l.x,"/api/").concat(e,"&refresh=true"));if(!s.ok){console.debug("from fetchModels: failed to fetch models (status=".concat(s.status,")"));let e=Error("Failed to fetch models.");throw e.status=s.status,e}return(await s.json()).map(e=>({repo_id:e.repo,revision:e.revision,profile:e.profile,image:e.image,model_dir:e.model_dir}))}async function a(e){let s=await fetch("".concat(l.x,"/api/").concat(e));if(!s.ok){console.debug("from fetchServices: failed to fetch services (status=".concat(s.status,")"));let e=Error("Failed to fetch services.");throw e.status=s.status,e}return await s.json()}async function i(){let e=await fetch("".concat(l.x,"/api/profiles"));if(!e.ok){console.debug("from fetchProfiles: failed to fetch profiles (status=".concat(e.status,")"));let s=Error("Failed to fetch profiles.");throw s.status=e.status,s}return await e.json()}async function o(e,s,t,r,n){let a;if("slurm"===n.type)a={name:t.name,image:e.replace("-","_"),repo_id:s.repo_id,profile:n,container_config:{...r,revision:s.revision,model_dir:"speech-recognition"===e?c(s.model_dir):s.model_dir,port:null},job_config:t,mount:r.input_dir,grace_period:180};else if("local"===n.type){let i=await fetch("".concat(l.x,"/api/ports"));if(!i.ok){let e=Error("Unable to find available local port");throw e.status=i.status,e}let o=await i.json();a={name:t.name,image:e.replace("-","_"),repo_id:s.repo_id,profile:n,container_config:{...r,revision:s.revision,model_dir:"speech-recognition"===e?c(s.model_dir):s.model_dir,port:o},job_config:{gres:t.gres},mount:r.input_dir,grace_period:180}}else throw Error("Unsupported job profile type: ".concat(n.type));return console.debug("from runService: body =",a),await fetch("".concat(l.x,"/api/services"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}function c(e){let s=e.split("/"),t=s.length;return s.slice(0,t-1).join("/")}async function d(e){let s=JSON.stringify({delay:0}),t=await fetch("".concat(l.x,"/api/services/").concat(e,"/stop"),{method:"PUT",headers:{"Content-Type":"application/json"},mode:"cors",body:s});if(!t.ok)throw Error("Failed to stop the service");return t.json()}async function m(e){let s=JSON.stringify({force:!1});if(!(await fetch("".concat(l.x,"/api/services/?id=").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"},mode:"cors",body:s})).ok)throw Error("Failed to delete the service")}},7203:function(e,s,t){t.d(s,{$J:function(){return n},AK:function(){return r},_v:function(){return l}});let l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(s=>setTimeout(s,e))},r=function(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter(Boolean).join(" ")},n=Object.freeze({SUBMITTED:"submitted",PENDING:"pending",STARTING:"starting",HEALTHY:"healthy",UNHEALTHY:"unhealthy",TIMEOUT:"timeout",STOPPED:"stopped",EXPIRED:"expired",FAILED:"failed"})},7660:function(e,s,t){t.d(s,{Z:function(){return n},o:function(){return r}});var l=t(7437);let r=(0,t(2265).createContext)();function n(e){let{selectedService:s,setSelectedServiceId:t,children:n}=e;return(0,l.jsx)(r.Provider,{value:{selectedService:s,setSelectedServiceId:t},children:n})}}}]);