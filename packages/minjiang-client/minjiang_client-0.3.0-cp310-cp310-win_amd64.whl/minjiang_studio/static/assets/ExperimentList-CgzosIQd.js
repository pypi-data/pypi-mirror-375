import{d as K,c as P,e as g,f as c,K as B,U as X,V as F,W as rt,a as _t,z as ut,b as dt,X as mt,Y as pt,r as k,L as A,o as ft,Z as gt,A as S,w as s,h as e,S as vt,O as yt,B as ht,t as _,j as a,N as kt,$ as U,n as m,a0 as wt,a1 as bt,a2 as Ct,a3 as Et,a4 as St,a5 as It,p as Tt,x as Dt,a6 as Lt,a7 as H,a8 as qt,i as xt,a9 as Nt,aa as J,ab as w,R as Rt,J as zt,T as Mt,ac as Ot,H as Bt}from"./index-B2xfjOzF.js";import{a as At}from"./task-C9WDQyL7.js";import{s as Pt,g as Vt,a as $t}from"./exp-4R2p8HrG.js";import{u as jt}from"./useInterval-BDaf0Qf8.js";import{_ as Ft}from"./Space-CTHl3IEW.js";import{R as Ut,D as Ht,E as Jt}from"./ExpsTpl-CIsWGbRd.js";import{c as Wt}from"./index-DgITQ6my.js";import{C as Gt}from"./ChevronBack-Dd-Qd36m.js";import{A as W}from"./Add-jjALUlFz.js";import"./DynamicForm.vue_vue_type_script_setup_true_lang-swP-NnX1.js";import"./json-editor-vue-D7okKxhc.js";import"./debounce-D7Ri4zDg.js";import"./InputNumber-DWMBgLyt.js";import"./Add-D4qD_bnP.js";import"./FormItem-Ct9xzd5D.js";import"./Alert-BDlK74zR.js";import"./Tabs-Bx15qgEn.js";const Kt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Xt=K({name:"Eye",render:function(u,i){return g(),P("svg",Kt,i[0]||(i[0]=[c("circle",{cx:"256",cy:"256",r:"64",fill:"currentColor"},null,-1),c("path",{d:"M490.84 238.6c-26.46-40.92-60.79-75.68-99.27-100.53C349 110.55 302 96 255.66 96c-42.52 0-84.33 12.15-124.27 36.11c-40.73 24.43-77.63 60.12-109.68 106.07a31.92 31.92 0 0 0-.64 35.54c26.41 41.33 60.4 76.14 98.28 100.65C162 402 207.9 416 255.66 416c46.71 0 93.81-14.43 136.2-41.72c38.46-24.77 72.72-59.66 99.08-100.92a32.2 32.2 0 0 0-.1-34.76zM256 352a96 96 0 1 1 96-96a96.11 96.11 0 0 1-96 96z",fill:"currentColor"},null,-1)]))}}),G=(I,u)=>{var T;if(!I.length)return;const i=document.createEvent("MouseEvents");i.initEvent("click",!0,!0);const b=I.map(p=>B(X,{width:100,src:p}));let f=document.querySelector("#preview-image");if(!f){const p=document.createElement("div");p.id="preview-image",document.body.appendChild(p),f=p}b.length>1?F(B(rt,{},[B(Ft,{},b)]),f):F(b[0],f),(T=f==null?void 0:f.querySelectorAll(".n-image img")[u])==null||T.dispatchEvent(i)},Yt={class:"flex items-center mb-5 text-xl gap-2"},Zt={class:"inline-flex gap-2"},Qt={class:"flex justify-between"},te={class:"text-lg flex items-center gap-1.5"},ee={class:"break-keep"},se={class:"flex items-center gap-1.5 opacity-75 text-xs"},ae={class:"flex gap-2"},ne={key:2,class:"bg-gray-500 w-20 h-20 rounded text-center leading-4 text-xs flex items-center justify-center text-white"},oe={class:"flex gap-2 flex-col"},ie={class:"flex items-center gap-1"},le={class:"flex justify-around items-center gap-1"},ce=K({__name:"ExperimentList",setup(I){const{t:u}=_t(),i=ut(),b=dt(),f=mt(),T=pt(),p=k(),N=A({}),D=k(!1),Y=k(),V=k(),C=A({page:1,per_page:8,total:0}),$=(n,r={})=>{const o=new URLSearchParams({device_group_name:i.query.device_group_name,task_id:i.query.task_id,task_title:i.query.task_title,space_id:i.query.space_id,exp_id:String(n.exp_id),...r});window.open(`/experiment/waveforms?${o.toString()}`,"_blank")},L=k(),Z=async(n,r)=>{const[o,l]=await $t({exp_ids:n,group_name:i.query.device_group_name,create_timestamps:r});if(!o&&(l==null?void 0:l.status)===0)return l.data},R=async n=>{var v;if(!n){if(D.value)return;D.value=!0}const r=i.query.device_group_name;if(!r)return;const[o,l]=await At({...((v=Y.value)==null?void 0:v.searchParasm)||{},...Mt(C),task_id:i.query.task_id,device_group_name:r});if(n||(D.value=!1),!o&&l&&l.status===0){const y=[],E=Wt(l.data.list.map(d=>{if(N[d.exp_id]===void 0)return y.push(d.create_timestamp),d.exp_id;d.img=N[d.exp_id]}));if(E.length>0){const d=JSON.parse(JSON.stringify(l.data.list));Z(E.join(","),y.join(",")).then(q=>{q&&(Ot(q,(x,O)=>{d.some(h=>{if(h.exp_id===+O)return h.img=x,[w.COMPLETE,w.ERROR,w.CANCELED,w.HOST_DOWNLOADED].includes(h.status)&&(N[h.exp_id]=x),!0})}),L.value=d)})}L.value=l.data.list,C.total=l.data.total}},Q=()=>{b.push({name:"taskList",query:{device_group_name:i.query.device_group_name}})},tt=async n=>{const[r,o]=await Pt({exp_id:n.exp_id});!r&&(o==null?void 0:o.status)===0&&T.success("实验终止成功")},et=n=>{$(n,{dup:"1"})},st=()=>{var n;(n=V.value)==null||n.open()},at=()=>{},{start:nt,stop:ot}=jt(R,{initParams:!0,isManual:!0});ft(()=>{R(),p.value=setTimeout(()=>{nt()},5e3)}),gt(()=>{ot(),p.value!==null&&clearInterval(p.value),p.value=null});const z=k(),M=A({}),it=async n=>{if(M[String(n.exp_id)]){G([M[String(n.exp_id)]],0);return}z.value=n.exp_id;const[r,o]=await Vt({exp_id:n.exp_id,device_group_name:i.query.device_group_name,space_id:i.query.space_id});z.value=void 0,!r&&(o==null?void 0:o.status)===0&&(G([o.data.big_picture_url],0),M[String(n.exp_id)]=o.data.big_picture_url)};return(n,r)=>{const o=kt,l=ht,v=Lt,y=qt,E=xt,d=Nt,q=X,x=Tt,O=It,h=Ct,j=wt,lt=yt,ct=vt;return g(),S(d,{show:a(D)},{default:s(()=>[e(ct,{"has-sider":""},{default:s(()=>[e(lt,{class:"min-h-[500px]"},{default:s(()=>[c("div",Yt,[e(l,{onClick:Q,quaternary:""},{icon:s(()=>[e(o,{size:"26"},{default:s(()=>[e(a(Gt))]),_:1})]),default:s(()=>[c("span",null,_(a(u)("groupDetail.exps.back")),1)]),_:1}),c("span",{class:"flex-1 text-center",style:U({color:a(f).primaryColor})},_(a(u)("groupDetail.exps.taskTitle",{taskId:a(i).query.task_id,taskTitle:` " ${a(i).query.task_title} " `})),5),c("div",Zt,[e(l,{type:"primary",onClick:st},{default:s(()=>[e(o,null,{default:s(()=>[e(a(W))]),_:1}),m("  "+_(a(u)("groupDetail.exps.createFromTemplate")),1)]),_:1}),e(l,{type:"primary",onClick:at},{default:s(()=>[e(o,null,{default:s(()=>[e(a(W))]),_:1}),m("  "+_(a(u)("groupDetail.exps.createManualTask")),1)]),_:1})])]),e(j,{style:U({maxHeight:a(bt)(a(L))?"200px":"calc(100vh - 350px)"})},{default:s(()=>[e(h,{cols:"4","x-gap":"20","y-gap":"20",class:"py-1 px-1.5"},{default:s(()=>[(g(!0),P(Et,null,St(a(L),t=>(g(),S(O,{key:t.exp_id},{default:s(()=>[e(x,{rounded:"",style:{width:"100%"},"content-class":"!mb-0 !p-2",class:"hover:scale-103 hover:transform-gpu"},{default:s(()=>[c("div",Qt,[c("div",null,[c("div",te,[c("div",ee,_(t.exp_id),1),t!=null&&t.status?(g(),S(v,{key:0,color:{color:a(H)[t.status].color,textColor:"#fff"},bordered:!1,size:"small"},{default:s(()=>[m(_(a(u)(a(H)[t.status].text)),1)]),_:2},1032,["color"])):Dt("",!0),e(v,{size:"small",type:"info"},{default:s(()=>[m(_(t==null?void 0:t.progress),1)]),_:2},1024),c("div",se,[e(y,{"line-clamp":1},{default:s(()=>[m(_(t==null?void 0:t.create_time),1)]),_:2},1024)])])])]),e(y,{style:{"max-width":"100%"},class:"text-lg mt-2"},{default:s(()=>[m(_(t==null?void 0:t.title),1)]),_:2},1024),e(E,{class:"!my-3"}),c("div",ae,[c("div",null,[(t==null?void 0:t.img)===void 0?(g(),S(d,{key:0,show:!0},{default:s(()=>r[1]||(r[1]=[c("div",{class:"w-20 h-20 rounded"},null,-1)])),_:1})):t!=null&&t.img?(g(),S(d,{key:1,show:a(z)===t.exp_id},{default:s(()=>[e(q,{class:"w-20 h-20 rounded cursor-pointer",src:t==null?void 0:t.img,"preview-disabled":!0,onClick:()=>it(t)},null,8,["src","onClick"])]),_:2},1032,["show"])):(g(),P("div",ne,_(a(u)("groupDetail.exps.noresult")),1))]),c("div",oe,[c("div",ie,[e(v,{type:"warning",size:"small"},{default:s(()=>[m(_((t==null?void 0:t.template_name)==="-"?"No Template":t==null?void 0:t.template_name),1)]),_:2},1024)]),e(y,{style:{"max-width":"100%"},class:"opacity-75 text-xs","line-clamp":3},{default:s(()=>[m(_(t==null?void 0:t.description),1)]),_:2},1024)])]),e(E,{class:"!my-3"}),c("div",le,[e(l,{disabled:![a(w).RUNNING,a(w).HOST_DOWNLOADED].includes(t.status),type:"info",size:"small",class:"flex-1 !px-0.5",onClick:J(()=>tt(t),["stop"])},{icon:s(()=>[e(a(Ut))]),default:s(()=>[m(" "+_(a(u)("groupDetail.exps.stop")),1)]),_:2},1032,["disabled","onClick"]),e(l,{type:"info",size:"small",class:"flex-1",onClick:J(()=>et(t),["stop"]),disabled:(t==null?void 0:t.exp_mode)==="batch_circuit"},{icon:s(()=>[e(a(Ht))]),default:s(()=>[m(_(a(u)("expInfo.duplicate"))+" ",1)]),_:2},1032,["onClick","disabled"]),e(l,{type:"info",size:"small",class:"flex-1",disabled:(t==null?void 0:t.exp_mode)==="batch_circuit",onClick:()=>$(t)},{icon:s(()=>[e(a(Xt))]),default:s(()=>[m(_(a(u)("groupDetail.exps.preview"))+" ",1)]),_:2},1032,["disabled","onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["style"]),e(Rt,{"page-info":a(C),"onUpdate:pageInfo":r[0]||(r[0]=t=>zt(C)?C.value=t:null),"page-sizes":[8,16,24],onUpdateList:R,class:"!pb-0"},null,8,["page-info"]),e(Jt,{ref_key:"expsTplRef",ref:V},null,512)]),_:1})]),_:1})]),_:1},8,["show"])}}}),Ie=Bt(ce,[["__scopeId","data-v-fd641ae7"]]);export{Ie as default};
