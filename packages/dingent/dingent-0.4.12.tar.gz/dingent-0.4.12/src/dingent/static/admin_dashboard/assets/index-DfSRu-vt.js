import{R as j,j as e,v as be,u as Ce,c as L,x as ye,y as T,r as S,B as P,z as se,A as V,l as Ae,t as C}from"./index-BRZ4tpHq.js";import{u as B}from"./useQuery-wclctLx1.js";import{u as R,L as Ne}from"./loading-skeleton-9fdPr0DJ.js";import{m as we,r as Se,n as Pe,u as Ie,o as ke,e as De,p as _e}from"./api-BDZ8mgcX.js";import{c as Re,u as ne,a as Ee}from"./index-Dcf_pfkZ.js";import{c as Te}from"./index-D-xJce4k.js";import{c as Me,P as ae}from"./index-CTvPNZtd.js";import{c as te,R as Fe,T as Oe,b as qe}from"./index-r5P8Ylym.js";import{u as $e}from"./index-COMQfmU0.js";import{C as ze}from"./chevron-down-CqJo4LZW.js";import{D as U,a as G,b as J,c as Y,d as X,e as W,f as Le,g as Ke,X as He}from"./command-DU_R5alo.js";import{I as M}from"./input-CPdmn13N.js";import{L as I}from"./label-BMnosuv_.js";import{T as re}from"./textarea-BwrzEGGd.js";import{H as Qe,S as Ve,T as Be,C as Ue,P as Ge}from"./theme-switch-DorJDsGd.js";import{Q as ie}from"./sign-out-dialog-GBgIxE2Q.js";import{E as Je}from"./empty-state-CU2gGm9v.js";import{F as Ye}from"./floating-action-button-XEFQTGTy.js";import{M as Xe}from"./main-gqigjXqN.js";import{S as We}from"./separator-DA0QZDJm.js";import{S as $}from"./switch-BvTquMZO.js";import{S as Ze}from"./searchable-select-Ba31eDlW.js";import{L as E}from"./loader-circle-kJ1Ef_oQ.js";import{S as Z}from"./save-CRpBw9jE.js";import"./index-BetNNbXV.js";import"./index-BElOJd7n.js";import"./index-L_x52GkC.js";import"./index-taeySYSj.js";import"./index-CzMLjddK.js";import"./check-46FVkbyV.js";import"./index-B6E7gDWi.js";import"./arrow-right-v-fqSTyu.js";import"./popover-NZ-VSmLe.js";import"./chevrons-up-down-q1jah7FN.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],ee=Me("circle-plus",es);var y="Accordion",ss=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[K,ns,as]=Te(y),[O,an]=Re(y,[as,te]),H=te(),oe=j.forwardRef((s,a)=>{const{type:t,...i}=s,l=i,o=i;return e.jsx(K.Provider,{scope:s.__scopeAccordion,children:t==="multiple"?e.jsx(os,{...o,ref:a}):e.jsx(is,{...l,ref:a})})});oe.displayName=y;var[ce,ts]=O(y),[le,rs]=O(y,{collapsible:!1}),is=j.forwardRef((s,a)=>{const{value:t,defaultValue:i,onValueChange:l=()=>{},collapsible:o=!1,...x}=s,[r,d]=ne({prop:t,defaultProp:i??"",onChange:l,caller:y});return e.jsx(ce,{scope:s.__scopeAccordion,value:j.useMemo(()=>r?[r]:[],[r]),onItemOpen:d,onItemClose:j.useCallback(()=>o&&d(""),[o,d]),children:e.jsx(le,{scope:s.__scopeAccordion,collapsible:o,children:e.jsx(de,{...x,ref:a})})})}),os=j.forwardRef((s,a)=>{const{value:t,defaultValue:i,onValueChange:l=()=>{},...o}=s,[x,r]=ne({prop:t,defaultProp:i??[],onChange:l,caller:y}),d=j.useCallback(p=>r((g=[])=>[...g,p]),[r]),m=j.useCallback(p=>r((g=[])=>g.filter(h=>h!==p)),[r]);return e.jsx(ce,{scope:s.__scopeAccordion,value:x,onItemOpen:d,onItemClose:m,children:e.jsx(le,{scope:s.__scopeAccordion,collapsible:!0,children:e.jsx(de,{...o,ref:a})})})}),[cs,q]=O(y),de=j.forwardRef((s,a)=>{const{__scopeAccordion:t,disabled:i,dir:l,orientation:o="vertical",...x}=s,r=j.useRef(null),d=be(r,a),m=ns(t),g=Ce(l)==="ltr",h=Ee(s.onKeyDown,f=>{if(!ss.includes(f.key))return;const v=f.target,c=m().filter(k=>!k.ref.current?.disabled),b=c.findIndex(k=>k.ref.current===v),A=c.length;if(b===-1)return;f.preventDefault();let n=b;const u=0,N=A-1,D=()=>{n=b+1,n>N&&(n=u)},_=()=>{n=b-1,n<u&&(n=N)};switch(f.key){case"Home":n=u;break;case"End":n=N;break;case"ArrowRight":o==="horizontal"&&(g?D():_());break;case"ArrowDown":o==="vertical"&&D();break;case"ArrowLeft":o==="horizontal"&&(g?_():D());break;case"ArrowUp":o==="vertical"&&_();break}const w=n%A;c[w].ref.current?.focus()});return e.jsx(cs,{scope:t,disabled:i,direction:l,orientation:o,children:e.jsx(K.Slot,{scope:t,children:e.jsx(ae.div,{...x,"data-orientation":o,ref:d,onKeyDown:i?void 0:h})})})}),F="AccordionItem",[ls,Q]=O(F),me=j.forwardRef((s,a)=>{const{__scopeAccordion:t,value:i,...l}=s,o=q(F,t),x=ts(F,t),r=H(t),d=$e(),m=i&&x.value.includes(i)||!1,p=o.disabled||s.disabled;return e.jsx(ls,{scope:t,open:m,disabled:p,triggerId:d,children:e.jsx(Fe,{"data-orientation":o.orientation,"data-state":fe(m),...r,...l,ref:a,disabled:p,open:m,onOpenChange:g=>{g?x.onItemOpen(i):x.onItemClose(i)}})})});me.displayName=F;var ue="AccordionHeader",xe=j.forwardRef((s,a)=>{const{__scopeAccordion:t,...i}=s,l=q(y,t),o=Q(ue,t);return e.jsx(ae.h3,{"data-orientation":l.orientation,"data-state":fe(o.open),"data-disabled":o.disabled?"":void 0,...i,ref:a})});xe.displayName=ue;var z="AccordionTrigger",pe=j.forwardRef((s,a)=>{const{__scopeAccordion:t,...i}=s,l=q(y,t),o=Q(z,t),x=rs(z,t),r=H(t);return e.jsx(K.ItemSlot,{scope:t,children:e.jsx(Oe,{"aria-disabled":o.open&&!x.collapsible||void 0,"data-orientation":l.orientation,id:o.triggerId,...r,...i,ref:a})})});pe.displayName=z;var ge="AccordionContent",he=j.forwardRef((s,a)=>{const{__scopeAccordion:t,...i}=s,l=q(y,t),o=Q(ge,t),x=H(t);return e.jsx(qe,{role:"region","aria-labelledby":o.triggerId,"data-orientation":l.orientation,...x,...i,ref:a,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...s.style}})});he.displayName=ge;function fe(s){return s?"open":"closed"}var ds=oe,ms=me,us=xe,xs=pe,ps=he;function gs({...s}){return e.jsx(ds,{"data-slot":"accordion",...s})}function hs({className:s,...a}){return e.jsx(ms,{"data-slot":"accordion-item",className:L("border-b last:border-b-0",s),...a})}function fs({className:s,children:a,...t}){return e.jsx(us,{className:"flex",children:e.jsxs(xs,{"data-slot":"accordion-trigger",className:L("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",s),...t,children:[a,e.jsx(ze,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function vs({className:s,children:a,...t}){return e.jsx(ps,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...t,children:e.jsx("div",{className:L("pt-0 pb-4",s),children:a})})}const js={ok:"text-emerald-700 dark:text-emerald-300 bg-emerald-50 dark:bg-emerald-900/20 border-emerald-300/50",warn:"text-amber-700 dark:text-amber-300 bg-amber-50 dark:bg-amber-900/20 border-amber-300/50",error:"text-rose-700 dark:text-rose-300 bg-rose-50 dark:bg-rose-900/20 border-rose-300/50",unknown:"text-blue-700 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/20 border-blue-300/50",disabled:"text-zinc-600 dark:text-zinc-300 bg-zinc-100 dark:bg-zinc-800 border-zinc-300/50"};function ve({label:s,level:a,title:t,className:i}){return e.jsxs("span",{title:t,className:ye("inline-flex items-center gap-1.5 rounded-full border px-2 py-0.5 text-sm font-semibold",js[a],i),children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-current"}),s]})}function bs({plugin:s,onChange:a,onRemove:t,isRemoving:i}){const l=T(s.enabled,!1),{level:o,label:x}=se(s.status,l);return e.jsxs("div",{className:"rounded-md border p-4",children:[" ",e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"font-mono",children:["Plugin: ",V(s.name)]}),e.jsx(ve,{level:o,label:x,title:s.status})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground text-sm",children:"Enable"}),e.jsx($,{checked:l,onCheckedChange:r=>a({...s,enabled:r})})]}),e.jsx(ie,{title:"Confirm Remove Plugin",description:`Are you sure you want to remove plugin '${s.name}'?`,confirmText:"Confirm Remove",onConfirm:t,trigger:e.jsx(P,{variant:"destructive",size:"icon",disabled:i,children:i?e.jsx(E,{className:"h-4 w-4 animate-spin"}):"🗑️"})})]})]}),!!s.config?.length&&e.jsxs("div",{className:"mt-4 space-y-3",children:[" ",e.jsx("div",{className:"text-sm font-medium",children:"User Configuration"}),s.config.map((r,d)=>{const m=`cfg_${s.plugin_id}_${d}`,p=`${r.name}${r.required?" (Required)":""}`,g=r.description||`Set ${r.name}`,h=r.value??r.default;if(r.type==="integer"){const f=Number.isFinite(Number(h))?Number(h):0;return e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-[240px_1fr]",children:[e.jsx(I,{htmlFor:m,children:p}),e.jsx(M,{id:m,type:"number",value:f,onChange:v=>{const c=structuredClone(s);c.config[d].value=Number(v.target.value),a(c)},placeholder:g})]},m)}return e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-[240px_1fr]",children:[e.jsx(I,{htmlFor:m,children:p}),e.jsx(M,{id:m,type:r.secret?"password":"text",value:V(h),onChange:f=>{const v=structuredClone(s);v.config[d].value=f.target.value,a(v)},placeholder:g})]},m)})]}),!!s.tools?.length&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-medium",children:"Tools"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[" ",s.tools.map((r,d)=>e.jsxs("div",{className:"flex items-center justify-between rounded border p-3",children:[" ",e.jsxs("div",{children:[e.jsx("div",{className:"font-mono",children:r.name}),r.description&&e.jsx("div",{className:"text-muted-foreground text-xs",children:r.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground text-sm",children:"Enable"}),e.jsx($,{checked:T(r.enabled,!1),onCheckedChange:m=>{const p=structuredClone(s);p.tools[d].enabled=m,a(p)}})]})]},d))]})]})]})}function Cs({assistant:s,onChange:a,availablePlugins:t,onAddPlugin:i,isAddingPlugin:l,addingPluginDetails:o,onRemovePlugin:x,isRemovingPlugin:r,removingPluginDetails:d}){const m=T(s.enabled,!1),p=new Set((s.plugins||[]).map(c=>c.plugin_id)),g=S.useMemo(()=>t.filter(c=>!p.has(c.id)).map(c=>({value:c.id,label:c.name})),[t,p]),[h,f]=S.useState(""),v=l&&o?.assistantId===s.id;return e.jsxs("div",{className:"space-y-6",children:[" ",e.jsx("h3",{className:"text-base font-semibold",children:" Basic Settings"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Name"}),e.jsx(M,{value:s.name||"",onChange:c=>a({...s,name:c.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Enable assistant"}),e.jsx("div",{className:"flex h-10 items-center",children:e.jsx($,{checked:m,onCheckedChange:c=>a({...s,enabled:c})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Description"}),e.jsx(re,{value:s.description||"",onChange:c=>a({...s,description:c.target.value})})]}),e.jsx(We,{}),e.jsxs("div",{className:"flex items-center justify-start gap-4",children:[e.jsx("h3",{className:"text-base font-semibold",children:"Plugins"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ze,{options:g,value:h,onChange:f,placeholder:"Select plugin to add",className:"min-w-[160px] sm:min-w-[220px]"}),e.jsxs(P,{disabled:!h||v,onClick:()=>h&&i(h),children:[v&&e.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),v?"Adding...":"Add"]})]})]}),!s.plugins?.length&&e.jsx("div",{className:"text-muted-foreground mt-2 text-sm",children:"No plugins configured."}),e.jsx("div",{className:"space-y-4",children:(s.plugins||[]).map((c,b)=>{const A=r&&d?.assistantId===s.id&&d?.pluginId===c.plugin_id;return e.jsx(bs,{plugin:c,onChange:n=>{const u=structuredClone(s);u.plugins=u.plugins||[],u.plugins[b]=n,a(u)},onRemove:()=>x(c.plugin_id),isRemoving:A},c.plugin_id)})})]})}function ys(){const s=Ae(),a=B({queryKey:["assistants"],queryFn:async()=>await De()??[],staleTime:5e3}),t=B({queryKey:["available-plugins"],queryFn:async()=>await _e()??[],staleTime:3e4}),[i,l]=S.useState([]),[o,x]=S.useState(new Set);S.useEffect(()=>{a.data&&l(JSON.parse(JSON.stringify(a.data)))},[a.data]);const r=R({mutationFn:async n=>we(n.assistantId,n.pluginId),onSuccess:async()=>{C.success("Plugin added"),await s.invalidateQueries({queryKey:["assistants"]})},onError:n=>C.error(n.message||"Add plugin failed")}),d=R({mutationFn:async n=>Se(n.assistantId,n.pluginId),onSuccess:async()=>{C.success("Plugin removed"),await s.invalidateQueries({queryKey:["assistants"]})},onError:n=>C.error(n.message||"Remove plugin failed")}),[m,p]=S.useState(!1),[g,h]=S.useState(!1),[f,v]=S.useState({name:"",description:""}),c=R({mutationFn:async({name:n,description:u})=>Pe(n,u),onSuccess:async()=>{C.success("Assistant added successfully!"),await s.invalidateQueries({queryKey:["assistants"]}),p(!1),v({name:"",description:""})},onError:n=>C.error(n.message||"Add assistant failed")}),b=R({mutationFn:async()=>{const n=i.filter(N=>o.has(N.id));if(n.length===0){C.info("No changes to save.");return}const u=n.map(N=>Ie(N.id,N));await Promise.all(u)},onSuccess:async()=>{C.success("All changes have been saved successfully!"),await s.invalidateQueries({queryKey:["assistants"]}),h(!1)},onError:n=>C.error(n.message||"Failed to save some changes.")}),A=R({mutationFn:async n=>ke(n),onSuccess:async()=>{C.success("Assistant deleted"),await s.invalidateQueries({queryKey:["assistants"]})},onError:n=>C.error(n.message||"Delete assistant failed")});return e.jsxs(e.Fragment,{children:[e.jsxs(Qe,{children:[e.jsx(Ve,{}),e.jsxs("div",{className:"ms-auto flex items-center gap-4",children:[e.jsx(Be,{}),e.jsx(Ue,{}),e.jsx(Ge,{})]})]}),e.jsxs(Ye,{children:[e.jsxs(U,{open:m,onOpenChange:p,children:[e.jsx(G,{asChild:!0,children:e.jsxs(P,{variant:"outline",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Add Assistant"]})}),e.jsxs(J,{children:[e.jsx(Y,{children:e.jsx(X,{children:"Add New Assistant"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"new-name",children:"Name (Required)"}),e.jsx(M,{id:"new-name",value:f.name,onChange:n=>v(u=>({...u,name:n.target.value})),placeholder:"Enter assistant name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"new-desc",children:"Description"}),e.jsx(re,{id:"new-desc",value:f.description,onChange:n=>v(u=>({...u,description:n.target.value})),placeholder:"Enter assistant description"})]})]}),e.jsx(W,{children:e.jsxs(P,{onClick:()=>c.mutate({name:f.name,description:f.description}),disabled:c.isPending,children:[c.isPending?e.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ee,{className:"mr-2 h-4 w-4"}),c.isPending?"Adding...":"Add"]})})]})]}),e.jsxs(U,{open:g,onOpenChange:h,children:[e.jsx(G,{asChild:!0,children:e.jsxs(P,{disabled:o.size===0,children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Save Changes"]})}),e.jsxs(J,{children:[e.jsxs(Y,{children:[e.jsx(X,{children:"Confirm Your Changes"}),e.jsx(Le,{children:"Are you sure you want to save all changes? This will update the configuration for all assistants and reload them."})]}),e.jsxs(W,{className:"gap-2 sm:justify-end",children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(P,{type:"button",variant:"outline",children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),"Cancel"]})}),e.jsxs(P,{type:"button",onClick:()=>b.mutate(),disabled:b.isPending,children:[b.isPending?e.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Z,{className:"mr-2 h-4 w-4"}),b.isPending?"Saving...":"Confirm & Save"]})]})]})]})]}),e.jsxs(Xe,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Assistant Configuration"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage assistants, enable/disable plugins, and edit plugin settings and tools."})]}),e.jsxs("div",{children:[a.isLoading&&e.jsx(Ne,{lines:5}),a.error&&e.jsx("div",{className:"text-red-600",children:"Failed to load assistants."}),!a.isLoading&&!a.error&&i.length===0&&e.jsx(Je,{title:"No assistants",description:"There are currently no assistants to configure."}),e.jsx(gs,{type:"single",collapsible:!0,className:"w-full space-y-4 pt-3",children:i.map((n,u)=>{const N=T(n.enabled,!1),{level:D,label:_}=se(n.status,N);return e.jsxs(hs,{value:n.id||`item-${u}`,className:"rounded-lg border",children:[e.jsx(fs,{className:"px-4 py-3 text-lg font-semibold hover:no-underline",children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4 pr-4",children:[" ",e.jsx("span",{className:"truncate",children:n.name||"Unnamed"}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ve,{level:D,label:_,title:n.status})})]})}),e.jsxs(vs,{className:"p-4 pt-0",children:[e.jsxs("div",{className:"mb-4 flex justify-end",children:[" ",e.jsx(ie,{title:"Confirm Delete Assistant",description:`Are you sure you want to delete assistant '${n.name||"Unnamed"}'?`,confirmText:"Confirm Delete",onConfirm:()=>A.mutate(n.id),trigger:e.jsxs(P,{variant:"destructive",size:"sm",disabled:A.isPending&&A.variables===n.id,children:[A.isPending&&A.variables===n.id&&e.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),"Delete Assistant"]})})]}),e.jsx(Cs,{assistant:n,onChange:w=>{const k=[...i];k[u]=w,l(k),x(je=>new Set(je).add(w.id))},availablePlugins:t.data||[],onAddPlugin:w=>r.mutate({assistantId:n.id,pluginId:w}),isAddingPlugin:r.isPending,addingPluginDetails:r.variables,onRemovePlugin:w=>d.mutate({assistantId:n.id,pluginId:w}),isRemovingPlugin:d.isPending,removingPluginDetails:d.variables||null})]})]},n.id||u)})})]})]})]})}const tn=ys;export{tn as component};
