<html>
<meta charset="utf-8">
<body>
<script src="https://storage.yandexcloud.net/gymboss-test/gantt/gantt/dhtmlxgantt.js?v=7.1.13"></script>
<link rel="stylesheet" href="https://storage.yandexcloud.net/gymboss-test/gantt/gantt/dhtmlxgantt.css?v=7.1.13">
<style>
    html, body {
        padding: 0px;
        margin: 0px;
        height: 100%;
    }

    .gantt_side_content.gantt_link_crossing {
        top:0
    }

    .dhtmlx_bar_0{background:#23964d!important;}

</style>
<div id="gantt_here" style='width:100%; height:100%;'></div>
<script>

    gantt.plugins({
        marker: true,
        grouping: true
    });

    gantt.ext.zoom.init({
        minColumnWidth: 80,
        maxColumnWidth: 150,
        levels: [
            [
                {unit: "year", format: "%Y", step: 1},
                {unit: "month", format: "%M", step: 1},
            ],
            [
                {unit: "month", format: "%M %Y", step: 1},
                {
                    unit: "week", step: 1, format: function (date) {
                        var dateToStr = gantt.date.date_to_str("%d.%m");
                        var endDate = gantt.date.add(date, -6, "day");
                        return dateToStr(endDate) + " - " + dateToStr(date);
                    }
                }
            ],
            [
                {unit: "month", format: "%M %y", step: 1},
                {unit: "day", format: "%d", step: 1}
            ]
        ],
        useKey: "ctrlKey",
        trigger: "wheel",
        element: function () {
            return gantt.$root.querySelector(".gantt_task");
        }
    });

    gantt.ext.zoom.setLevel(2)

    gantt.config.min_column_width = 50;
    gantt.config.auto_types = true;
    gantt.config.readonly = true;
    gantt.config.resource_property = "resource";

    if (false) {
        gantt.addMarker({
            start_date: new Date(),
            css: "today",
        });
    }

    const ganttConfig = {
        columns: [{"name": "id", "tree": false, "width": 50, "resize": true}, {"name": "text", "tree": false, "width": 200, "resize": true}, {"name": "start_date", "tree": false, "width": 100, "resize": true}, {"name": "end_date", "tree": false, "width": 100, "resize": true, "label": "End date"}, {"name": "progress", "tree": false, "width": 100, "resize": true}],
        row_height: 30
    };

    gantt.templates.task_class = function (start, end, task) {
        return task.css_class;
    };

    const resourceConfig = {
		columns: [
			{
				name: "text", label: "Name", tree: false
			}
		]
	};

    gantt.config.resource_store = "resource";
    const resourcesStore = gantt.createDatastore({
		name: gantt.config.resource_store,
		type: "treeDatastore",
		// initItem: function (item) {
		// 	item.parent = item.parent || gantt.config.root_id;
		// 	item['resource'] = item.parent;
		// 	item.open = true;
		// 	return item;
		// }
	});

    gantt.templates.resource_cell_value = function(start_date, end_date, resource, tasks){
        console.log(start_date)
        console.log(end_date)
        console.log(resource)
        console.log(tasks)
		return "<div>" + tasks.length * 8 + "</div>";
	};

    gantt.config.layout = {
		css: "gantt_container",
		rows: [
			{
                config: ganttConfig,
				cols: [
					{view: "grid", group:"grids", scrollY: "scrollVer"},
					{resizer: true, width: 1},
					{view: "timeline", scrollX: "scrollHor", scrollY: "scrollVer"},
					{view: "scrollbar", id: "scrollVer", group:"vertical"}
				],
				gravity:1
			},
			{resizer: true, width: 1},
			{
				config: resourceConfig,
				cols: [
					// {view: "resourceGrid", group:"grids", width: 435, scrollY: "resourceVScroll" },
					// {resizer: true, width: 1},
					{view: "resourceTimeline", scrollX: "scrollHor", scrollY: "resourceVScroll"},
					{view: "scrollbar", id: "resourceVScroll", group:"vertical"}
				],
				gravity:1
			},
			{view: "scrollbar", id: "scrollHor"}
		]
	};

    (function () {
        gantt.config.font_width_ratio = 7;
        gantt.templates.leftside_text = function leftSideTextTemplate(start, end, task) {
            if (getTaskFitValue(task) === "left") {
                return task.text;
            }
            return "";
        };
        gantt.templates.rightside_text = function rightSideTextTemplate(start, end, task) {
            if (getTaskFitValue(task) === "right") {
                return task.text;
            }
            return "";
        };
        gantt.templates.task_text = function taskTextTemplate(start, end, task) {
            if (getTaskFitValue(task) === "center") {
                return task.text;
            }
            return "";
        };

        function getTaskFitValue(task) {
            var taskStartPos = gantt.posFromDate(task.start_date),
                taskEndPos = gantt.posFromDate(task.end_date);

            var width = taskEndPos - taskStartPos;
            var textWidth = (task.text || "").length * gantt.config.font_width_ratio;

            if (width < textWidth) {
                var ganttLastDate = gantt.getState().max_date;
                var ganttEndPos = gantt.posFromDate(ganttLastDate);
                if (ganttEndPos - taskEndPos < textWidth) {
                    return "left"
                } else {
                    return "right"
                }
            } else {
                return "center";
            }
        }
    })();

    gantt.init("gantt_here");

    resourcesStore.parse([
  {
    "id": "Tester",
    "text": "QA"
  },
  {
    "id": "Dev",
    "text": "Dev"
  }
]);

    gantt.parse({
  "data": [
    {
      "id": 2,
      "text": "Задача 1",
      "type": "task",
      "start_date": "01-05-2023 00:00",
      "end_date": "03-05-2023 12:00",
      "resource": "Tester",
      "open": "true",
      "parent": 0,
      "progress": 0.5,
      "css_class": "dhtmlx_bar_0",
      "name": "Задача 1",
      "start": "2023-05-01 00:00:00",
      "end": "2023-05-03 12:00:00",
      "milestone": "False",
      "gantt_bar_style": "{'background': '#23964d'}"
    },
    {
      "id": 3,
      "text": "Задача 2",
      "type": "task",
      "start_date": "03-05-2023 12:00",
      "end_date": "06-05-2023 00:00",
      "resource": "Tester",
      "open": "true",
      "parent": 0,
      "progress": 0.0,
      "css_class": "dhtmlx_bar_0",
      "name": "Задача 2",
      "start": "2023-05-03 12:00:00",
      "end": "2023-05-06 00:00:00",
      "milestone": "False",
      "gantt_bar_style": "{'background': '#23964d'}"
    },
    {
      "id": 5,
      "text": "Задача 5",
      "type": "task",
      "start_date": "08-05-2023 00:00",
      "end_date": "24-05-2023 12:00",
      "resource": null,
      "open": "true",
      "parent": 4,
      "progress": 0.0,
      "css_class": null,
      "name": "Задача 5",
      "start": "2023-05-08 00:00:00",
      "end": "2023-05-24 12:00:00",
      "milestone": "False"
    },
    {
      "id": 6,
      "text": "Задача 6",
      "type": "task",
      "start_date": "24-05-2023 12:00",
      "end_date": "01-06-2023 18:00",
      "resource": null,
      "open": "true",
      "parent": 4,
      "progress": 0.0,
      "css_class": null,
      "name": "Задача 6",
      "start": "2023-05-24 12:00:00",
      "end": "2023-06-01 18:00:00",
      "milestone": "False"
    },
    {
      "id": 4,
      "text": "Задача 4",
      "type": "task",
      "start_date": "08-05-2023 00:00",
      "end_date": "01-06-2023 18:00",
      "resource": null,
      "open": "true",
      "parent": 0,
      "progress": 0.0,
      "css_class": null,
      "name": "Задача 4",
      "start": "2023-05-08 00:00:00",
      "end": "2023-06-01 18:00:00",
      "milestone": "False"
    },
    {
      "id": 8,
      "text": "Задача 8",
      "type": "task",
      "start_date": "01-06-2023 18:00",
      "end_date": "05-06-2023 18:00",
      "resource": null,
      "open": "true",
      "parent": 7,
      "progress": 0.0,
      "css_class": null,
      "name": "Задача 8",
      "start": "2023-06-01 18:00:00",
      "end": "2023-06-05 18:00:00",
      "milestone": "False"
    },
    {
      "id": 9,
      "text": "Задача 9",
      "type": "task",
      "start_date": "05-06-2023 18:00",
      "end_date": "07-06-2023 18:00",
      "resource": null,
      "open": "true",
      "parent": 7,
      "progress": 0.0,
      "css_class": null,
      "name": "Задача 9",
      "start": "2023-06-05 18:00:00",
      "end": "2023-06-07 18:00:00",
      "milestone": "False"
    },
    {
      "id": 7,
      "text": "Задача 7",
      "type": "task",
      "start_date": "01-06-2023 18:00",
      "end_date": "07-06-2023 18:00",
      "resource": null,
      "open": "true",
      "parent": 0,
      "progress": 0.0,
      "css_class": null,
      "name": "Задача 7",
      "start": "2023-06-01 18:00:00",
      "end": "2023-06-07 18:00:00",
      "milestone": "False"
    }
  ],
  "links": [
    {
      "id": 1,
      "source": 2,
      "target": 3,
      "type": "0"
    },
    {
      "id": 2,
      "source": 3,
      "target": 5,
      "type": "0"
    },
    {
      "id": 3,
      "source": 3,
      "target": 6,
      "type": "0"
    },
    {
      "id": 4,
      "source": 6,
      "target": 8,
      "type": "0"
    },
    {
      "id": 5,
      "source": 6,
      "target": 9,
      "type": "0"
    }
  ]
});



</script>
</body>
</html>
