from collections.abc import Callable
from typing import Annotated

import numpy
from numpy.typing import NDArray

class ClientSendFuture:
    def done(self) -> bool: ...
    def wait(self) -> None: ...
    def exception(self) -> str: ...

class ClientRecvFuture:
    def done(self) -> bool: ...
    def exception(self) -> str: ...
    def info(self) -> tuple[int, int]: ...
    def wait(self) -> None: ...

class Client:
    def __init__(self, addr: str, port: int) -> None: ...
    def send(
        self,
        buffer: Annotated[NDArray[numpy.uint8], dict(shape=(None,), device="cpu")],
        tag: int,
        done_callback: Callable[[ClientSendFuture], None],
        fail_callback: Callable[[ClientSendFuture], None],
    ) -> ClientSendFuture: ...
    def recv(
        self,
        buffer: Annotated[NDArray[numpy.uint8], dict(shape=(None,), device="cpu")],
        tag: int,
        tag_mask: int,
        done_callback: Callable[[ClientRecvFuture], None],
        fail_callback: Callable[[ClientRecvFuture], None],
    ) -> ClientRecvFuture: ...
    def evaluate_perf(self, msg_size: int) -> int: ...

class ServerSendFuture:
    def done(self) -> bool: ...
    def wait(self) -> None: ...
    def exception(self) -> str: ...

class ServerRecvFuture:
    def done(self) -> bool: ...
    def exception(self) -> str: ...
    def info(self) -> tuple[int, int]: ...
    def wait(self) -> None: ...

class Server:
    def __init__(self, addr: str, port: int) -> None: ...
    def recv(
        self,
        buffer: Annotated[NDArray[numpy.uint8], dict(shape=(None,), device="cpu")],
        tag: int,
        tag_mask: int,
        done_callback: Callable[[ServerRecvFuture], None],
        fail_callback: Callable[[ServerRecvFuture], None],
    ) -> ServerRecvFuture: ...
    def list_clients(self) -> list[int]: ...
    def send(
        self,
        client_ep: int,
        buffer: Annotated[NDArray[numpy.uint8], dict(shape=(None,), device="cpu")],
        tag: int,
        done_callback: Callable[[ServerSendFuture], None],
        fail_callback: Callable[[ServerSendFuture], None],
    ) -> ServerSendFuture: ...
    def evaluate_perf(self, client_ep: int, msg_size: int) -> int: ...

def ucp_get_version() -> str: ...
