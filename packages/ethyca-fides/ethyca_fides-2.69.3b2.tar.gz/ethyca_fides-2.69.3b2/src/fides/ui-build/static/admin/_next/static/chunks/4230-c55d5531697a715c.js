"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4230],{58754:function(e,t,a){var i=a(24246),s=a(96306),n=a(70788);t.Z=e=>{let{heading:t,breadcrumbItems:a,isSticky:r=!0,children:l,rightContent:d,style:o,...c}=e;return(0,i.jsxs)("div",{...c,style:r?{position:"sticky",top:"-24px",paddingTop:"24px",paddingBottom:"24px",paddingLeft:"40px",marginLeft:"-40px",paddingRight:"40px",marginRight:"-40px",marginTop:"-24px",left:0,zIndex:20,backgroundColor:"white",...o}:{paddingBottom:"24px",...o},children:[(0,i.jsxs)(s.jqI,{justify:"space-between",children:["string"==typeof t?(0,i.jsx)(s.lQT,{className:a||l?"pb-4":void 0,level:1,"data-testid":"page-heading",children:t}):t,d&&(0,i.jsx)("div",{"data-testid":"page-header-right-content",children:d})]}),!!a&&(0,i.jsx)(n.m,{className:l?"pb-4":void 0,items:a,"data-testid":"page-breadcrumb"}),l]})}},97181:function(e,t,a){a.d(t,{d:function(){return o}});var i=a(24246),s=a(96306),n=a(34090),r=a(27378),l=a(46238),d=a(40324);let o=e=>{let{name:t,label:a,labelProps:o,tooltip:c,isRequired:u,layout:m="inline",helperText:p,...x}=e,[h,y,{setValue:g}]=(0,n.U$)(t),v=!!(y.touched&&y.error),[j,b]=(0,r.useState)("");h.value||"tags"!==x.mode&&"multiple"!==x.mode||(h.value=[]),"tags"===x.mode&&"string"==typeof h.value&&(h.value=[h.value]);let f="tags"===x.mode?(e,t)=>e?e.value!==j||h.value.includes(j)?x.optionRender?x.optionRender(e,t):e.label:'Create "'.concat(j,'"'):void 0:x.optionRender||void 0,_=e=>{b(e),x.onSearch&&x.onSearch(e)},k=(e,t)=>{g(e),x.onChange&&x.onChange(e,t)};return"inline"===m?(0,i.jsx)(s.NIc,{isInvalid:v,isRequired:u,children:(0,i.jsxs)(s.rjZ,{templateColumns:a?"1fr 3fr":"1fr",children:[a?(0,i.jsx)(d.__,{htmlFor:x.id||t,...o,children:a}):null,(0,i.jsxs)(s.jqI,{align:"center",children:[(0,i.jsxs)(s.jqI,{vertical:!0,flex:1,className:"mr-2",children:[(0,i.jsx)(s.WPr,{...h,id:x.id||t,"data-testid":"controlled-select-".concat(h.name),...x,optionRender:f,onSearch:"tags"===x.mode?_:void 0,onChange:k,value:h.value||void 0,status:v?"error":void 0}),p&&(0,i.jsx)(s.Q6r,{children:p}),(0,i.jsx)(d.Bc,{isInvalid:v,message:y.error,fieldName:h.name})]}),(0,i.jsx)(l.b,{label:c,className:v?"mt-2 self-start":void 0})]})]})}):(0,i.jsx)(s.NIc,{isInvalid:v,isRequired:u,children:(0,i.jsxs)(s.gCW,{alignItems:"start",children:[(0,i.jsxs)(s.jqI,{align:"center",children:[a?(0,i.jsx)(d.__,{htmlFor:x.id||t,fontSize:"xs",my:0,mr:1,...o,children:a}):null,(0,i.jsx)(l.b,{label:c})]}),(0,i.jsx)(s.WPr,{...h,id:x.id||t,"data-testid":"controlled-select-".concat(h.name),...x,optionRender:f,onSearch:"tags"===x.mode?_:void 0,onChange:k,value:h.value||void 0,status:v?"error":void 0}),p&&(0,i.jsx)(s.Q6r,{style:{marginTop:0},children:p}),(0,i.jsx)(d.Bc,{isInvalid:v,message:y.error,fieldName:h.name})]})})}},70788:function(e,t,a){a.d(t,{m:function(){return o}});var i=a(24246),s=a(96306),n=a(79894),r=a.n(n),l=a(27378);let{Text:d}=s.AntTypography,o=e=>{let{items:t,...a}=e,n=(0,l.useMemo)(()=>null==t?void 0:t.map((e,a)=>{let n=a===t.length-1,l={...e},o=l.onClick&&!l.href;return("string"==typeof l.title&&(l.title=(0,i.jsx)(d,{style:{color:"inherit",maxWidth:n?void 0:400},ellipsis:!n,id:n?"breadcrumb-current-page":void 0,children:l.title})),o)?l.title=(0,i.jsx)(s.wpx,{type:"text",size:"small",icon:l.icon,onClick:l.onClick,className:"ant-breadcrumb-link -mt-px px-1 text-inherit",children:l.title}):(l.icon&&(l.title=(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"anticon align-text-bottom",children:l.icon}),l.title]})),l.href&&l.title&&(l.title=(0,i.jsx)(r(),{href:l.href,className:"ant-breadcrumb-link",children:l.title}),delete l.href)),l}),[t]);return(0,i.jsx)(s.zrq,{items:n,...a})}},35258:function(e,t,a){a.d(t,{Z:function(){return q}});var i=a(24246),s=a(96306),n=a(27378),r=a(84720),l=a(52368),d=a(812),o=a(46628),c=a(65450),u=a(31883),m=a(34090),p=a(45938),x=a(95346),h=a(55484),y=a(97181),g=a(40324),v=a(21910);let j=h.Ry().shape({data_categories:h.IX(h.Z_()).min(1,"Must assign at least one data category").label("Data categories"),data_use:h.Z_().required().label("Data use"),data_subjects:h.IX(h.Z_()).min(1,"Must assign at least one data subject").label("Data subjects")}),b={data_categories:[],data_subjects:[],data_use:"",dataset_references:[],customFieldValues:{},id:""},f=e=>{var t;let{customFieldValues:a,...i}=e;return{...i,name:null!==(t=e.name)&&void 0!==t?t:""}},_=e=>{let{allDataUses:t,allDataCategories:a,allDataSubjects:n,allDatasets:r,privacyDeclarationId:l,includeCustomFields:d}=e,o=r?r.map(e=>{var t;return{label:null!==(t=e.name)&&void 0!==t?t:e.fides_key,value:e.fides_key}}):[];return(0,i.jsxs)(s.Kqy,{spacing:4,children:[(0,i.jsx)(y.d,{id:"data_use",label:"Data use",name:"data_use",options:t.map(e=>({value:e.fides_key,label:e.fides_key})),tooltip:"What is the system using the data for. For example, is it for third party advertising or perhaps simply providing system operations.",layout:"stacked",disabled:!!l}),(0,i.jsx)(g.j0,{id:"name",label:"Processing Activity",name:"name",variant:"stacked",tooltip:"The personal data processing activity or activities associated with this data use.",disabled:!!l}),(0,i.jsx)(y.d,{name:"data_categories",label:"Data categories",options:a.map(e=>({value:e.fides_key,label:e.fides_key})),tooltip:"What type of data is your system processing? This could be various types of user or system data.",mode:"multiple",layout:"stacked",disabled:!0}),(0,i.jsx)(y.d,{name:"data_subjects",label:"Data subjects",options:n.map(e=>({value:e.fides_key,label:e.fides_key})),tooltip:"Whose data are you processing? This could be customers, employees or any other type of user in your system.",mode:"multiple",layout:"stacked",disabled:!0}),r?(0,i.jsx)(y.d,{name:"dataset_references",label:"Dataset references",options:o,tooltip:"Referenced Dataset fides keys used by the system.",mode:"multiple",layout:"stacked"}):null,d?(0,i.jsx)(x.uc,{resourceType:v.P6.PRIVACY_DECLARATION,resourceFidesKey:l}):null]})},k=(e,t)=>e?{...e,customFieldValues:t||{}}:b,C=e=>{let{onSubmit:t,initialValues:a,allDataUses:r,privacyDeclarationId:l}=e,{customFieldValues:d,upsertCustomFields:o}=(0,x.mZ)({resourceType:v.P6.PRIVACY_DECLARATION,resourceFidesKey:l}),c=(0,n.useMemo)(()=>k(a,d),[a,d]),[u,m]=(0,n.useState)(!1),p=(0,n.useMemo)(()=>{let e=r.filter(e=>e.fides_key===c.data_use)[0];if(e)return c.name?"".concat(e.name," - ").concat(c.name):e.name},[r,c]);return{handleSubmit:async(e,a)=>{let{customFieldValues:i}=e,s=f(e),n=await t(s,a);if(n){let t=n.filter(t=>t.data_use===e.data_use&&(!t.name||t.name===e.name));t.length>0&&await o({customFieldValues:i,fides_key:t[0].id}),a.resetForm({values:e}),m(!0)}},renderHeader:e=>{let{dirty:t,boxProps:a,hideSaved:n}=e;return(0,i.jsxs)(s.xuv,{display:"flex",alignItems:"center",justifyContent:"space-between",...a,children:[p?(0,i.jsx)(s.X6q,{as:"h4",size:"xs",fontWeight:"medium",mr:4,children:p}):null,!n&&u&&!t&&c.data_use?(0,i.jsxs)(s.xvT,{fontSize:"sm","data-testid":"saved-indicator",children:[(0,i.jsx)(s.StI,{})," Saved"]}):null]})},initialValues:c}},w=e=>{let{onSubmit:t,initialValues:a,onDelete:n,...r}=e,{handleSubmit:l,renderHeader:d,initialValues:o}=C({onSubmit:t,initialValues:a,allDataUses:r.allDataUses,privacyDeclarationId:null==a?void 0:a.id});return(0,i.jsx)(m.J9,{enableReinitialize:!0,initialValues:o,onSubmit:l,validationSchema:j,children:e=>{let{dirty:t}=e;return(0,i.jsxs)(m.l0,{children:[(0,i.jsx)(p.Gt,{id:"PrivacyDeclaration",name:"New Privacy Declaration"}),(0,i.jsxs)(s.Kqy,{spacing:4,children:[(0,i.jsx)(s.xuv,{"data-testid":"header",children:d({dirty:t})}),(0,i.jsx)(_,{onDelete:n,...r})]})]})}})},S=e=>{let{privacyDeclaration:t,onEdit:a,onDelete:n,includeCustomFields:r,...l}=e,{initialValues:d,renderHeader:o,handleSubmit:c}=C({initialValues:t,onSubmit:e=>a(t,e),privacyDeclarationId:t.id,...l});return(0,i.jsx)(s.Qdk,{children:e=>{let{isExpanded:a}=e;return(0,i.jsx)(m.J9,{enableReinitialize:!0,initialValues:d,onSubmit:c,validationSchema:j,children:e=>{let{dirty:d}=e;return(0,i.jsxs)(m.l0,{"data-testid":"".concat(t.data_use,"-form"),children:[(0,i.jsx)(p.Gt,{id:"".concat(t.id,"-form"),name:t.id}),(0,i.jsxs)(s.KFZ,{py:4,borderBottomWidth:a?"0px":"1px",backgroundColor:a?"gray.50":void 0,"data-testid":"accordion-header-".concat(t.data_use),children:[o({dirty:d,boxProps:{flex:"1",textAlign:"left"},hideSaved:!a}),(0,i.jsx)(s.XEm,{})]}),(0,i.jsx)(s.Hk3,{backgroundColor:"gray.50",pt:0,children:(0,i.jsx)(s.Kqy,{spacing:4,children:(0,i.jsx)(_,{privacyDeclarationId:t.id,onDelete:n,includeCustomFields:r,...l})})})]})}})}})};var D=e=>{let{privacyDeclarations:t,...a}=e;return(0,i.jsx)(s.UQy,{allowToggle:!0,border:"transparent","data-testid":"privacy-declaration-accordion",children:t.map(e=>(0,i.jsx)(S,{privacyDeclaration:e,...a},e.id))})},I=e=>{let{system:t,includeCustomFields:a,onSave:r,...l}=e,m=(0,s.pmc)(),[p]=(0,c.qQ)(),[x,h]=(0,n.useState)(!1),[y,g]=(0,n.useState)(void 0),v=(0,n.useMemo)(()=>y?t.privacy_declarations.filter(e=>e.id!==y.id):t.privacy_declarations,[y,t]),j=e=>v.filter(t=>t.data_use===e.data_use&&t.name===e.name).length>0&&(m((0,o.Vo)("A declaration already exists with that data use in this system. Please supply a different data use.")),!0),b=async(e,a)=>{let i=e.map(e=>{var t;return{...e,name:null!==(t=e.name)&&void 0!==t?t:""}}),s={...t,privacy_declarations:i};return(e=>{if((0,u.D4)(e)){let t=(0,d.e$)(e.error,"An unexpected error occurred while updating the system. Please try again.");m((0,o.Vo)(t));return}return m.closeAll(),m((0,o.t5)(a?"Data use deleted":"Data use saved")),r&&r(e.data),e.data.privacy_declarations})(await p(s))},f=async(e,a)=>{if(!(a.id!==e.id&&j(a)))return b(t.privacy_declarations.map(t=>t.id===e.id?a:t))},_=async e=>{if(j(e))return;m.closeAll();let t=[...v,e],a=await b(t);return a&&g(a.filter(t=>(!t.name||t.name===e.name)&&t.data_use===e.data_use)[0]),a},k=async e=>b(t.privacy_declarations.filter(t=>t.id!==e.id),!0),C=async e=>{let t=await k(e);return t&&(h(!1),g(void 0)),t};return(0,n.useEffect)(()=>{h(!1)},[t.fides_key]),(0,i.jsxs)(s.Kqy,{spacing:3,children:[(0,i.jsx)(D,{privacyDeclarations:v,onEdit:f,onDelete:k,includeCustomFields:a,...l}),x?(0,i.jsx)(s.xuv,{backgroundColor:"gray.50",p:4,"data-testid":"new-declaration-form",children:(0,i.jsx)(w,{initialValues:y,onSubmit:_,onDelete:C,includeCustomFields:a,...l})}):null,0===t.privacy_declarations.length?(0,i.jsx)(s.xvT,{fontSize:"sm",lineHeight:5,fontWeight:"medium",pl:2,children:"No data uses"}):null]})},T=a(19043);let R=e=>{let[t]=(0,c.dB)(),a=(0,s.pmc)();return{handleUpsertSystem:async(i,s)=>{let n=[{...e,name:i.name,description:i.description}],r=await t(n);(0,T.D4)(r)?a((0,o.Vo)((0,d.e$)(r.error))):(a((0,o.t5)("Successfully saved system info")),s.resetForm({values:i}))},validationSchema:h.Ry().shape({name:h.Z_().required().label("Name"),description:h.Z_().required().label("Description")})}},N={name:"",description:""};var V=e=>{let{system:t}=e,a="/systems/configure/".concat(t.fides_key),{handleUpsertSystem:n,validationSchema:r}=R(t);return(0,i.jsxs)(s.xuv,{children:[(0,i.jsxs)(s.kCb,{alignItems:"center",children:[(0,i.jsx)(s.xvT,{color:"gray.600",size:"md",lineHeight:6,fontWeight:"semibold",marginBottom:2,children:"System details"}),(0,i.jsx)(s.LZC,{}),(0,i.jsxs)(s._pl,{color:"complimentary.500",href:a,children:["View more",(0,i.jsx)(s.h0n,{ml:2})]})]}),(0,i.jsx)(s.xuv,{width:"100%",padding:4,borderTop:"1px solid",borderColor:"gray.200",children:(0,i.jsx)(m.J9,{enableReinitialize:!0,initialValues:null!=t?t:N,validationSchema:r,onSubmit:n,children:()=>(0,i.jsxs)(m.l0,{children:[(0,i.jsx)(p.Gt,{id:"SystemInfoDrawer",name:"System Info"}),(0,i.jsx)(s.xuv,{marginTop:3,children:(0,i.jsx)(g.j0,{label:"System name",name:"name",variant:"stacked",disabled:!0})}),(0,i.jsx)(s.xuv,{marginTop:3,children:(0,i.jsx)(g.Ks,{label:"System description",name:"description",variant:"stacked",disabled:!0})})]})})})]})},q=e=>{var t;let{selectedSystemId:a,resetSelectedSystemId:d}=e,o=(0,n.useMemo)(()=>!!a,[a]),{isLoading:u,...m}=(0,l.f)({includeDatasets:!1,includeDisabled:!1}),{data:p}=(0,c.rn)(a,{skip:!a});return(0,i.jsx)(s.xuv,{position:"absolute",pointerEvents:"none",top:0,left:0,right:0,bottom:0,overflow:"hidden",children:(0,i.jsx)(s.Mi4,{transition:{enter:{ease:"easeInOut",duration:.5},exit:{ease:"easeInOut",duration:.5}},direction:"right",in:o,unmountOnExit:!0,style:{zIndex:21,pointerEvents:"none",position:"absolute"},children:(0,i.jsxs)(s.xuv,{position:"absolute",right:"0px",height:"100%",width:"100%",maxWidth:"480px",pointerEvents:"auto",borderWidth:0,boxShadow:"0px 20px 25px -5px rgba(0, 0, 0, 0.1), 0px 10px 10px -5px rgba(0, 0, 0, 0.04)",display:a?"unset":"none",backgroundColor:"white","data-testid":"datamap-drawer",children:[(0,i.jsx)(s.xuv,{id:"drawer-header",borderBottomWidth:1,paddingX:6,paddingY:3,children:(0,i.jsxs)(s.kCb,{children:[(0,i.jsx)(s.kCb,{justifyContent:"space-between",alignItems:"center",height:"40px",children:(0,i.jsx)(s.xvT,{fontWeight:"semibold",fontSize:"lg",lineHeight:"7",color:"gray.900",children:null!==(t=null==p?void 0:p.name)&&void 0!==t?t:"System Information"})}),(0,i.jsx)(s.LZC,{}),(0,i.jsx)(s.kCb,{alignItems:"center",children:(0,i.jsx)(s.wpx,{icon:(0,i.jsx)(s.Two,{}),"aria-label":"Close error message",type:"text",onClick:d,"data-testid":"datamap-drawer-close"})})]})}),(0,i.jsx)(s.xuv,{id:"drawer-body",height:"calc(100% - 46px)",overflowY:"auto",padding:6,style:{scrollbarGutter:"stable"},children:p?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(V,{system:p}),(0,i.jsx)(s.xvT,{size:"md",color:"gray.600",lineHeight:6,fontWeight:"semibold",mt:"10px",mb:2,children:"Data uses"}),(0,i.jsx)(s.xuv,{borderTop:"1px solid",borderColor:"gray.200",children:(0,i.jsx)(s.xuv,{pb:3,children:(0,i.jsx)(I,{system:p,...m})})}),(0,i.jsx)(s.xvT,{size:"md",color:"gray.600",lineHeight:6,fontWeight:"semibold",mt:"10px",mb:2,paddingBottom:2,children:"Data flow"}),(0,i.jsx)(r.q,{system:p})]}):null})]})})})}}}]);