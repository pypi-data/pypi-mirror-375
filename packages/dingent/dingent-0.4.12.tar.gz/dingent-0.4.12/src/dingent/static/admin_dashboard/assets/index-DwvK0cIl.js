import{l as N,r as g,o as f,t as j,j as e,B as u,s as i,C as o}from"./index-BRZ4tpHq.js";import{u as k,a as D,C as _}from"./zod-B9Y-vu3J.js";import{u as L}from"./useQuery-wclctLx1.js";import{u as A,L as P}from"./loading-skeleton-9fdPr0DJ.js";import{q as F,t as I}from"./api-BDZ8mgcX.js";import{I as c}from"./input-CPdmn13N.js";import{L as M}from"./label-BMnosuv_.js";import{H as T,S as q,T as B,C as E,P as O}from"./theme-switch-DorJDsGd.js";import{F as Q}from"./floating-action-button-XEFQTGTy.js";import{M as H}from"./main-gqigjXqN.js";import{S as K}from"./searchable-select-Ba31eDlW.js";import{D as R,a as U,b as V,c as G,d as W,f as X,e as Y,g as z,X as J}from"./command-DU_R5alo.js";import{S as v}from"./save-CRpBw9jE.js";import{L as Z}from"./loader-circle-kJ1Ef_oQ.js";import"./index-CTvPNZtd.js";import"./index-L_x52GkC.js";import"./index-Dcf_pfkZ.js";import"./index-taeySYSj.js";import"./index-D-xJce4k.js";import"./index-COMQfmU0.js";import"./index-CzMLjddK.js";import"./index-BetNNbXV.js";import"./sign-out-dialog-GBgIxE2Q.js";import"./index-B6E7gDWi.js";import"./arrow-right-v-fqSTyu.js";import"./index-BElOJd7n.js";import"./separator-DA0QZDJm.js";import"./check-46FVkbyV.js";import"./popover-NZ-VSmLe.js";import"./chevrons-up-down-q1jah7FN.js";const $=f({llm:f({model:i().min(1,"Model is required").optional().or(o("")),base_url:i().url("Invalid URL").optional().or(o("")),provider:i().optional().or(o("")),api_key:i().optional().or(o(""))}),current_workflow:i().optional().or(o(""))});function ee(){const p=N(),s=L({queryKey:["app-settings"],queryFn:async()=>await I()??{llm:{},default_assistant:""},staleTime:5e3}),[m,t]=g.useState(!1),w=s.data?.workflows||[],{register:d,handleSubmit:S,setValue:r,control:b,formState:{errors:h,isSubmitting:y,isDirty:C}}=k({resolver:D($),defaultValues:{llm:{},current_workflow:""}});g.useEffect(()=>{s.data&&(r("llm.model",s.data.llm?.model||""),r("llm.base_url",s.data.llm?.base_url||""),r("llm.provider",s.data.llm?.provider||""),r("llm.api_key",s.data.llm?.api_key||""),r("current_workflow",s.data.current_workflow||""))},[s.data,r]);const l=A({mutationFn:async a=>F(a),onSuccess:async()=>{j.success("Settings saved"),await p.invalidateQueries({queryKey:["app-settings"]}),t(!1)},onError:a=>j.error(a.message||"Save failed")});return s.isLoading?e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Agent Settings"}),e.jsx(P,{lines:6})]}):s.error?e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Agent Settings"}),e.jsx("p",{className:"text-muted-foreground",children:"Failed to load settings"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(T,{children:[e.jsx(q,{}),e.jsxs("div",{className:"ms-auto flex items-center gap-4",children:[e.jsx(B,{}),e.jsx(E,{}),e.jsx(O,{})]})]}),e.jsx(Q,{children:e.jsxs(R,{open:m,onOpenChange:t,children:[e.jsx(U,{asChild:!0,children:e.jsxs(u,{disabled:y||l.isPending||!C,children:[e.jsx(v,{className:"mr-2 h-4 w-4"}),"Save Changes"]})}),e.jsxs(V,{children:[e.jsxs(G,{children:[e.jsx(W,{children:"Confirm Your Changes"}),e.jsx(X,{children:"Are you sure you want to save all changes? This will update the configuration for all assistants and reload them."})]}),e.jsxs(Y,{className:"gap-2 sm:justify-end",children:[e.jsx(z,{asChild:!0,children:e.jsxs(u,{type:"button",variant:"outline",children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Cancel"]})}),e.jsxs(u,{type:"button",onClick:S(a=>l.mutate(a)),disabled:l.isPending,children:[l.isPending?e.jsx(Z,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(v,{className:"mr-2 h-4 w-4"}),l.isPending?"Saving...":"Confirm & Save"]})]})]})]})}),e.jsxs(H,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Agent Settings"}),e.jsx("p",{className:"text-muted-foreground",children:"Configure LLM provider and general defaults."})]}),e.jsxs("form",{className:"space-y-4 pt-3",onSubmit:a=>{a.preventDefault(),t(!0)},children:[e.jsxs("div",{className:"space-y-3 rounded-lg border p-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"LLM Provider Settings"}),e.jsx(n,{label:"Model Name",error:h.llm?.model?.message,children:e.jsx(c,{...d("llm.model")})}),e.jsx(n,{label:"API Base URL",error:h.llm?.base_url?.message,children:e.jsx(c,{...d("llm.base_url"),placeholder:"https://api.example.com/v1"})}),e.jsx(n,{label:"Provider",hint:"For example: 'openai', 'anthropic', etc.",children:e.jsx(c,{...d("llm.provider")})}),e.jsx(n,{label:"API Key",hint:"If using providers like OpenAI, enter the API key here.",children:e.jsx(c,{type:"password",...d("llm.api_key")})})]}),e.jsxs("div",{className:"space-y-3 rounded-lg border p-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"General Settings"}),e.jsx(n,{label:"Current Workflow",hint:"The assistant name used by default when the user does not specify one.",children:e.jsx(_,{name:"current_workflow",control:b,render:({field:a})=>e.jsx(K,{options:w.map(x=>({label:x.name,value:x.id})),value:a.value,onChange:a.onChange,placeholder:"Select a workflow",className:"min-w-[160px] sm:min-w-[220px]"})})})]})]})]})]})}function n({label:p,hint:s,error:m,children:t}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx(M,{children:p}),t,s&&e.jsx("div",{className:"text-muted-foreground text-xs",children:s}),m&&e.jsx("div",{className:"text-xs text-red-600",children:m})]})}const Pe=ee;export{Pe as component};
