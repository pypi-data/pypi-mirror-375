"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[7954],{34847:(e,t,a)=>{var o=a(29079),i=a(14867),n=a.n(i),r=a(24372);const c=o.default.bind(null,{endpoint:"rb.check_room_available",rules:[{args:["room_id"],converters:{room_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"rooms",isDynamic:!1},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"rooms",isDynamic:!1},{data:"/",isDynamic:!1},{data:"room_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"availability",isDynamic:!1},{data:"/",isDynamic:!1},{data:"simple",isDynamic:!1}]}]},"/"),s=o.default.bind(null,{endpoint:"rb.roombooking",rules:[{args:["path"],converters:{path:"PathConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"rooms",isDynamic:!1},{data:"/",isDynamic:!1},{data:"path",isDynamic:!0}]},{args:[],converters:{},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"rooms",isDynamic:!1},{data:"/",isDynamic:!1}]}]},"/");window.setupEventCreationDialog=function(e){e=$.extend({categoryField:null,listingValue:null,protectionModeFields:null,initialCategory:null,checkAvailability:!1,rbExcludedCategories:null,serverDefaultTimezone:null},e);const t=$($.parseHTML($("#event-creation-protection-messages").html())),a=$("<div>",{class:"form-group",css:{marginTop:"5px"}}),o=$($.parseHTML($("#event-listing-message").html())),i=$($.parseHTML($("#event-creation-message").html())),l=e.categoryField.closest("form"),d=l.find('input[type="submit"]').first(),g=$("#event-creation-create_booking"),v=$("#room-available"),m=$("#room-available-prebook"),p=$("#room-conflict-booking"),u=$("#room-conflict-prebooking"),f=$("#room-conflict-prebooking-prebook"),h=$("#room-user-booking"),y=$("#room-user-prebooking"),b=$("#room-unbookable"),k=$("#room-cannot-book"),_=$("#create-booking"),D=$("#create-prebooking"),M=$("#create-booking-over-prebooking"),T=$("#create-prebooking-over-prebooking"),C=$("#event-creation-listing-checkbox");let S,F,O,x,A,E,J,L=null,N=!1;function w(){return e.canCreateEvents||!L||L?.id!==e.initialCategory?.id}function Y(){const e=$.param(l.serializeArray(),!0)===l.data("initialData")||!w();d.prop("disabled",e)}function H(){if(!L)return void a.html("");let o=e.protectionModeFields.filter(":checked").val();"inheriting"===o&&(o=L.is_protected?"inheriting-protected":"inheriting-public");const i=t.filter(`.${o}-protection-message`);i.find(".js-category-title").text(L&&L.title),a.html(i)}function z(e){O=n()(`${e.date} ${e.time}`,"YYYY-MM-DD HH:mm"),x=n()(O).add(e.duration,"minutes")}function j(e){const t={path:"calendar",date:O.format("YYYY-MM-DD"),text:E.room_name},a=s(t);e.find("a").prop("href",a)}function B(t=!1){if(function(e){F&&(e&&($("#availability-messages").find("input[id^='create']").prop("checked",!1),g.val("false")),F.hide())}(t),!("room_id"in E)||!O.isValid()||!x.isValid()||O.isSameOrAfter(x)||(a=A.id,e.rbExcludedCategories.some((e=>parseInt(e.id,10)===a)))||J!==e.serverDefaultTimezone||N)return void g.val("false");var a;const o={room_id:E.room_id,start_dt:O.format(n().HTML5_FMT.DATETIME_LOCAL),end_dt:x.format(n().HTML5_FMT.DATETIME_LOCAL)};$.ajax({url:c(o),method:"GET",dataType:"json",contentType:"application/json",error:handleAjaxError,success(e){(e=(0,r.camelizeKeys)(e)).userBooking?(g.val("false"),F=h,j(F)):e.userPrebooking?(g.val("false"),F=y,j(F)):e.conflictBooking?(g.val("false"),F=p,j(F)):e.unbookable?(g.val("false"),F=b,j(F)):e.conflictPrebooking?e.canBook?(g.val(String(M[0].checked)),F=u,j(F)):e.canPrebook?(g.val(String(T[0].checked)),F=f,j(F)):(g.val("false"),F=k):e.canBook?(g.val(String(_[0].checked)),F=v):e.canPrebook?(g.val(String(D[0].checked)),F=m):(g.val("false"),F=k),F.show()}})}a.appendTo(e.protectionModeFields.closest(".form-field")),i.insertAfter($("#category-warning-event-creation-category")),o.appendTo(C.closest(".form-field")),d.prop("disabled",!0),l.on("change input",Y),e.categoryField.on("indico:categorySelected",((t,a)=>{L||e.protectionModeFields.filter("[value=inheriting]").prop("checked",!0),a?e.protectionModeFields.prop("disabled",!1):(e.protectionModeFields.prop("disabled",!0),e.protectionModeFields.filter("[value=inheriting]").prop("checked",!0)),L=a,H(),i.toggleClass("hidden",w()),Y()})),C.on("change",(t=>{JSON.parse(t.target.value)?($("#form-group-event-creation-category").show(),$("#form-group-event-creation-protection_mode").show(),e.categoryField.val(JSON.stringify(e.initialCategory)),e.categoryField.trigger("indico:categorySelected",[e.initialCategory]),$("#category-title-event-creation-category").text(e.initialCategory?e.initialCategory.title:"")):($("#form-group-event-creation-category").hide(),$("#form-group-event-creation-protection_mode").hide(),e.categoryField.trigger("indico:categorySelected",[])),o.toggleClass("hidden",JSON.parse(C.val()))})),e.protectionModeFields.on("change",(()=>{H()})),e.initialCategory?e.categoryField.trigger("indico:categorySelected",[e.initialCategory]):e.protectionModeFields.prop("disabled",!0),e.checkAvailability&&(function(){const e=$("#event-creation-start_dt-datestorage").val(),t=$("#event-creation-start_dt-timestorage").val(),a=$("#event-creation-end_dt-datestorage").val(),o=$("#event-creation-end_dt-timestorage").val(),i=$("#event-creation-occurrences").val(),r=i?JSON.parse(i):null;E=JSON.parse($("#event-creation-location_data").val()),J=$("#event-creation-timezone").val(),A=JSON.parse($("#event-creation-category").val()),r&&1===r.length?z(r[0]):(O=n()(`${e} ${t}`),x=n()(`${a} ${o}`))}(),$("#event-creation-location_data").on("change",(function(){E=JSON.parse($(this).val()),S!==E.room_id&&(S=E.room_id,B(!0))})),$("#event-creation-start_dt-datestorage").on("change",(function(){const e=$(this).val(),t=$("#event-creation-start_dt-timestorage").val(),a=$("#event-creation-end_dt-datestorage").val(),o=$("#event-creation-end_dt-timestorage").val();O=n()(`${e} ${t}`),x=n()(`${a} ${o}`),x.isBefore(O)&&(x=n()(`${e} ${o}`)),B()})),$("#event-creation-start_dt-timestorage").on("change",(()=>{const e=$("#event-creation-start_dt-datestorage").val(),t=$("#event-creation-start_dt-timestorage").val();O=n()(`${e} ${t}`),B()})),$("#event-creation-end_dt-datestorage").on("change",(function(){const e=$(this).val(),t=$("#event-creation-end_dt-timestorage").val();x=n()(`${e} ${t}`),B()})),$("#event-creation-end_dt-timestorage").on("change",(function(){const e=$("#event-creation-end_dt-datestorage").val(),t=$(this).val();x=n()(`${e} ${t}`),B()})),$("#event-creation-occurrences").on("change",(function(){const e=JSON.parse($(this).val());1===e.length?(z(e[0]),N=!1):N=!0,B()})),$("#event-creation-timezone").on("change",(function(){J=$(this).val(),B()})),$("#event-creation-category").on("change",(function(){A=JSON.parse($(this).val()),B()})),_.add(D).add(M).add(T).on("change",(function(){g.val(String(this.checked))})))}}},e=>{e.O(0,[2076],(()=>{return t=34847,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_events.creation.71413887.bundle.js.map