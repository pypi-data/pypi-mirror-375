---
source: crates/cribo/tests/test_bundling_snapshots.rs
input_file: crates/cribo/tests/fixtures/builtin_types/main.py
---
#!/usr/bin/env python3
# Generated by Cribo - Python Source Bundler
# https://github.com/ophidiarium/cribo

import sys as _sys
import importlib as _importlib
class _CriboModule():

    def __init__(self, m, p):
        self._m, self._p = m, p

    def __getattr__(self, n):
        f = self._p + '.' + n
        try:
            return _CriboModule(_importlib.import_module(f), f)
        except ImportError:
            return getattr(self._m, n)

    def __getattribute__(self, n):
        return object.__getattribute__(self, n) if n in ('_m', '_p', '__getattr__', '__class__', '__dict__', '__dir__', '__module__', '__qualname__') else getattr(object.__getattribute__(self, '_m'), n)
class _Cribo():

    def __getattr__(self, n):
        m = _sys.modules.get(n) or _importlib.import_module(n)
        return _CriboModule(m, n)
_cribo = _Cribo()
compat_module = _cribo.types.SimpleNamespace(__name__='compat_module', __initializing__=False, __initialized__=False)
def _cribo_init___cribo_97f65c_compat_module(self):
    if getattr(self, '__initialized__', False):
        return self
    if getattr(self, '__initializing__', False):
        return self
    self.__initializing__ = True
    """Module with side effects that assigns builtin types to variables.\n\nThis minimal test case reproduces the bug where builtin types are incorrectly\ntransformed to module.str, module.int, etc. when the bundler wraps modules\nwith side effects in init functions.\n"""
    print("Loading compat module...")
    str = __import__('builtins').str
    self.str = str
    int = __import__('builtins').int
    self.int = int
    bytes = __import__('builtins').bytes
    self.bytes = bytes
    builtin_str = __import__('builtins').str
    self.builtin_str = builtin_str
    builtin_int = __import__('builtins').int
    self.builtin_int = builtin_int
    builtin_bytes = __import__('builtins').bytes
    self.builtin_bytes = builtin_bytes
    basestring = __import__('builtins').str, __import__('builtins').bytes
    self.basestring = basestring
    numeric_types = __import__('builtins').int, float
    self.numeric_types = numeric_types
    self.__initialized__ = True
    self.__initializing__ = False
    return self
compat_module.__init__ = _cribo_init___cribo_97f65c_compat_module
"""Test that builtin type assignments work in modules with side effects."""
compat_module = _cribo_init___cribo_97f65c_compat_module(compat_module)
builtin_str = compat_module.builtin_str
builtin_int = compat_module.builtin_int
basestring = compat_module.basestring
numeric_types = compat_module.numeric_types
assert builtin_str is str
assert builtin_int is int
assert builtin_str("test") == "test"
assert builtin_int("42") == 42
assert basestring == (str, bytes)
assert numeric_types == (int, float)
print("All tests passed!")
