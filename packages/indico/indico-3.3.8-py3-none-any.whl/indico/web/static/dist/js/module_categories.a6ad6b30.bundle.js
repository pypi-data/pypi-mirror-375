"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[6002],{89553:(e,t,a)=>{var n,r=a(29079),l=a(86326),o=a(35623),s=a(25584);(n=window).setupCategoryDisplaySubcatList=function(){const e=$(".category-list").data("subcat-info-url");void 0!==e&&$.ajax({url:e,dataType:"json",success(e){Object.entries(e.event_counts).forEach((([e,t])=>{const a=t.value?s.$T.ngettext("{0} event","{0} events",t.value).format(t.pretty):s.$T.gettext("empty");$(`#category-event-count-${e}`).text(a)}))}})},n.setupCategoryDisplayEventList=function(e,t,a,n){const r=$(".event-list"),l=r.find(".future-events"),o=r.find(".past-events");function s(e,t){const a=$(e),r=a.find(".events");function l(e){a.find(".js-hide-message").toggle(e),a.find(".js-show-message").toggle(!e)}function o(e){a.find(".js-toggle-list").toggle(!e),a.find(".js-spinner").toggle(e)}l(!r.is(":empty")),o(!1),a.find(".js-toggle-list").on("click",((e,a)=>{let s;e.preventDefault(),r.is(":empty")?(s=!0,o(!0),$.ajax({url:r.data("event-list-url"),data:{before:r.data("event-list-before"),after:r.data("event-list-after"),...n},error:handleAjaxError,success(e){r.html(e.html),r.show(),l(!0),o(!1)}})):r.is(":visible")?(s=!1,r.hide(),l(!1)):(s=!0,r.show(),l(!0)),!a&&t&&t(s)}))}a&&(n.flat=1),s(l,(function(e){a||$.ajax({url:r.data("show-future-events-url"),method:e?"PUT":"DELETE",error:handleAjaxError})})),s(o,(function(e){a||$.ajax({url:r.data("show-past-events-url"),method:e?"PUT":"DELETE",error:handleAjaxError})})),e&&!a&&l.find(".js-toggle-list").first().trigger("click",!0),t&&!a&&o.find(".js-toggle-list").first().trigger("click",!0)};var i=a(85218),c=a(96478);document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#category-calendar-link");if(!e)return;const t=e.dataset.categoryId;o.render(l.createElement(i.ICSCalendarLink,{endpoint:"categories.export_ical",params:{category_id:t},renderButton:e=>l.createElement(i.IButton,{icon:"calendar",title:c.Translate.string("Export"),classes:e}),options:[{key:"category",text:c.Translate.string("Category"),extraParams:{}}]}),e)})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#fav-button");if(!e)return;const t=e.dataset.categoryId,a=void 0!==e.dataset.favorited;o.render(l.createElement(i.Favorite,{type:"category",id:t,favorited:a,setFavText:c.Translate.string("Add category to favorites (This will make events in this category visible on your Dashboard.)"),deleteFavText:c.Translate.string("Delete category from favorites.")}),e)}));var d=a(75857),u=a(64771),m=a(14867),g=a.n(m),_=a(97598),y=a.n(_),E=a(6841),p=a(91185),f=a(33971),v=a(68803),b=a(56237),A=a(51479),h=a(46145),C=a(29481),D=a(49528);const T={"./CategoryModeration.module.scss":{table:"categories-client-js-components-___CategoryModeration-module__table___Muk5s","no-border":"categories-client-js-components-___CategoryModeration-module__no-border___3wNOu",user:"categories-client-js-components-___CategoryModeration-module__user___D7Q+H",avatar:"categories-client-js-components-___CategoryModeration-module__avatar___gg2Un","table-footer":"categories-client-js-components-___CategoryModeration-module__table-footer___LCAAT",disabled:"categories-client-js-components-___CategoryModeration-module__disabled___kBJ15","text-separator":"categories-client-js-components-___CategoryModeration-module__text-separator___n+kI6"}},q=r.default.bind(null,{endpoint:"categories.api_event_move_requests",rules:[{args:["category_id"],converters:{category_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event-move-requests",isDynamic:!1}]}]},"/"),j=r.default.bind(null,{endpoint:"events.display",rules:[{args:["event_id"],converters:{},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1}]}]},"/");function L(){return l.createElement(E.A.Row,null,l.createElement(E.A.Cell,{collapsing:!0},l.createElement(p.A,null)),l.createElement(E.A.Cell,{colSpan:"5"},l.createElement(f.A,{fluid:!0},l.createElement(f.A.Header,{image:!0},l.createElement(f.A.Line,null),l.createElement(f.A.Line,null)))))}function S({requestor:e,event:t,category:a,requestorComment:n,requestedDt:r,selected:o,onSelect:s}){const{fullName:i,avatarURL:d,affiliation:u}=e;return l.createElement(l.Fragment,null,l.createElement(E.A.Row,null,l.createElement(E.A.Cell,{collapsing:!0},l.createElement(p.A,{checked:o,onChange:s})),l.createElement(E.A.Cell,{className:"categories-client-js-components-___CategoryModeration-module__user___D7Q+H"},l.createElement(v.A,{className:"categories-client-js-components-___CategoryModeration-module__avatar___gg2Un",src:d,size:"mini",avatar:!0}),l.createElement("span",null,i," ",u&&`(${u})`)),l.createElement(E.A.Cell,null,l.createElement("a",{href:j({event_id:t.id})},t.title)),a?l.createElement(E.A.Cell,null,a.chainTitles.join(" » ")):l.createElement(c.Translate,{as:E.A.Cell},"Unlisted event"),l.createElement(E.A.Cell,null,function({startDt:e,endDt:t}){return e=g()(e),t=g()(t),e.isSame(t,"day")?`${e.format("L LT")} → ${t.format("LT")}`:`${e.format("L LT")} → ${t.format("L LT")}`}(t)),l.createElement(E.A.Cell,null,l.createElement("span",{title:g()(r).format("L LT")},g()(r).fromNow()))),n?l.createElement(E.A.Row,null,l.createElement(E.A.Cell,{className:"categories-client-js-components-___CategoryModeration-module__no-border___3wNOu"}),l.createElement(E.A.Cell,{colSpan:"5",className:"categories-client-js-components-___CategoryModeration-module__no-border___3wNOu"},n)):null)}function x({requests:e,onSubmit:t,loading:a}){const[n,r]=(0,l.useState)(new Set),[o,s]=(0,l.useState)(""),i=n.size>0,d=e=>{r(new Set),t(Array.from(n),e,o)};return 0!==e.length||a?l.createElement(E.A,{className:"categories-client-js-components-___CategoryModeration-module__table___Muk5s"},l.createElement(E.A.Header,null,l.createElement(E.A.Row,null,l.createElement(E.A.HeaderCell,null),l.createElement(c.Translate,{as:E.A.HeaderCell},"User"),l.createElement(c.Translate,{as:E.A.HeaderCell},"Event"),l.createElement(c.Translate,{as:E.A.HeaderCell},"Category"),l.createElement(c.Translate,{as:E.A.HeaderCell},"Event Date"),l.createElement(c.Translate,{as:E.A.HeaderCell},"Requested Date"))),l.createElement(E.A.Body,null,a?l.createElement(L,null):e.map((({id:e,requestor:t,requestorComment:a,event:o,category:s,requestedDt:i})=>l.createElement(S,{key:e,id:e,event:o,category:s,requestor:t,requestedDt:i,requestorComment:a,selected:n.has(e),onSelect:()=>(e=>r((t=>{const a=new Set([...t,e]);return t.has(e)&&a.delete(e),a})))(e)})))),l.createElement(E.A.Footer,{fullWidth:!0},l.createElement(E.A.Row,null,l.createElement(E.A.HeaderCell,null),l.createElement(E.A.HeaderCell,{colSpan:"5"},l.createElement("div",{className:(0,u.A)("table-footer "+(i?"":"disabled"),T,{autoResolveMultipleImports:!0,handleMissingStyleName:"throw"})},l.createElement(c.Translate,{as:b.A,onClick:()=>d(!0),color:"teal"},"Approve"),l.createElement(c.Translate,{as:"span",className:"categories-client-js-components-___CategoryModeration-module__text-separator___n+kI6"},"or"),l.createElement(A.A,{size:"small",placeholder:c.Translate.string("Provide the rejection reason"),value:o,onChange:(e,{value:t})=>s(t)}),l.createElement(c.Translate,{as:"span",className:"categories-client-js-components-___CategoryModeration-module__text-separator___n+kI6"},"and"),l.createElement(c.Translate,{as:b.A,onClick:()=>d(!1),color:"red"},"Reject")))))):l.createElement(c.Translate,{as:"p"},"There are no event move requests.")}function R({categoryId:e}){const{data:t,lastData:a,loading:n,reFetch:r}=(0,C.Ku)({url:q({category_id:e})},{camelize:!0}),o=t?.length;return(0,l.useEffect)((()=>{const e=document.querySelector("#side-menu-category-management-sidemenu .item.active .badge");e&&void 0!==o&&(o?e.textContent=o:e.style.display="none")}),[o]),a?l.createElement(x,{requests:t||[],onSubmit:async(t,a,n)=>{const l=q({category_id:e});try{await D.indicoAxios.post(l,{requests:t,accept:a,reason:n}),r()}catch(e){return(0,h.handleSubmitError)(e)}},loading:!t||n}):null}S.propTypes={requestor:y().shape({fullName:y().string,avatarURL:y().string,affiliation:y().string}).isRequired,event:y().shape({id:y().number.isRequired,title:y().string.isRequired,startDt:y().string.isRequired,endDt:y().string.isRequired}).isRequired,category:y().shape({id:y().number.isRequired,chainTitles:y().arrayOf(y().string).isRequired}),requestedDt:y().string.isRequired,requestorComment:y().string.isRequired,selected:y().bool,onSelect:y().func.isRequired},S.defaultProps={selected:!1,category:null},x.propTypes={requests:y().array.isRequired,onSubmit:y().func.isRequired,loading:y().bool},x.defaultProps={loading:!1},R.propTypes={categoryId:y().number.isRequired};var w=a(52376),N=a(23507),I=a(31951),M=a(57427),k=a(45423),Y=a(87597),O=a(10102);const F=l.createContext(null),H=r.default.bind(null,{endpoint:"categories.statistics_json",rules:[{args:["category_id"],converters:{category_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"statistics.json",isDynamic:!1}]}]},"/");function z({categoryId:e}){const{data:t,loading:a}=(0,C.Ku)({url:H({category_id:e})},{camelize:!0});return a?l.createElement(N.A,{size:"massive",active:!0}):t?l.createElement(P,{data:t}):null}function P({data:e}){const t=(0,l.useContext)(F).replace("_","-"),a=g().utc(e.updated).local().format("LLL"),n=new Intl.NumberFormat(t),r=n.format(e.totalEvents),o=n.format(e.totalContributions),s=n.format(e.files),i=n.format(e.users),{eventGraph:d,contributionsGraph:u,series:m,axes:_,tooltip:y}=(0,l.useMemo)((()=>function(e){const t=t=>{const a=parseInt(Object.keys(t).reverse().find((t=>t<=e.maxYear+3)),10);return[[g()(e.minYear-1,"YYYY"),null],...Object.entries(t).filter((([t])=>t<=a&&t>=e.minYear)).map((([e,t])=>[g()(e,"YYYY"),t])),[g()(a+1,"YYYY"),null]]};return{eventGraph:[{label:c.Translate.string("Events"),data:t(e.events)}],contributionsGraph:[{label:c.Translate.string("Contributions"),data:t(e.contributions)}],series:{type:"bar"},axes:[{primary:!0,type:"time",position:"bottom"},{type:"linear",position:"left"}],tooltip:{align:"left",anchor:"left"}}}(e)),[e]);return l.createElement(I.A,null,l.createElement(M.A.Group,{horizontal:!0},l.createElement(M.A,null,l.createElement(k.A,{as:"h2"},l.createElement(k.A.Content,null,l.createElement(c.Translate,null,"Number of events"),l.createElement(k.A.Subheader,null,l.createElement(c.Translate,null,"The year is the one of the start date of the event.")))),l.createElement(M.A,{basic:!0},0===d[0].data.length?l.createElement(Y.A,{info:!0},l.createElement(c.Translate,null,"No data available")):l.createElement("div",{className:"categories-client-js-components-___CategoryStatistics-module__chart-container___FFFfl"},l.createElement(w.Chart,{className:"categories-client-js-components-___CategoryStatistics-module__chart___DIs5S",data:d,series:m,axes:_,tooltip:y})))),l.createElement(M.A,null,l.createElement(k.A,{as:"h2"},l.createElement(k.A.Content,null,l.createElement(c.Translate,null,"Number of contributions"),l.createElement(k.A.Subheader,null,l.createElement(c.Translate,null,"The year is the one of the start date of the contribution.")))),l.createElement(M.A,{basic:!0},0===u[0].data.length?l.createElement(Y.A,{info:!0},l.createElement(c.Translate,null,"No data available")):l.createElement("div",{className:"categories-client-js-components-___CategoryStatistics-module__chart-container___FFFfl"},l.createElement(w.Chart,{className:"categories-client-js-components-___CategoryStatistics-module__chart___DIs5S",data:u,series:m,axes:_,tooltip:y}))))),l.createElement(M.A.Group,{horizontal:!0},l.createElement(M.A,{inverted:!0,color:"blue",textAlign:"center"},l.createElement(O.A,{inverted:!0},l.createElement(O.A.Value,null,r),l.createElement(O.A.Label,null,l.createElement(c.Translate,null,"Total number of events")))),l.createElement(M.A,{inverted:!0,color:"blue",textAlign:"center"},l.createElement(O.A,{inverted:!0},l.createElement(O.A.Value,null,o),l.createElement(O.A.Label,null,l.createElement(c.Translate,null,"Total number of contributions")))),l.createElement(M.A,{inverted:!0,color:"blue",textAlign:"center"},l.createElement(O.A,{inverted:!0},l.createElement(O.A.Value,null,s),l.createElement(O.A.Label,null,l.createElement(c.Translate,null,"Number of attachments")))),void 0!==e.users&&l.createElement(M.A,{inverted:!0,color:"blue",textAlign:"center"},l.createElement(O.A,{inverted:!0},l.createElement(O.A.Value,null,i),l.createElement(O.A.Label,null,l.createElement(c.Translate,null,"Number of users"))))),l.createElement(c.Translate,null,"Last updated on: ",l.createElement(c.Param,{name:"time",value:a})))}z.propTypes={categoryId:y().number.isRequired},P.propTypes={data:y().shape({contributions:y().object.isRequired,events:y().object.isRequired,files:y().number.isRequired,updated:y().string.isRequired,users:y().number,totalEvents:y().number.isRequired,totalContributions:y().number.isRequired,minYear:y().number.isRequired,maxYear:y().number.isRequired}).isRequired};const U=r.default.bind(null,{endpoint:"search.category_search",rules:[{args:["category_id"],converters:{category_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"search",isDynamic:!1}]}]},"/"),G=r.default.bind(null,{endpoint:"search.search",rules:[{args:[],converters:{},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"search",isDynamic:!1},{data:"/",isDynamic:!1}]}]},"/");!function(e){document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#search-box");if(e){const t=JSON.parse(e.dataset.category),a=void 0!==e.dataset.isAdmin;o.render(l.createElement(d.A,{onSearch:(e,n,r)=>{const l={q:e};a&&r&&(l.admin_override_enabled=!0),n?window.location=G(l):(l.category_id=t.id,window.location=U(l))},category:t,isAdmin:a}),e)}})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#category-moderation");if(e){const t=parseInt(e.dataset.categoryId,10);o.render(l.createElement(R,{categoryId:t}),e)}})),e.setupCategoryStats=function(){document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#category-stats-root");if(!e)return;const t=parseInt(e.dataset.categoryId,10),a=e.dataset.lang;o.render(l.createElement(F.Provider,{value:a},l.createElement(z,{categoryId:t})),e)}))}}(window)}},e=>{e.O(0,[4644,4394,2076],(()=>{return t=89553,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_categories.a6ad6b30.bundle.js.map