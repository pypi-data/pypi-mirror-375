"use strict";(self.webpackChunkstreamlit_lightweight_charts_pro=self.webpackChunkstreamlit_lightweight_charts_pro||[]).push([[315],{2250:(e,t,n)=>{n.d(t,{T:()=>i});var r=n(9950),o=n(4414);const i=e=>{let{paneId:t,isCollapsed:n,onClick:i,config:a}=e;const[s,c]=r.useState(!1),l=a.buttonSize||16,d=a.buttonColor||"#787B86",u=a.buttonBackground||"rgba(255, 255, 255, 0.9)",h=a.buttonBorderRadius||3,p=a.buttonHoverColor||"#131722",g=a.buttonHoverBackground||"rgba(255, 255, 255, 1)",f={position:"absolute",width:"".concat(l,"px"),height:"".concat(l,"px"),background:s?g:u,border:"1px solid ".concat(s?p:d),borderRadius:"".concat(h,"px"),cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"bold",color:s?p:d,zIndex:1e3,transition:"all 0.2s ease",userSelect:"none"};return(0,o.jsx)("div",{className:"pane-collapse-button",style:f,onMouseEnter:()=>{c(!0)},onMouseLeave:()=>{c(!1)},onClick:e=>{e.preventDefault(),e.stopPropagation(),i()},children:n?"+":"‚àí"})}},7812:(e,t,n)=>{n.d(t,{f:()=>i});var r=n(9950),o=n(4414);const i=e=>{var t,n;let{legendConfig:i,isPanePrimitive:a=!1}=e;console.log("[LegendComponent] isPanePrimitive: ".concat(a));const[s,c]=(0,r.useState)(null===(t=i.visible)||void 0===t||t),l=(0,r.useRef)(null);if(console.log("üîç [LegendComponent] Rendering:",{visible:i.visible,position:i.position,text:(null===(n=i.text)||void 0===n?void 0:n.substring(0,50))+"..."}),(0,r.useEffect)(()=>{var e;c(null===(e=i.visible)||void 0===e||e)},[i.visible]),!s)return console.log("‚ùå [LegendComponent] Not visible"),null;console.log("‚úÖ [LegendComponent] Rendering legend");const d=i.text?(e=>{try{const t=document.createElement("div");t.innerHTML=e;let n=t.textContent||t.innerText||"";return n.trim()||(n=e.replace(/<[^>]*>/g,"").trim()),n}catch(t){return console.warn("‚ö†Ô∏è Error extracting text from HTML:",t),e.replace(/<[^>]*>/g,"").trim()}})(i.text):"";return(0,o.jsx)("div",{ref:l,className:"pane-legend",style:{position:"absolute",top:0,left:0,zIndex:i.zIndex||1e3,pointerEvents:"none",overflow:"visible"},"data-debug":"legend",children:i.text?(0,o.jsx)("div",{"data-legend-text":!0,dangerouslySetInnerHTML:{__html:i.text},"aria-label":d,style:{display:"block",color:i.textColor}}):(0,o.jsx)("span",{style:{color:"#666",fontStyle:"italic"},children:"No content"})})}},9665:(e,t,n)=>{n.d(t,{BV:()=>s,Mu:()=>a,Qu:()=>c,Yf:()=>o,i4:()=>i,zb:()=>l});const r={legend:{top:20,right:20,bottom:20,left:20},pane:{top:10,right:10,bottom:10,left:10},content:{top:5,right:5,bottom:5,left:5},tooltip:{top:10,right:10,bottom:10,left:10}},o={timeAxis:{defaultHeight:35,minHeight:25,maxHeight:50},priceScale:{defaultWidth:70,minWidth:50,maxWidth:100,rightScaleDefaultWidth:0},legend:{defaultHeight:80,minHeight:60,maxHeight:120,defaultWidth:200,minWidth:150},pane:{defaultHeight:200,minHeight:100,maxHeight:1e3},chart:{defaultWidth:800,defaultHeight:600,minWidth:300,minHeight:200}},i={paneHeight:200,paneWidth:800,chartWidth:800,chartHeight:600,timeScaleHeight:35,priceScaleWidth:70,containerWidth:800,containerHeight:600},a={background:0,chart:1,pane:10,series:20,overlay:30,legend:40,tooltip:50,modal:100},s={cacheExpiration:5e3,debounceDelay:100,throttleDelay:50,animationDuration:200};function c(e){return r[e]||r.content}function l(e){return i[e]||0}},9916:(e,t,n)=>{n.d(t,{A:()=>v});var r=n(2555),o=n(9950),i=n(559),a=n(3254),s=n(2578),c=n(7885),l=n(2587),d=n(1443),u=n(9107),h=(n(7008),n(7866)),p=n(4600),g=n(6403),f=n(4414);class y extends o.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Chart Error Boundary caught an error:",e,t),this.props.onError&&this.props.onError(e,t)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,f.jsxs)("div",{style:{padding:"20px",border:"1px solid #ff6b6b",borderRadius:"8px",backgroundColor:"#fff5f5",color:"#d63031",textAlign:"center",margin:"10px 0"},children:[(0,f.jsx)("h3",{children:"Chart Error"}),(0,f.jsx)("p",{children:"Something went wrong while rendering the chart."}),(0,f.jsx)("button",{onClick:()=>this.setState({hasError:!1,error:void 0}),style:{padding:"8px 16px",backgroundColor:"#ff6b6b",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",marginTop:"10px"},children:"Try Again"})]}):this.props.children}}const m=(e,t)=>{if(!t||0===t.length)return null;let n=null,r=1/0;for(const o of t){if(!o.time)continue;let t=null;if("number"==typeof o.time)t=o.time>1e12?Math.floor(o.time/1e3):o.time;else if("string"==typeof o.time){const e=new Date(o.time).getTime();isNaN(e)||(t=Math.floor(e/1e3))}if(null===t)continue;const i=Math.abs(t-e);r>i&&(r=i,n=t)}return n},w=async(e,t,n,r,o)=>{if(t.legend&&t.legend.visible)try{var i;const o=t.paneId||0,a=(0,u.V)(o,r,n,t.legend);window.legendPrimitives||(window.legendPrimitives={});const s="".concat(n,"-").concat(r);window.legendPrimitives[s]=a,console.log("‚úÖ [Legend] Stored legend primitive:",{key:s,chartId:n,seriesIndex:r,hasText:!!t.legend.text,text:t.legend.text,containsPlaceholder:null===(i=t.legend.text)||void 0===i?void 0:i.includes("$$value$$")});const c=e.panes();o<c.length?(c[o].attachPrimitive(a),console.log("‚úÖ [Legend] Attached legend primitive for series ".concat(r," to pane ").concat(o))):console.warn("[Legend] Pane ".concat(o," not found for series ").concat(r))}catch(a){console.error("‚ùå [Legend] Error creating legend for series ".concat(r,":"),a)}},v=o.memo(e=>{let{config:t,height:u=400,width:v=null,onChartsReady:b}=e;const C=(0,o.useRef)({}),x=(0,o.useRef)({}),P=(0,o.useRef)({}),S=(0,o.useRef)({}),E=(0,o.useRef)(null),T=(0,o.useRef)({}),k=(0,o.useRef)(!1),R=(0,o.useRef)(!1),A=(0,o.useRef)(null),I=(0,o.useRef)(null),M=(0,o.useRef)(null),L=(0,o.useRef)({}),O=(0,o.useRef)({}),z=(0,o.useRef)({addTradeVisualization:null,addAnnotations:null,addModularTooltip:null,addAnnotationLayers:null,addRangeSwitcher:null,addLegend:null,updateLegendPositions:null,setupAutoSizing:null,setupChartSynchronization:null,setupFitContent:null,setupPaneCollapseSupport:null,cleanupCharts:null}),j=(0,o.useCallback)(e=>{const t=e.getBoundingClientRect();return{width:t.width,height:t.height}},[]),H=(0,o.useCallback)((e,t,n,r)=>{O.current[e]&&clearTimeout(O.current[e]),O.current[e]=setTimeout(()=>{try{var e,o;const i=j(n),a=r.autoWidth?i.width:(null===(e=r.chart)||void 0===e?void 0:e.width)||v,s=(null===(o=r.chart)||void 0===o?void 0:o.height)||(r.autoHeight?i.height:u)||i.height;t.resize(a,s)}catch(i){}},100)},[v,u,j]),F=(0,o.useCallback)((e,t,n)=>{if(n.autoSize||n.autoWidth||n.autoHeight){const r=e.chartElement().id||"default",o="undefined"!=typeof ResizeObserver?new ResizeObserver(()=>{H(r,e,t,n)}):null;o&&"function"==typeof o.observe&&o.observe(t),E.current=o}},[H]),D=(0,o.useCallback)(function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;C.current[t]||(C.current[t]=e);const o=(e,t)=>t.time&&t.seriesData.get(e)||null;if(n.crosshair){if(!e._storageListenerAdded){let n=0;const o=50,i=i=>{if("chart_sync_data"===i.key&&i.newValue)try{const s=JSON.parse(i.newValue);if(s.chartId!==t&&s.groupId===r&&"crosshair"===s.type){const r=Date.now();if(o>r-n)return;if(n=r,s.time&&s.value){var a;const n=null===(a=x.current[t])||void 0===a?void 0:a[0];n&&(e._isExternalSync=!0,e.setCrosshairPosition(s.value,s.time,n),setTimeout(()=>{e._isExternalSync=!1},100))}}}catch(i){}};window.addEventListener("storage",i),e._storageListenerAdded=!0}e.subscribeCrosshairMove(n=>{if(e._isExternalSync)return;const i=x.current[t]||[];if(Object.entries(window.chartApiMap||{}).forEach(e=>{let[a,s]=e;if(a!==t&&s)try{var c;if(((null===(c=window.chartGroupMap)||void 0===c?void 0:c[a])||0)===r&&n.time){var l;const e=(null===(l=window.seriesRefsMap)||void 0===l?void 0:l[a])||[];if(i.length>0&&e.length>0){const t=o(i[0],n);((e,t,n)=>{n?e.setCrosshairPosition(n.value,n.time,t):e.clearCrosshairPosition()})(s,e[0],t)}}}catch(d){}}),n.time&&i.length>0){const e=o(i[0],n),s={time:n.time,value:e?e.value:null,chartId:t,groupId:r,timestamp:Date.now(),type:"crosshair"};try{localStorage.setItem("chart_sync_data",JSON.stringify(s))}catch(a){}}})}if(n.timeRange){const n=e.timeScale();if(n){if(!e._timeRangeStorageListenerAdded){let n=0;const o=100,i=i=>{if("chart_time_range_sync"===i.key&&i.newValue)try{const a=JSON.parse(i.newValue);if(a.chartId!==t&&a.groupId===r&&"timeRange"===a.type){const t=Date.now();if(o>t-n)return;if(n=t,a.timeRange){const t=e.timeScale();t&&(e._isExternalTimeRangeSync=!0,t.setVisibleLogicalRange(a.timeRange),setTimeout(()=>{e._isExternalTimeRangeSync=!1},150))}}}catch(i){}};window.addEventListener("storage",i),e._timeRangeStorageListenerAdded=!0}n.subscribeVisibleLogicalRangeChange(n=>{if(!e._isExternalTimeRangeSync&&(Object.entries(window.chartApiMap||{}).forEach(e=>{let[o,i]=e;if(o!==t&&i)try{var a;if(((null===(a=window.chartGroupMap)||void 0===a?void 0:a[o])||0)===r){const e=i.timeScale();e&&n&&e.setVisibleLogicalRange(n)}}catch(s){}}),n)){const e={timeRange:n,chartId:t,groupId:r,timestamp:Date.now(),type:"timeRange"};try{localStorage.setItem("chart_time_range_sync",JSON.stringify(e))}catch(o){}}})}}},[]),W=(0,o.useCallback)((e,t,n)=>{try{console.log("[PaneSetup] Setting up collapse support for ".concat(n," panes")),window.paneWrappers=window.paneWrappers||{},window.paneWrappers[t]={},window.chartInstances=window.chartInstances||{},window.chartInstances[t]=e,console.log("[PaneSetup] Collapse support ready for ".concat(n," panes"))}catch(r){console.error("[PaneSetup] Error setting up pane collapse support:",r)}},[]),$=(0,o.useCallback)((e,t)=>{var n,r,o,i,a,s;if(!e||"function"!=typeof e.timeScale)return;const c=e.timeScale();if(!c)return;let l=0;if(!1!==(null===(n=t.chart)||void 0===n||null===(r=n.timeScale)||void 0===r?void 0:r.fitContentOnLoad)&&!1!==(null===(o=t.chart)||void 0===o?void 0:o.fitContentOnLoad)){const e=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(50>t)try{if(0===Object.values(x.current).flat().length)return void setTimeout(()=>e(t+1),100);const n=c.getVisibleRange();n&&n.from&&n.to?c.fitContent():setTimeout(async()=>{try{c.fitContent()}catch(e){}},100)}catch(n){}};A.current&&clearTimeout(A.current),A.current=setTimeout(async()=>{await e()},1e3)}!1!==(null===(i=t.chart)||void 0===i||null===(a=i.timeScale)||void 0===a?void 0:a.handleDoubleClick)&&!1!==(null===(s=t.chart)||void 0===s?void 0:s.handleDoubleClick)&&e.subscribeClick(e=>{const t=Date.now();if(300>t-l){try{c.fitContent()}catch(n){}l=0}else l=t})},[]),V=(0,o.useCallback)(()=>{if(null!==M.current&&(R.current=!0),Object.values(O.current).forEach(e=>{e&&clearTimeout(e)}),O.current={},A.current&&(clearTimeout(A.current),A.current=null),I.current&&(clearTimeout(I.current),I.current=null),E.current){try{E.current.disconnect()}catch(t){}E.current=null}Object.entries(P.current).forEach(e=>{let[n,r]=e;try{r.destroy()}catch(t){}}),Object.values(T.current).forEach(e=>{try{e.disconnect()}catch(t){}}),window.paneCollapsePlugins&&(Object.entries(window.paneCollapsePlugins).forEach(e=>{let[n,r]=e;Array.isArray(r)&&r.forEach(e=>{try{e&&"function"==typeof e.detached&&e.detached()}catch(t){}})}),window.paneCollapsePlugins={});const e=d.Y.getInstance();Object.keys(C.current).forEach(t=>{e.unregisterChart(t)}),Object.values(C.current).forEach(e=>{try{e&&"function"==typeof e.remove&&e.remove()}catch(t){}}),C.current={},x.current={},P.current={},S.current={},T.current={},L.current={},k.current=!1},[]),_=(0,o.useCallback)(async(e,t,n,r,o)=>{if(n&&0!==n.length)try{const e=[];if("rectangles"===r.style||"both"===r.style){const t=n.map((e,t)=>{const n="string"==typeof e.entryTime?Math.floor(new Date(e.entryTime).getTime()/1e3):e.entryTime,i="string"==typeof e.exitTime?Math.floor(new Date(e.exitTime).getTime()/1e3):e.exitTime;let a=n,c=i;if(o&&o.length>0){const e=m(n,o),t=m(i,o);e&&(a=e),t&&(c=t)}let l="";if(!1!==r.rectangleShowText){const t=[];if(!1!==r.showTradeId&&e.id&&t.push("ID: ".concat(e.id)),!1!==r.showQuantity&&e.quantity&&t.push("Qty: ".concat(e.quantity)),!1!==r.showTradeType){const n=e.isProfitable?"Profit":"Loss";t.push(n)}e.pnl?t.push("P&L: ".concat(e.pnl.toFixed(2))):e.pnlPercentage&&t.push("P&L: ".concat(e.pnlPercentage.toFixed(1),"%")),l=t.length>0?t.join(" | "):e.notes||e.text||""}const d={time1:a,time2:c,price1:e.entryPrice,price2:e.exitPrice,fillColor:e.isProfitable?r.rectangleColorProfit||"rgba(76, 175, 80, 0.2)":r.rectangleColorLoss||"rgba(244, 67, 54, 0.2)",borderColor:e.isProfitable?r.rectangleColorProfit||"rgb(76, 175, 80)":r.rectangleColorLoss||"rgb(244, 67, 54)",borderWidth:r.rectangleBorderWidth||1,borderStyle:"solid",opacity:r.rectangleFillOpacity||.2,label:l,textPosition:r.rectangleTextPosition||"inside",textFontSize:r.rectangleTextFontSize||10,textColor:r.rectangleTextColor||"#FFFFFF",textBackground:r.rectangleTextBackground||"rgba(0, 0, 0, 0.7)"};return new s.j(d)}).filter(e=>null!==e);e.push(...t)}if(e.length>0&&e.forEach((e,n)=>{try{t.attachPrimitive(e)}catch(r){console.error("‚ùå [addTradeVisualization] Error attaching primitive ".concat(n,":"),r)}}),"markers"===r.style||"both"===r.style){const e=[];if(n.forEach((t,n)=>{const i="string"==typeof t.entryTime?Math.floor(new Date(t.entryTime).getTime()/1e3):t.entryTime,a="string"==typeof t.exitTime?Math.floor(new Date(t.exitTime).getTime()/1e3):t.exitTime;let s=i,c=a;if(o&&o.length>0){const e=m(i,o),t=m(a,o);e&&(s=e),t&&(c=t)}if(s&&"number"==typeof t.entryPrice){const n="long"===t.tradeType,o=r.showPnlInMarkers?"Entry: ".concat(t.entryPrice):t.notes||t.text||"";e.push({time:s,position:n?"belowBar":"aboveBar",color:n?r.entryMarkerColorLong||"#2196F3":r.entryMarkerColorShort||"#FF9800",shape:n?"arrowUp":"arrowDown",size:r.markerSize||5,text:o})}if(c&&"number"==typeof t.exitPrice){const n="long"===t.tradeType,o=t.isProfitable||t.pnl&&t.pnl>=0;let i="";r.showPnlInMarkers&&(i="Exit: ".concat(t.exitPrice),t.pnl?i+=" (".concat(t.pnl>0?"+":"").concat(t.pnl.toFixed(2),")"):t.pnlPercentage&&(i+=" (".concat(t.pnlPercentage>0?"+":"").concat(t.pnlPercentage.toFixed(1),"%)"))),e.push({time:c,position:n?"aboveBar":"belowBar",color:o?r.exitMarkerColorProfit||"#4CAF50":r.exitMarkerColorLoss||"#F44336",shape:n?"arrowDown":"arrowUp",size:r.markerSize||5,text:i})}}),e.length>0)try{(0,i.hR)(t,e)}catch(a){console.error("‚ùå [addTradeVisualization] Error adding markers:",a)}}"lines"!==r.style&&"arrows"!==r.style&&"zones"!==r.style||console.warn("üöß [addTradeVisualization] Style '".concat(r.style,"' is not yet implemented. Available: rectangles, markers, both"))}catch(a){console.error("‚ùå [addTradeVisualization] Error in trade visualization:",a)}},[]),B=(0,o.useCallback)((e,t)=>{let n=[];if(t&&"object"==typeof t)if("layers"in t&&t.layers)try{const e=Object.values(t.layers);Array.isArray(e)&&e.forEach(e=>{e&&!1!==e.visible&&e.annotations&&Array.isArray(e.annotations)&&n.push(...e.annotations)})}catch(s){}else Array.isArray(t)&&(n=t);if(!n||!Array.isArray(n))return;try{if("function"!=typeof n.forEach)return}catch(s){return}const r=n.filter(e=>e&&"object"==typeof e&&e.time);if(0===r.length)return;if(!Array.isArray(r)||"function"!=typeof r.forEach)return void console.error("addAnnotations: validAnnotations is still not a proper array:",r);const o=(0,a.TB)(r);if(o.markers.length>0){const e=Object.values(x.current).flat();e.length>0&&(0,i.hR)(e[0],o.markers)}if(o.shapes.length>0){const e=Object.values(x.current).flat();e.length>0&&o.shapes.forEach(t=>{try{e[0].addShape?e[0].addShape(t):e[0].setShapes&&e[0].setShapes([t])}catch(s){}})}},[]),N=(0,o.useCallback)((e,t)=>{let n=[];if(t&&"object"==typeof t)if("layers"in t&&t.layers)try{const e=Object.values(t.layers);Array.isArray(e)&&(n=e)}catch(r){}else Array.isArray(t)&&(n=t);n&&Array.isArray(n)&&n.forEach((t,n)=>{try{if(!t||"object"!=typeof t)return;!1!==t.visible&&t.annotations&&z.current.addAnnotations(e,t.annotations)}catch(r){}})},[]),G=(0,o.useCallback)((e,t,r,o)=>{if(o.tooltipConfigs&&0!==Object.keys(o.tooltipConfigs).length)try{n.e(755).then(n.bind(n,3755)).then(n=>{let{createTooltipPlugin:r}=n;const i=r(e,t,o.chartId||"chart-".concat(Date.now()),o.tooltipConfigs,o);i.enable(),window.chartPlugins||(window.chartPlugins=new Map),window.chartPlugins.set(e,i)}).catch(e=>{console.error("üéØ [addModularTooltip] Error loading tooltip plugin:",e)})}catch(i){console.error("üéØ [addModularTooltip] Error setting up tooltip:",i)}},[]),q=(0,o.useCallback)((e,t)=>{},[]),U=(0,o.useCallback)(async(e,t)=>{if(!R.current&&e&&t&&0!==Object.keys(t).length){try{e.chartElement()}catch(n){return}try{e.timeScale()}catch(n){return}R.current}},[]),J=(0,o.useRef)(new Map),K=(0,o.useRef)(new Map),Q=(0,o.useCallback)((e,t,n)=>{console.log("üîç [updateLegendValues] Called for chart ".concat(t,":"),{hasTime:!!n.time,time:n.time,hasLegendSeriesData:!!K.current.get(t)});const o=K.current.get(t);o&&n.time?o.forEach((e,o)=>{let{series:i,legendConfig:a,paneId:s,seriesName:c,seriesIndex:l}=e;try{var d;let e={};try{"function"==typeof i.options?e=i.options():i.options&&(e=i.options)}catch(u){console.warn("Could not get series options:",u)}let o="Unknown";try{"function"==typeof i.seriesType?o=i.seriesType()+"":i.seriesType&&"string"==typeof i.seriesType&&(o=i.seriesType)}catch(u){console.warn("Could not get series type:",u)}const h=i.data();if(!h||0===h.length)return;let p=null,g=1/0;for(const t of h)if(t.time&&n.time&&"number"==typeof t.time&&"number"==typeof n.time){const e=Math.abs(t.time-n.time);g>e&&(g=e,p=t)}if(!p){const e="".concat(t,"-").concat(l);return void(window.legendPrimitives&&window.legendPrimitives[e]&&window.legendPrimitives[e].updateValue(null))}let f="#2196f3";e.color?f=e.color:"Candlestick"===o?f="#26a69a":"Histogram"===o?f="#ff9800":"Area"===o&&(f=e.topColor||"#4caf50");const y=(0,r.A)({title:c,value:p.value||p.close||p.high||"",time:p.time||"",color:f,type:o},p),m="".concat(t,"-").concat(l);if(console.log("üîç [Crosshair] Looking for legend primitive:",{key:m,seriesIndex:l,hasPrimitives:!!window.legendPrimitives,primitiveExists:!(null===(d=window.legendPrimitives)||void 0===d||!d[m]),value:y.value}),window.legendPrimitives&&window.legendPrimitives[m]){const e=window.legendPrimitives[m];console.log("‚úÖ [Crosshair] Found legend primitive, calling updateValue"),e.updateValue(y.value)}else console.log("‚ùå [Crosshair] Legend primitive not found for key: ".concat(m));const w=J.current.get("".concat(t,"-pane-").concat(s));if(!w)return;w.querySelectorAll("[data-series-name]").forEach(e=>{const t=e;if(t.getAttribute("data-series-name")===c)if(a.text){let e=a.text;if(e.includes("$$value$$")){let t="";if(null!==y.value&&void 0!==y.value&&""!==y.value)if("number"==typeof y.value){const e=a.valueFormat||".2f";if(e.includes(".")&&e.includes("f")){const n=e.split(".")[1].split("f")[0],r=n?parseInt(n):2;t=y.value.toFixed(r)}else t=y.value.toFixed(2)}else t=y.value+"";e=e.replace(/\$\$value\$\$/g,t)}t.innerHTML=e;const n="#131722",r='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',o="10px",i="2px",s="left";t.style.setProperty("color",n,"important"),t.style.setProperty("font-family",r,"important"),t.style.setProperty("font-size",o,"important"),t.style.setProperty("letter-spacing",i,"important"),t.style.setProperty("text-align",s,"important"),t.querySelectorAll("*").forEach(e=>{e instanceof HTMLElement&&(e.style.setProperty("color",n,"important"),e.style.setProperty("font-family",r,"important"),e.style.setProperty("font-size",o,"important"),e.style.setProperty("letter-spacing",i,"important"),e.style.setProperty("text-align",s,"important"))})}else{const e=t.querySelector("span:last-child");if(e){const t=y.value;if(!1===a.updateOnCrosshair)return;let n="N/A";if(null!=t&&""!==t)if("number"==typeof t){const e=a.valueFormat||".2f";if(e.includes(".")&&e.includes("f")){const r=e.split(".")[1].split("f")[0],o=r?parseInt(r):2;n=t.toFixed(o)}else n=t.toFixed(2)}else n=t+"";!1!==a.showValues?e.textContent="".concat(c,": ").concat(n):e.textContent=c}}})}catch(u){console.error("‚ùå Error updating legend for series:",u)}}):console.log("‚ùå [updateLegendValues] No legend series data or time for chart ".concat(t))},[]),Y=(0,o.useCallback)(async(e,t,n)=>{if(console.log("üîç [addLegend] Called with:",{chartId:e.chartElement().id,legendsConfig:t,seriesListLength:n.length}),R.current)return;if(!e||!t||0===Object.keys(t).length||0===n.length)return;try{e.chartElement()}catch(l){return}try{e.timeScale()}catch(l){return}if(R.current)return;try{await async function(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;for(let o=0;n>o;o++)try{return await e()}catch(l){if(t=l,o===n-1)throw t;const i=r*Math.pow(2,o)+100*Math.random();await new Promise(e=>setTimeout(e,i))}throw t}(async()=>{if(R.current)throw Error("Component disposed during retry");try{let n=[];if(e&&"function"==typeof e.panes)try{n=e.panes()}catch(l){n=[]}const r=Math.max(...Object.keys(t).map(e=>parseInt(e)));if(n.length<=r)throw Error("Not enough panes in chart API. Found: ".concat(n.length,", Need: ").concat(r+1));return n}catch(l){throw Error("Chart panes not ready: ".concat(l))}},10,200,"Chart API readiness check")}catch(l){return void(l instanceof Error&&"Component disposed during retry"===l.message||console.error("‚ùå Failed to wait for chart API:",l))}const r=e.chartElement().id||"default",o=[],i=e.chartElement().querySelectorAll("*"),a=Array.from(i).filter(e=>{const t=e.textContent||"";return t.includes("Know Sure Thing")||t.includes("KST")||t.includes("Legend")||e.className.includes("legend")||e.id.includes("legend")});if(a.length>0){const e=a.find(e=>{var t;return null===(t=e.textContent)||void 0===t?void 0:t.includes("Know Sure Thing")});if(e)try{e.remove()}catch(l){console.error('‚ùå Failed to remove "Know Sure Thing" legend:',l)}}const s=new Map;n.forEach((e,t)=>{let n,r=0,o={};try{"function"==typeof e.options?o=e.options():e.options&&(o=e.options)}catch(l){console.warn("Could not get series options:",l)}void 0!==e.paneId?n=e.paneId:o&&void 0!==o.paneId&&(n=o.paneId),r=void 0!==n?n:0,e.assignedPaneId=r,s.has(r)||s.set(r,[]),s.get(r).push(e)}),Object.keys(t).forEach(r=>{const i=parseInt(r),a=t[i];if(!a)return;if(!a.visible)return;const c=s.get(i)||[];let d;try{if(e&&"function"==typeof e.panes)try{d=e.panes()[i]}catch(l){d=null}else d=null;if(!d)return void console.error("‚ùå Pane ".concat(i," not found in chart API"))}catch(l){return void console.error("‚ùå Error accessing pane ".concat(i," in chart API:"),l)}c.forEach((e,t)=>{const r=n.findIndex(t=>t===e);o.push({series:e,legendConfig:a,paneId:i,seriesName:"Pane ".concat(i),seriesIndex:0>r?t:r})})}),K.current.set(r,o),console.log("üîç [Legend] legendsConfig for chart ".concat(r,":"),t),console.log("üîç [Legend] Object.values(legendsConfig):",Object.values(t));const c=Object.values(t).some(e=>{const t=!1!==e.updateOnCrosshair,n=e.text&&e.text.includes("$$value$$");return console.log("üîç [Legend] Checking config:",{updateOnCrosshair:e.updateOnCrosshair,hasUpdate:t,text:e.text,hasPlaceholder:n,result:t||n}),t||n});c?(console.log("üîç [Crosshair] Setting up crosshair subscription for chart ".concat(r)),Object.entries(t).forEach(e=>{let[t,n]=e;if(n.text&&n.text.includes("$$value$$")){const e=o.findIndex(e=>e.seriesName===t);if(e>=0){const t="".concat(r,"-").concat(e);window.legendPrimitives&&window.legendPrimitives[t]&&window.legendPrimitives[t].updateValue(null)}}}),e.subscribeCrosshairMove(t=>{console.log("üîç [Crosshair] Crosshair moved for chart ".concat(r,":"),{time:t.time,point:t.point,hasTime:!!t.time}),t.time&&t.point?Q(e,r,t):Q(e,r,{time:null,point:null,seriesData:new Map})})):console.log("‚ÑπÔ∏è [Crosshair] No crosshair updates enabled for chart ".concat(r))},[Q]),X=(0,o.useMemo)(()=>t&&t.charts&&0!==t.charts.length?t.charts.map((e,t)=>{var n,o,i,a;const s=e.chartId||"chart-".concat(t);return(0,r.A)((0,r.A)({},e),{},{chartId:s,containerId:"chart-container-".concat(s),chartOptions:(0,h.L)((0,r.A)({width:null!==(n=e.chart)&&void 0!==n&&n.autoWidth?void 0:(null===(o=e.chart)||void 0===o?void 0:o.width)||v||void 0,height:null!==(i=e.chart)&&void 0!==i&&i.autoHeight?void 0:(null===(a=e.chart)||void 0===a?void 0:a.height)||u||void 0},e.chart))})}):[],[t,v,u]),Z=(0,o.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];k.current&&!R.current||R.current&&!e||X&&0!==X.length&&(e||z.current.cleanupCharts(),X&&0!==X.length&&(window.chartApiMap||(window.chartApiMap={}),window.chartGroupMap||(window.chartGroupMap={}),window.seriesRefsMap||(window.seriesRefsMap={}),X.forEach((e,n)=>{const o=e.chartId,a=e.containerId||"chart-container-".concat(o);let s=document.getElementById(a);if(s)L.current[o]=s;else{s=document.createElement("div"),s.id=a,s.style.width="100%",s.style.height="100%";let t=(0,g.$$)('[data-testid="stHorizontalBlock"]');if(t||(t=(0,g.$$)(".stHorizontalBlock")),t||(t=(0,g.$$)('[data-testid="stVerticalBlock"]')),t||(t=(0,g.$$)(".stVerticalBlock")),t||(t=(0,g.$$)('[data-testid="stBlock"]')),t||(t=(0,g.$$)(".stBlock")),t||(t=document.body),!t)return;{var f;t.appendChild(s),s.style.width="100%";const n=null!==(f=e.chart)&&void 0!==f&&f.height?"".concat(e.chart.height,"px"):"100%";s.style.height=n,s.style.minHeight="300px",s.style.minWidth="200px",s.style.display="block",s.style.position="relative",s.style.overflow="hidden",L.current[o]=s}}try{var y,m,b,E,k,A,I;if(!s||!s.isConnected)return;const n=e.chartOptions||e.chart||{};let a;try{a=(0,i.R9)(s,n)}catch(M){return}if(!a)return;const g=a.chartElement();g&&(g.id=o),C.current[o]=a,d.Y.getInstance().registerChart(o,a),window.chartApiMap||(window.chartApiMap={}),window.chartApiMap[o]=a,window.legendRefreshCallbacks||(window.legendRefreshCallbacks={}),window.legendRefreshCallbacks[o]||(window.legendRefreshCallbacks[o]=[]);const f="undefined"!=typeof ResizeObserver?new ResizeObserver(e=>{for(const t of e)t.target===s&&setTimeout(()=>{J.current},100)}):null;f&&"function"==typeof f.observe&&f.observe(s),window.chartResizeObservers||(window.chartResizeObservers={}),window.chartResizeObservers[o]=f;const L=s.getBoundingClientRect(),j=e.autoWidth?L.width:n&&n.width||v||L.width,H=n&&n.height||(e.autoHeight?L.height:u)||L.height,F=Math.max(j,200),D=Math.max(H,200);a.resize(F,D),n.layout&&n.layout.panes&&a.applyOptions({layout:{panes:n.layout.panes}});const $=new Map;let V=[];if(a&&"function"==typeof a.panes)try{V=a.panes()}catch(O){V=[]}e.series.forEach(e=>{const t=e.paneId||0;if(!$.has(t))if(t<V.length)$.set(t,V[t]);else{let e=null;if(a&&"function"==typeof a.addPane)try{e=a.addPane()}catch(O){e=null}if(e&&($.set(t,e),a&&"function"==typeof a.panes))try{V=a.panes()}catch(O){}}}),null!==(y=e.chart)&&void 0!==y&&y.overlayPriceScales&&Object.entries(e.chart.overlayPriceScales).forEach(e=>{let[t,n]=e;try{const e=a.priceScale(t);e&&e.applyOptions((0,h.L)(n))}catch(O){}});const B=[];if(e.series&&Array.isArray(e.series)&&e.series.forEach((t,n)=>{try{if(!t||"object"!=typeof t)return;0===n&&e.trades&&e.trades.length>0&&e.tradeVisualizationOptions&&(t.trades=e.trades,t.tradeVisualizationOptions=e.tradeVisualizationOptions);const s=(0,p.w)(a,t,{signalPluginRefs:P},o,n);if(s){var r,i;if(B.push(s),t.legend&&t.legend.visible)try{l.ChartReadyDetector.waitForChartReady(a,a.chartElement(),{minWidth:200,minHeight:200}).then(e=>{e?w(a,t,o,n):(console.warn("[Legend] Chart not ready for series ".concat(n,", retrying...")),setTimeout(()=>{l.ChartReadyDetector.waitForChartReady(a,a.chartElement(),{minWidth:200,minHeight:200}).then(e=>{e&&w(a,t,o,n)})},300))})}catch(O){console.error("‚ùå [Legend] Error creating legend for series ".concat(n,":"),O)}if(t.priceScaleId&&"right"!==t.priceScaleId&&"left"!==t.priceScaleId&&null!==(r=e.chart)&&void 0!==r&&null!==(i=r.overlayPriceScales)&&void 0!==i&&i[t.priceScaleId]){const n=e.chart.overlayPriceScales[t.priceScaleId];try{const e=s.priceScale();e&&e.applyOptions((0,h.L)(n))}catch(O){}}if(t.trades&&t.tradeVisualizationOptions)try{setTimeout(async()=>{try{if(await l.ChartReadyDetector.waitForChartReadyForPrimitives(a,s,{maxAttempts:100,baseDelay:100,requireData:!0}))await _(a,s,t.trades,t.tradeVisualizationOptions,t.data);else{console.error("‚ùå [initializeCharts] Chart readiness check timed out");try{await _(a,s,t.trades,t.tradeVisualizationOptions,t.data)}catch(e){console.error("‚ùå [initializeCharts] Primitive attachment also failed:",e)}}}catch(O){console.error("‚ùå [initializeCharts] Error in chart readiness or trade visualization:",O)}},50)}catch(O){console.error("‚ùå [initializeCharts] Error setting up trade visualization:",O)}t.annotations&&z.current.addAnnotations(a,t.annotations)}}catch(s){console.error("Error creating series at index ".concat(n," for chart ").concat(o,":"),s)}}),x.current[o]=B,window.seriesRefsMap&&(window.seriesRefsMap[o]=B),null!==(m=e.chart)&&void 0!==m&&null!==(b=m.layout)&&void 0!==b&&b.paneHeights){let t=[];if(a&&"function"==typeof a.panes)try{t=a.panes()}catch(O){t=[]}Object.entries(e.chart.layout.paneHeights).forEach(e=>{let[n,r]=e;const o=parseInt(n),i=r;if(o<t.length&&i.factor)try{t[o].setStretchFactor(i.factor)}catch(O){}})}z.current.addModularTooltip(a,s,B,e),S.current[o]=e,e.annotations&&z.current.addAnnotations(a,e.annotations),e.annotationLayers&&z.current.addAnnotationLayers(a,e.annotationLayers),e.priceLines&&B.length>0&&e.priceLines.forEach(e=>{B[0].createPriceLine(e)}),null!==(E=e.chart)&&void 0!==E&&E.rangeSwitcher&&e.chart.rangeSwitcher.visible&&setTimeout(()=>{z.current.addRangeSwitcher(a,e.chart.rangeSwitcher)},100);const N={};if(B.forEach((t,n)=>{const r=e.series[n];if(null!=r&&r.legend&&r.legend.visible){const e=r.paneId||0;N[e.toString()]=r.legend}}),Object.keys(N).length>0&&setTimeout(()=>{z.current.addLegend(a,N,B)},200),setTimeout(()=>{if(!R.current&&C.current[o]){try{a.timeScale().fitContent()}catch(O){console.warn("Error during chart initialization:",O)}if(f&&"function"==typeof f.observe){const e=a.chartElement();e&&f.observe(e)}T.current[o]=f,setTimeout(()=>{try{window.legendRefreshCallbacks&&window.legendRefreshCallbacks[o]&&window.legendRefreshCallbacks[o].forEach(e=>{e()})}catch(O){console.warn("Error refreshing legends after initialization:",O)}},500)}},200),z.current.setupAutoSizing(a,s,e),t.syncConfig&&t.syncConfig.enabled){const n=e.chartGroupId||0;window.chartGroupMap||(window.chartGroupMap={}),window.seriesRefsMap||(window.seriesRefsMap={}),window.chartGroupMap[o]=n;let r=t.syncConfig;t.syncConfig.groups&&t.syncConfig.groups[n]&&(r=t.syncConfig.groups[n]),z.current.setupChartSynchronization(a,o,r,n)}z.current.setupFitContent(a,e);const G=e.paneCollapse||{enabled:!0};if(!1!==G.enabled)try{let e=[];if(a&&"function"==typeof a.panes)try{e=a.panes()}catch(O){e=[]}e.length>1&&(console.log("[PaneSetup] Creating individual containers for ".concat(e.length," panes")),W(a,o,e.length),e.forEach((e,t)=>{const n=(0,c.vI)(t,(0,r.A)({},G));e.attachPrimitive(n),window.paneCollapsePlugins||(window.paneCollapsePlugins={}),window.paneCollapsePlugins[o]||(window.paneCollapsePlugins[o]=[]),window.paneCollapsePlugins[o].push(n)}))}catch(O){console.error("Error adding pane collapse plugins:",O)}!1!==(null===(k=e.chart)||void 0===k||null===(A=k.timeScale)||void 0===A?void 0:A.fitContentOnLoad)&&!1!==(null===(I=e.chart)||void 0===I?void 0:I.fitContentOnLoad)&&B.length>0&&setTimeout(()=>{try{const e=a.timeScale();e&&e.fitContent()}catch(O){}},100)}catch(O){console.error("Error creating chart:",O)}}),k.current=!0,setTimeout(()=>{b&&b()},50)))},[X,null==t?void 0:t.syncConfig,v,u,b,_,W]);(0,o.useEffect)(()=>{z.current={addTradeVisualization:_,addAnnotations:B,addModularTooltip:G,addAnnotationLayers:N,addRangeSwitcher:q,addLegend:Y,updateLegendPositions:U,setupAutoSizing:F,setupChartSynchronization:D,setupFitContent:$,setupPaneCollapseSupport:W,cleanupCharts:V}},[_,B,G,N,q,Y,U,F,D,$,W,V]);const ee=(0,o.useMemo)(()=>t,[t]);(0,o.useEffect)(()=>{ee&&ee.charts&&ee.charts.length>0&&Z(!0)},[ee,Z]),(0,o.useEffect)(()=>()=>{V()},[V]);const te=(0,o.useMemo)(()=>t&&t.charts&&0!==t.charts.length?t.charts.map((e,t)=>{const n=e.chartId||"chart-".concat(t),o="chart-container-".concat(n),i=e.autoSize||e.autoWidth||e.autoHeight,a=e.chart||{},s=(0,g.a1)(v,u,!!i,a),c=(0,r.A)((0,r.A)({},s.container),{},{minWidth:a.minWidth||e.minWidth||(i?200:void 0),minHeight:a.minHeight||e.minHeight||(i?200:void 0),maxWidth:a.maxWidth||e.maxWidth,maxHeight:a.maxHeight||e.maxHeight}),l=s.chartContainer;return(0,f.jsx)("div",{style:c,children:(0,f.jsx)("div",{id:o,style:l})},n)}):[],[t,v,u]);return t&&t.charts&&0!==t.charts.length?(0,f.jsx)(y,{children:(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column"},children:te})}):(0,f.jsx)("div",{children:"No charts configured"})})}}]);