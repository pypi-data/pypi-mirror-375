import{d as T,A as v,x as I,j as e,a1 as $,e as s,X as oe,z as J,a as le,r as _,E as ue,c as N,f as K,h as i,a0 as ie,w as o,a2 as re,a3 as z,a4 as X,n as ce,t as _e,$ as B,aL as de,a5 as pe,J as H,a9 as fe,aO as me,aS as D,ab as U,o as ve,a$ as ge}from"./index-B2xfjOzF.js";import{d as ye,e as he,f as be}from"./autoCali-BqsGmoHy.js";import{_ as ke}from"./LogView.vue_vue_type_script_setup_true_lang-BRFMRuRp.js";import{u as M}from"./useInterval-BDaf0Qf8.js";import{u as xe}from"./autoCali-x_Ynowxs.js";import{a as P,b as Q}from"./Tabs-Bx15qgEn.js";import"./dayjs.min-DGX6_Ep-.js";import"./Add-D4qD_bnP.js";import"./debounce-D7Ri4zDg.js";const O=T({__name:"EntityLog",props:{logs:{}},setup(A){return(r,d)=>e($)(r.logs)?I("",!0):(s(),v(ke,{key:0,logs:r.logs},null,8,["logs"]))}}),Ce={class:"flex ml-5"},F=120,Ee=T({__name:"EntitiesView",props:{entities:{}},setup(A){const r=xe(),d=oe(),E=J(),{t:R}=le(),p=_(),g=_(),a=_(0),b=_(),w=_(0),l=_(!1),u=_(),q=A,W=ue(()=>{const n=q.entities.length;return Array(n<F?F:n).fill(0).map((t,f)=>q.entities[f])}),Y=n=>{n&&(u.value||(u.value=!0,p.value=n,g.value=[],b.value=[],a.value=0,w.value=0,l.value=!0,L.value==0?V():S()))},S=async()=>{var f,k,m,c,y;l.value=!0;const[n,t]=await ye({session_id:+E.query.session_id,entity:p.value});u.value=!1,l.value=!1,!n&&(t==null?void 0:t.status)===0&&(w.value!==((f=t.data)==null?void 0:f.last_record_id)&&((k=t.data)!=null&&k.last_record_id)&&(b.value=[...b.value||[],...(m=t.data)==null?void 0:m.logs]),(c=t.data)!=null&&c.last_record_id&&(w.value=(y=t.data)==null?void 0:y.last_record_id),D(()=>{var h,x;!G.value&&((h=r.sessionInfo)==null?void 0:h.status)===U.RUNNING&&Z(),((x=r.sessionInfo)==null?void 0:x.status)!==U.RUNNING&&(ee(),G.value&&S())}))},{start:Z,stop:ee,runing:G}=M(S,{isManual:!0,duration:3e3}),V=async()=>{var f,k,m,c,y;l.value=!0;const[n,t]=await he({session_id:+E.query.session_id,entity:p.value,last_record_id:a.value});u.value=!1,l.value=!1,!n&&(t==null?void 0:t.status)===0&&(a.value!==((f=t.data)==null?void 0:f.last_record_id)&&((k=t.data)!=null&&k.last_record_id)&&(g.value=[...g.value||[],...(m=t.data)==null?void 0:m.logs]),(c=t.data)!=null&&c.last_record_id&&(a.value=(y=t.data)==null?void 0:y.last_record_id),D(()=>{var h,x;!j.value&&((h=r.sessionInfo)==null?void 0:h.status)===U.RUNNING&&te(),((x=r.sessionInfo)==null?void 0:x.status)!==U.RUNNING&&(ae(),j.value&&V())}))},{start:te,stop:ae,runing:j}=M(V,{isManual:!0,duration:3e3}),L=_(0),se=n=>{L.value=n,p.value&&(n===0?V():S())};return(n,t)=>{const f=pe,k=re,m=ie,c=fe,y=me,h=Q,x=P;return s(),N("div",Ce,[K("div",null,[i(m,{style:{height:"calc(100vh - 310px)"}},{default:o(()=>[i(k,{cols:10,style:{width:"560px"}},{default:o(()=>[(s(!0),N(z,null,X(e(W),(C,ne)=>(s(),v(f,{key:ne,class:de(["border min-w-14 min-h-14 flex items-center justify-center p-1",[C?"cursor-pointer":""]]),style:B({borderColor:e(d).dividerColor,backgroundColor:e(p)===C&&e(p)?"#00B42A":"inherit",color:e(p)===C?"#fff":"inherit"}),onClick:()=>Y(C)},{default:o(()=>[ce(_e(C),1)]),_:2},1032,["style","class","onClick"]))),128))]),_:1})]),_:1})]),i(x,{animated:"",class:"!h-full flex-1 !w-auto ml-8",value:e(L),"onUpdate:value":t[0]||(t[0]=C=>H(L)?L.value=C:null),onUpdateValue:se},{default:o(()=>[i(h,{name:0,key:"0",tab:e(R)("groupDetail.autoCali.caliLog"),class:"!pl-0","display-directive":"show:lazy"},{default:o(()=>[i(m,{style:B({padding:"15px",height:"calc(100vh - 345px)",backgroundColor:e(d).baseColor})},{default:o(()=>[e(u)?(s(),v(c,{key:0})):(s(),N(z,{key:1},[i(O,{logs:e(g)},null,8,["logs"]),e(l)?(s(),v(c,{key:0})):I("",!0),e($)(e(g))?(s(),v(y,{key:1,class:"mt-32"})):I("",!0)],64))]),_:1},8,["style"])]),_:1},8,["tab"]),i(h,{name:1,key:"1",tab:e(R)("groupDetail.autoCali.caliRecord"),class:"!pl-0","display-directive":"show:lazy"},{default:o(()=>[i(m,{style:B({padding:"15px",height:"calc(100vh - 345px)",backgroundColor:e(d).baseColor})},{default:o(()=>[e(u)?(s(),v(c,{key:0})):(s(),N(z,{key:1},[i(O,{logs:e(b)},null,8,["logs"]),e(l)?(s(),v(c,{key:0})):I("",!0),e($)(e(b))?(s(),v(y,{key:1,class:"mt-32"})):I("",!0)],64))]),_:1},8,["style"])]),_:1},8,["tab"])]),_:1},8,["value"])])}}}),$e=T({__name:"AutoCaliEntity",setup(A){const r=J(),d=_(),E=_(),R=async()=>{const[g,a]=await be({device_group_name:r.query.device_group_name,space_id:+r.query.space_id});!g&&(a==null?void 0:a.status)===0&&(E.value=a.data,d.value=Object.keys(a.data)[0])},p=()=>{};return ve(()=>{R()}),(g,a)=>{const b=Q,w=P;return s(),N("div",null,[i(w,{type:"card",animated:"",size:"small",placement:"left",class:"!h-full !w-auto",value:e(d),"onUpdate:value":a[0]||(a[0]=l=>H(d)?d.value=l:null),onUpdateValue:p,"tab-class":"w-[128px]"},ge({suffix:o(()=>[a[2]||(a[2]=K("div",null,null,-1))]),default:o(()=>[(s(!0),N(z,null,X(e(E),(l,u)=>(s(),v(b,{name:u,key:u,tab:u},{default:o(()=>[i(Ee,{"active-key":u,entities:l},null,8,["active-key","entities"])]),_:2},1032,["name","tab"]))),128))]),_:2},[e($)(e(E))?void 0:{name:"prefix",fn:o(()=>[a[1]||(a[1]=K("div",null,null,-1))]),key:"0"}]),1032,["value"])])}}});export{$e as default};
