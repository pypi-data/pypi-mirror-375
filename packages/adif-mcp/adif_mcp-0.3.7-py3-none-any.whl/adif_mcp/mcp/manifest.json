{
  "schema_version": "1.0",
  "name": "adif-mcp",
  "version": "0.1.16",
  "description": "ADIF MCP core service with eQSL demo tools",
  "components": {
    "schemas": {
      "QsoRecord": {
        "type": "object",
        "description": "Minimal ADIF-safe QSO shape used by tools",
        "required": [
          "station_call",
          "call",
          "qso_date",
          "time_on",
          "band",
          "mode"
        ],
        "properties": {
          "station_call": {
            "type": "string",
            "minLength": 3,
            "maxLength": 20
          },
          "call": {
            "type": "string",
            "minLength": 3,
            "maxLength": 20
          },
          "qso_date": {
            "type": "string",
            "pattern": "^\\d{8}$",
            "description": "YYYYMMDD"
          },
          "time_on": {
            "type": "string",
            "pattern": "^\\d{4}(\\d{2})?$",
            "description": "HHMM[SS]"
          },
          "band": {
            "type": "string",
            "description": "e.g., 20m, 40m, 2m"
          },
          "mode": {
            "type": "string",
            "description": "e.g., CW, SSB, FT8"
          },
          "freq": {
            "type": [
              "number",
              "null"
            ],
            "minimum": 0,
            "description": "MHz"
          },
          "rst_sent": {
            "type": [
              "string",
              "null"
            ],
            "pattern": "^\\d{2,3}[A-Z]?$"
          },
          "rst_rcvd": {
            "type": [
              "string",
              "null"
            ],
            "pattern": "^\\d{2,3}[A-Z]?$"
          },
          "my_gridsquare": {
            "type": [
              "string",
              "null"
            ],
            "maxLength": 8
          },
          "gridsquare": {
            "type": [
              "string",
              "null"
            ],
            "maxLength": 8
          },
          "tx_pwr": {
            "type": [
              "number",
              "null"
            ],
            "minimum": 0
          },
          "comment": {
            "type": [
              "string",
              "null"
            ],
            "maxLength": 200
          },
          "lotw_qsl_rcvd": {
            "type": [
              "string",
              "null"
            ],
            "description": "ADIF QSL_RCVD enum (Y/N/R/I/V/Q/E)"
          },
          "eqsl_qsl_rcvd": {
            "type": [
              "string",
              "null"
            ],
            "description": "ADIF QSL_RCVD enum (Y/N/R/I/V/Q/E)"
          },
          "lotw_qsl_date": {
            "type": [
              "string",
              "null"
            ],
            "pattern": "^\\d{8}$"
          },
          "eqsl_qsl_date": {
            "type": [
              "string",
              "null"
            ],
            "pattern": "^\\d{8}$"
          },
          "adif_fields": {
            "type": [
              "object",
              "null"
            ],
            "additionalProperties": {
              "type": "string"
            },
            "description": "Original ADIF nameâ†’value map (optional)"
          }
        },
        "additionalProperties": false
      }
    }
  },
  "tools": [
    {
      "name": "eqsl.fetch_inbox",
      "description": "Fetch recent eQSL inbox QSOs for an authenticated user (demo scope).",
      "input_schema": {
        "type": "object",
        "properties": {
          "since_days": {
            "type": "integer",
            "minimum": 1,
            "maximum": 365,
            "default": 7,
            "description": "Lookback window in days."
          },
          "max_records": {
            "type": "integer",
            "minimum": 1,
            "maximum": 2000,
            "default": 500
          },
          "include_unconfirmed": {
            "type": "boolean",
            "default": true,
            "description": "Include unconfirmed items if true."
          }
        },
        "additionalProperties": false
      },
      "output_schema": {
        "type": "object",
        "required": [
          "records",
          "fetched_at"
        ],
        "properties": {
          "records": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/QsoRecord"
            }
          },
          "fetched_at": {
            "type": "string",
            "format": "date-time"
          },
          "source": {
            "type": "string",
            "const": "eQSL"
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "eqsl.filter_summary",
      "description": "Filter a batch of QSO records and return a compact summary.",
      "input_schema": {
        "type": "object",
        "required": [
          "records"
        ],
        "properties": {
          "records": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/QsoRecord"
            }
          },
          "band": {
            "type": [
              "string",
              "null"
            ],
            "description": "Optional band filter (e.g., 20m)."
          },
          "mode": {
            "type": [
              "string",
              "null"
            ],
            "description": "Optional mode filter (e.g., FT8)."
          },
          "confirmed_only": {
            "type": "boolean",
            "default": false,
            "description": "If true, include only QSL_RCVD in {Y,R}."
          }
        },
        "additionalProperties": false
      },
      "output_schema": {
        "type": "object",
        "required": [
          "total",
          "matched"
        ],
        "properties": {
          "total": {
            "type": "integer",
            "minimum": 0
          },
          "matched": {
            "type": "integer",
            "minimum": 0
          },
          "by_band": {
            "type": "object",
            "additionalProperties": {
              "type": "integer",
              "minimum": 0
            }
          },
          "by_mode": {
            "type": "object",
            "additionalProperties": {
              "type": "integer",
              "minimum": 0
            }
          },
          "sample": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/QsoRecord"
            },
            "description": "Optional small sample of matched QSOs for UI preview."
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "eqsl.fetch_inbox",
      "description": "Fetch eQSL inbox since a date (real or mock) and return normalized QSOs.",
      "input_schema": {
        "type": "object",
        "properties": {
          "persona": {
            "type": "string",
            "description": "Persona name holding eQSL credentials"
          },
          "since": {
            "type": "string",
            "description": "YYYY-MM-DD",
            "nullable": true
          },
          "mock": {
            "type": "boolean",
            "default": false
          }
        },
        "required": [
          "persona"
        ]
      },
      "output_schema": {
        "type": "object",
        "properties": {
          "records": {
            "type": "array",
            "items": {
              "type": "object"
            }
          }
        },
        "required": [
          "records"
        ]
      }
    },
    {
      "name": "eqsl.filter_summary",
      "description": "Summarize normalized QSOs by band or mode with optional date/confirmation filters.",
      "input_schema": {
        "type": "object",
        "properties": {
          "records": {
            "type": "array",
            "items": {
              "type": "object"
            }
          },
          "by": {
            "type": "string",
            "enum": [
              "band",
              "mode"
            ],
            "default": "band"
          },
          "confirmed_only": {
            "type": "boolean",
            "default": false
          },
          "date_from": {
            "type": "string",
            "description": "YYYY-MM-DD",
            "nullable": true
          },
          "date_to": {
            "type": "string",
            "description": "YYYY-MM-DD",
            "nullable": true
          }
        },
        "required": [
          "records"
        ]
      },
      "output_schema": {
        "type": "object",
        "properties": {
          "total": {
            "type": "integer"
          },
          "confirmed": {
            "type": "integer"
          },
          "by_band": {
            "type": "array",
            "items": {
              "type": "object"
            }
          },
          "by_mode": {
            "type": "array",
            "items": {
              "type": "object"
            }
          },
          "sample": {
            "type": "array",
            "items": {
              "type": "object"
            }
          }
        }
      }
    }
  ]
}
