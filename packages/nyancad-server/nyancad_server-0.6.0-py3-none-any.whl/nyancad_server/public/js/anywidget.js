import { $APP, shadow$provide } from "./common.js";
var OI=function(){var a=$APP.Im(1);$APP.lm(function(){var b=function(){function d(e){var f=e[1];if(f===7){var g=e[7];f=$APP.u(JI);f=!$APP.Pd(f,g);e[8]=f;e[1]=f?10:11;return $APP.Z}if(f===1)return f=$APP.u(KI),f=$APP.Eh(f),g=$APP.D(f),e[9]=g,e[2]=null,e[1]=2,$APP.Z;if(f===4){g=e[9];f=$APP.E(g);f=$APP.rz.g(f);g=$APP.u(LI);g=$APP.O(g,f);var h=$APP.qz.g(g);e[7]=f;e[10]=g;e[11]=h;e[1]=$APP.m(f)?7:8;return $APP.Z}if(f===15)return e[2]=e[2],e[1]=12,$APP.Z;if(f===13)return h=e[11],e[2]=$APP.Sa(h),e[1]=15,
$APP.Z;if(f===6)return e[2]=e[2],e[1]=3,$APP.Z;if(f===17)return g=e[9],g=$APP.Mc(g),e[9]=g,e[2]=null,e[1]=2,$APP.Z;if(f===3)return $APP.Gm(e,e[2]);if(f===12)return e[2]=e[2],e[1]=9,$APP.Z;if(f===2)return g=e[9],f=$APP.D(g),e[1]=f?4:5,$APP.Z;if(f===19)return g=e[9],h=e[12],f=e[2],g=$APP.Mc(g),h=$APP.u(h),h=$APP.Eh(h),h=$APP.D(h),g=$APP.yf.h(g,h),e[13]=f,e[9]=g,e[2]=null,e[1]=2,$APP.Z;if(f===11)return f=e[8],e[2]=f,e[1]=12,$APP.Z;if(f===9)return e[1]=$APP.m(e[2])?16:17,$APP.Z;if(f===5)return e[2]=null,
e[1]=6,$APP.Z;if(f===14)return e[2]=e[14],e[1]=15,$APP.Z;if(f===16){g=e[7];f=$APP.X.s(MI,$APP.W,g,$APP.Jg);g=$APP.Ym(NI,g,$APP.Il(MI,new $APP.U(null,1,5,$APP.V,[g],null)));h=$APP.X.s(JI,$APP.W,g.group,g.cache);var n=g.ec;e[15]=f;e[12]=g;e[16]=h;return $APP.Fm(e,19,n)}return f===10?(f=e[10],f=$APP.D(f),e[14]=f,e[1]=f?13:14,$APP.Z):f===18?(e[2]=e[2],e[1]=6,$APP.Z):f===8?(g=e[7],e[2]=g,e[1]=9,$APP.Z):null}return function(){function e(h){for(;;){a:{try{for(;;){var n=d(h);if(!$APP.Q(n,$APP.Z)){var p=n;
break a}}}catch(q){p=q;h[2]=p;if($APP.D(h[4]))h[1]=$APP.E(h[4]);else throw p;p=$APP.Z;break a}p=void 0}if(!$APP.Q(p,$APP.Z))return p}}function f(){var h=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];h[0]=g;h[1]=1;return h}var g=null;g=function(h){switch(arguments.length){case 0:return f.call(this);case 1:return e.call(this,h)}throw Error("Invalid arity: "+arguments.length);};g.m=f;g.g=e;return g}()}(),c=function(){var d=b();d[6]=a;return d}();return $APP.Em(c)})},
PI=new $APP.P("nyancad.mosaic.anywidget","anywidget-sync","nyancad.mosaic.anywidget/anywidget-sync",-1693447253);var QI=new URLSearchParams(window.location.search),RI,SI=QI.get("schem");RI=$APP.m(SI)?SI:"myschem";var TI=QI.get("db"),NI=new $APP.oA($APP.m(TI)?TI:"schematics"),MI=$APP.Gl($APP.We([RI,$APP.R,"models",$APP.R])),KI=$APP.Ym(NI,RI,$APP.Il(MI,new $APP.U(null,1,5,$APP.V,[RI],null))),LI=$APP.Ym(NI,"models",$APP.Il(MI,new $APP.U(null,1,5,$APP.V,["models"],null))),UI=$APP.Ym(NI,[$APP.r.g(RI),"$result"].join(""),$APP.Gl($APP.Ah())),JI=$APP.Wm(NI,$APP.M([KI,LI,UI]));export const render=function(a){var b=a.model;a.el.innerHTML="Connected to editor.";b.set("schematic_data",$APP.nl($APP.u(MI)));b.set("name",RI);b.save_changes();$APP.Di(MI,PI,function(c,d,e,f){$APP.yi($APP.M(["Schematic updated, syncing to anywidget model"]));OI();b.set("schematic_data",$APP.nl(f));return b.save_changes()});b.on("change:simulation_data",function(){var c=$APP.Om(b.get("simulation_data")),d=(new Date).toISOString();d=[$APP.r.g(RI),"$result:",$APP.r.g(d)].join("");$APP.yi($APP.M(["Received simulation data from Python, storing with key:",
d]));return $APP.X.s(UI,$APP.W,d,c)});return null};